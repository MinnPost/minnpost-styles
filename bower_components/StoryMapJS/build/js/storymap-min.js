/* storymapjs - v2014-06-10-16-59-05 - 2014-06-10
 * Copyright (c) 2014 Northwestern University Knight Lab 
 */
/* **********************************************
     Begin VCO.js
********************************************** *//*!
	VCO
*/(function(e){e.VCO={VERSION:"0.1",_originalL:e.VCO}})(this);VCO.debug=!0;VCO.Bind=function(e,t){return function(){return e.apply(t,arguments)}};trace=function(e){VCO.debug&&(window.console?console.log(e):typeof jsTrace!="undefined"&&jsTrace.send(e))};VCO.Util={extend:function(e){var t=Array.prototype.slice.call(arguments,1);for(var n=0,r=t.length,i;n<r;n++){i=t[n]||{};for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s])}return e},setOptions:function(e,t){e.options=VCO.Util.extend({},e.options,t);e.options.uniqueid===""&&(e.options.uniqueid=VCO.Util.unique_ID(6))},setData:function(e,t){e.data=VCO.Util.extend({},e.data,t);e.data.uniqueid===""&&(e.data.uniqueid=VCO.Util.unique_ID(6))},mergeData:function(e,t){var n;for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},stamp:function(){var e=0,t="_vco_id";return function(n){n[t]=n[t]||++e;return n[t]}}(),isArray:function(){if(Array.isArray)return Array.isArray;var e=Object.prototype.toString,t=e.call([]);return function(n){return e.call(n)===t}}(),unique_ID:function(e,t){var n=function(e){return Math.floor(Math.random()*e)},r=function(){var e="abcdefghijklmnopqurstuvwxyz";return e.substr(n(32),1)},i=function(e){var t="";for(var n=0;n<e;n++)t+=r();return t};return t?t+"-"+i(e):"vco-"+i(e)},htmlify:function(e){return e.match(/<\s*p[^>]*>([^<]*)<\s*\/\s*p\s*>/)?e:"<p>"+e+"</p>"},getParamString:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+"="+e[n]);return"?"+t.join("&")},formatNum:function(e,t){var n=Math.pow(10,t||5);return Math.round(e*n)/n},falseFn:function(){return!1},requestAnimFrame:function(){function e(e){window.setTimeout(e,1e3/60)}var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||e;return function(n,r,i,s){n=r?VCO.Util.bind(n,r):n;i&&t===e?n():t(n,s)}}(),bind:function(e,t){return function(){return e.apply(t,arguments)}},template:function(e,t){return e.replace(/\{ *([\w_]+) *\}/g,function(e,n){var r=t[n];if(!t.hasOwnProperty(n))throw new Error("No value provided for variable "+e);return r})},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},ratio:{square:function(e){var t={w:0,h:0};if(e.w>e.h&&e.h>0){t.h=e.h;t.w=e.h}else{t.w=e.w;t.h=e.w}return t},r16_9:function(e){return e.w!==null&&e.w!==""?Math.round(e.w/16*9):e.h!==null&&e.h!==""?Math.round(e.h/9*16):0},r4_3:function(e){if(e.w!==null&&e.w!=="")return Math.round(e.w/4*3);if(e.h!==null&&e.h!=="")return Math.round(e.h/3*4)}},getObjectAttributeByIndex:function(e,t){if(typeof e!="undefined"){var n=0;for(var r in e){if(t===n)return e[r];n++}return""}return""},getUrlVars:function(e){var t,n=[],r,i;t=e.toString();t.match("&#038;")?t=t.replace("&#038;","&"):t.match("&#38;")?t=t.replace("&#38;","&"):t.match("&amp;")&&(t=t.replace("&amp;","&"));i=t.slice(t.indexOf("?")+1).split("&");for(var s=0;s<i.length;s++){r=i[s].split("=");n.push(r[0]);n[r[0]]=r[1]}return n}};(function(VCO){var Zepto=function(){function D(e){return e==null?String(e):N[C.call(e)]||"object"}function P(e){return D(e)=="function"}function H(e){return e!=null&&e==e.window}function B(e){return e!=null&&e.nodeType==e.DOCUMENT_NODE}function j(e){return D(e)=="object"}function F(e){return j(e)&&!H(e)&&Object.getPrototypeOf(e)==Object.prototype}function I(e){return typeof e.length=="number"}function q(e){return o.call(e,function(e){return e!=null})}function R(e){return e.length>0?n.fn.concat.apply([],e):e}function U(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function z(e){return e in f?f[e]:f[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function W(e,t){return typeof t=="number"&&!l[U(e)]?t+"px":t}function X(e){var t,n;if(!a[e]){t=u.createElement(e);u.body.appendChild(t);n=getComputedStyle(t,"").getPropertyValue("display");t.parentNode.removeChild(t);n=="none"&&(n="block");a[e]=n}return a[e]}function V(e){return"children"in e?s.call(e.children):n.map(e.childNodes,function(e){if(e.nodeType==1)return e})}function $(n,r,i){for(t in r)if(i&&(F(r[t])||_(r[t]))){F(r[t])&&!F(n[t])&&(n[t]={});_(r[t])&&!_(n[t])&&(n[t]=[]);$(n[t],r[t],i)}else r[t]!==e&&(n[t]=r[t])}function J(e,t){return t==null?n(e):n(e).filter(t)}function K(e,t,n,r){return P(t)?t.call(e,n,r):t}function Q(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function G(t,n){var r=t.className,i=r&&r.baseVal!==e;if(n===e)return i?r.baseVal:r;i?r.baseVal=n:t.className=n}function Y(e){var t;try{return e?e=="true"||(e=="false"?!1:e=="null"?null:!/^0/.test(e)&&!isNaN(t=Number(e))?t:/^[\[\{]/.test(e)?n.parseJSON(e):e):e}catch(r){return e}}function Z(e,t){t(e);for(var n in e.childNodes)Z(e.childNodes[n],t)}var e,t,n,r,i=[],s=i.slice,o=i.filter,u=window.document,a={},f={},l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},c=/^\s*<(\w+|!)[^>]*>/,h=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,p=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,d=/^(?:body|html)$/i,v=/([A-Z])/g,m=["val","css","html","text","data","width","height","offset"],g=["after","prepend","before","append"],y=u.createElement("table"),b=u.createElement("tr"),w={tr:u.createElement("tbody"),tbody:y,thead:y,tfoot:y,td:b,th:b,"*":u.createElement("div")},E=/complete|loaded|interactive/,S=/^\.([\w-]+)$/,x=/^#([\w-]*)$/,T=/^[\w-]*$/,N={},C=N.toString,k={},L,A,O=u.createElement("div"),M={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},_=Array.isArray||function(e){return e instanceof Array};k.matches=function(e,t){if(!t||!e||e.nodeType!==1)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,s=!i;s&&(i=O).appendChild(e);r=~k.qsa(i,t).indexOf(e);s&&O.removeChild(e);return r};L=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})};A=function(e){return o.call(e,function(t,n){return e.indexOf(t)==n})};k.fragment=function(t,r,i){var o,a,f;h.test(t)&&(o=n(u.createElement(RegExp.$1)));if(!o){t.replace&&(t=t.replace(p,"<$1></$2>"));r===e&&(r=c.test(t)&&RegExp.$1);r in w||(r="*");f=w[r];f.innerHTML=""+t;o=n.each(s.call(f.childNodes),function(){f.removeChild(this)})}if(F(i)){a=n(o);n.each(i,function(e,t){m.indexOf(e)>-1?a[e](t):a.attr(e,t)})}return o};k.Z=function(e,t){e=e||[];e.__proto__=n.fn;e.selector=t||"";return e};k.isZ=function(e){return e instanceof k.Z};k.init=function(t,r){var i;if(!t)return k.Z();if(typeof t=="string"){t=t.trim();if(t[0]=="<"&&c.test(t))i=k.fragment(t,RegExp.$1,r),t=null;else{if(r!==e)return n(r).find(t);i=k.qsa(u,t)}}else{if(P(t))return n(u).ready(t);if(k.isZ(t))return t;if(_(t))i=q(t);else if(j(t))i=[t],t=null;else if(c.test(t))i=k.fragment(t.trim(),RegExp.$1,r),t=null;else{if(r!==e)return n(r).find(t);i=k.qsa(u,t)}}return k.Z(i,t)};n=function(e,t){return k.init(e,t)};n.extend=function(e){var t,n=s.call(arguments,1);if(typeof e=="boolean"){t=e;e=n.shift()}n.forEach(function(n){$(e,n,t)});return e};k.qsa=function(e,t){var n,r=t[0]=="#",i=!r&&t[0]==".",o=r||i?t.slice(1):t,u=T.test(o);return B(e)&&u&&r?(n=e.getElementById(o))?[n]:[]:e.nodeType!==1&&e.nodeType!==9?[]:s.call(u&&!r?i?e.getElementsByClassName(o):e.getElementsByTagName(t):e.querySelectorAll(t))};n.contains=function(e,t){return e!==t&&e.contains(t)};n.type=D;n.isFunction=P;n.isWindow=H;n.isArray=_;n.isPlainObject=F;n.isEmptyObject=function(e){var t;for(t in e)return!1;return!0};n.inArray=function(e,t,n){return i.indexOf.call(t,e,n)};n.camelCase=L;n.trim=function(e){return e==null?"":String.prototype.trim.call(e)};n.uuid=0;n.support={};n.expr={};n.map=function(e,t){var n,r=[],i,s;if(I(e))for(i=0;i<e.length;i++){n=t(e[i],i);n!=null&&r.push(n)}else for(s in e){n=t(e[s],s);n!=null&&r.push(n)}return R(r)};n.each=function(e,t){var n,r;if(I(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e};n.grep=function(e,t){return o.call(e,t)};window.JSON&&(n.parseJSON=JSON.parse);n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){N["[object "+t+"]"]=t.toLowerCase()});n.fn={forEach:i.forEach,reduce:i.reduce,push:i.push,sort:i.sort,indexOf:i.indexOf,concat:i.concat,map:function(e){return n(n.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return n(s.apply(this,arguments))},ready:function(e){E.test(u.readyState)&&u.body?e(n):u.addEventListener("DOMContentLoaded",function(){e(n)},!1);return this},get:function(t){return t===e?s.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(e){i.every.call(this,function(t,n){return e.call(t,n,t)!==!1});return this},filter:function(e){return P(e)?this.not(this.not(e)):n(o.call(this,function(t){return k.matches(t,e)}))},add:function(e,t){return n(A(this.concat(n(e,t))))},is:function(e){return this.length>0&&k.matches(this[0],e)},not:function(t){var r=[];if(P(t)&&t.call!==e)this.each(function(e){t.call(this,e)||r.push(this)});else{var i=typeof t=="string"?this.filter(t):I(t)&&P(t.item)?s.call(t):n(t);this.forEach(function(e){i.indexOf(e)<0&&r.push(e)})}return n(r)},has:function(e){return this.filter(function(){return j(e)?n.contains(this,e):n(this).find(e).size()})},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!j(e)?e:n(e)},last:function(){var e=this[this.length-1];return e&&!j(e)?e:n(e)},find:function(e){var t,r=this;typeof e=="object"?t=n(e).filter(function(){var e=this;return i.some.call(r,function(t){return n.contains(t,e)})}):this.length==1?t=n(k.qsa(this[0],e)):t=this.map(function(){return k.qsa(this,e)});return t},closest:function(e,t){var r=this[0],i=!1;typeof e=="object"&&(i=n(e));while(r&&!(i?i.indexOf(r)>=0:k.matches(r,e)))r=r!==t&&!B(r)&&r.parentNode;return n(r)},parents:function(e){var t=[],r=this;while(r.length>0)r=n.map(r,function(e){if((e=e.parentNode)&&!B(e)&&t.indexOf(e)<0){t.push(e);return e}});return J(t,e)},parent:function(e){return J(A(this.pluck("parentNode")),e)},children:function(e){return J(this.map(function(){return V(this)}),e)},contents:function(){return this.map(function(){return s.call(this.childNodes)})},siblings:function(e){return J(this.map(function(e,t){return o.call(V(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return n.map(this,function(t){return t[e]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display="");getComputedStyle(this,"").getPropertyValue("display")=="none"&&(this.style.display=X(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var t=P(e);if(this[0]&&!t)var r=n(e).get(0),i=r.parentNode||this.length>1;return this.each(function(s){n(this).wrapAll(t?e.call(this,s):i?r.cloneNode(!0):r)})},wrapAll:function(e){if(this[0]){n(this[0]).before(e=n(e));var t;while((t=e.children()).length)e=t.first();n(e).append(this)}return this},wrapInner:function(e){var t=P(e);return this.each(function(r){var i=n(this),s=i.contents(),o=t?e.call(this,r):e;s.length?s.wrapAll(o):i.append(o)})},unwrap:function(){this.parent().each(function(){n(this).replaceWith(n(this).children())});return this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var r=n(this);(t===e?r.css("display")=="none":t)?r.show():r.hide()})},prev:function(e){return n(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return n(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return arguments.length===0?this.length>0?this[0].innerHTML:null:this.each(function(t){var r=this.innerHTML;n(this).empty().append(K(this,e,t,r))})},text:function(t){return arguments.length===0?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=t===e?"":""+t})},attr:function(n,r){var i;return typeof n=="string"&&r===e?this.length==0||this[0].nodeType!==1?e:n=="value"&&this[0].nodeName=="INPUT"?this.val():!(i=this[0].getAttribute(n))&&n in this[0]?this[0][n]:i:this.each(function(e){if(this.nodeType!==1)return;if(j(n))for(t in n)Q(this,t,n[t]);else Q(this,n,K(this,r,e,this.getAttribute(n)))})},removeAttr:function(e){return this.each(function(){this.nodeType===1&&Q(this,e)})},prop:function(t,n){t=M[t]||t;return n===e?this[0]&&this[0][t]:this.each(function(e){this[t]=K(this,n,e,this[t])})},data:function(t,n){var r=this.attr("data-"+t.replace(v,"-$1").toLowerCase(),n);return r!==null?Y(r):e},val:function(e){return arguments.length===0?this[0]&&(this[0].multiple?n(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value):this.each(function(t){this.value=K(this,e,t,this.value)})},offset:function(e){if(e)return this.each(function(t){var r=n(this),i=K(this,e,t,r.offset()),s=r.offsetParent().offset(),o={top:i.top-s.top,left:i.left-s.left};r.css("position")=="static"&&(o.position="relative");r.css(o)});if(this.length==0)return null;var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(e,r){if(arguments.length<2){var i=this[0],s=getComputedStyle(i,"");if(!i)return;if(typeof e=="string")return i.style[L(e)]||s.getPropertyValue(e);if(_(e)){var o={};n.each(_(e)?e:[e],function(e,t){o[t]=i.style[L(t)]||s.getPropertyValue(t)});return o}}var u="";if(D(e)=="string")!r&&r!==0?this.each(function(){this.style.removeProperty(U(e))}):u=U(e)+":"+W(e,r);else for(t in e)!e[t]&&e[t]!==0?this.each(function(){this.style.removeProperty(U(t))}):u+=U(t)+":"+W(t,e[t])+";";return this.each(function(){this.style.cssText+=";"+u})},index:function(e){return e?this.indexOf(n(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return e?i.some.call(this,function(e){return this.test(G(e))},z(e)):!1},addClass:function(e){return e?this.each(function(t){r=[];var i=G(this),s=K(this,e,t,i);s.split(/\s+/g).forEach(function(e){n(this).hasClass(e)||r.push(e)},this);r.length&&G(this,i+(i?" ":"")+r.join(" "))}):this},removeClass:function(t){return this.each(function(n){if(t===e)return G(this,"");r=G(this);K(this,t,n,r).split(/\s+/g).forEach(function(e){r=r.replace(z(e)," ")});G(this,r.trim())})},toggleClass:function(t,r){return t?this.each(function(i){var s=n(this),o=K(this,t,i,G(this));o.split(/\s+/g).forEach(function(t){(r===e?!s.hasClass(t):r)?s.addClass(t):s.removeClass(t)})}):this},scrollTop:function(t){if(!this.length)return;var n="scrollTop"in this[0];return t===e?n?this[0].scrollTop:this[0].pageYOffset:this.each(n?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})},scrollLeft:function(t){if(!this.length)return;var n="scrollLeft"in this[0];return t===e?n?this[0].scrollLeft:this[0].pageXOffset:this.each(n?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})},position:function(){if(!this.length)return;var e=this[0],t=this.offsetParent(),r=this.offset(),i=d.test(t[0].nodeName)?{top:0,left:0}:t.offset();r.top-=parseFloat(n(e).css("margin-top"))||0;r.left-=parseFloat(n(e).css("margin-left"))||0;i.top+=parseFloat(n(t[0]).css("border-top-width"))||0;i.left+=parseFloat(n(t[0]).css("border-left-width"))||0;return{top:r.top-i.top,left:r.left-i.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||u.body;while(e&&!d.test(e.nodeName)&&n(e).css("position")=="static")e=e.offsetParent;return e})}};n.fn.detach=n.fn.remove;["width","height"].forEach(function(t){var r=t.replace(/./,function(e){return e[0].toUpperCase()});n.fn[t]=function(i){var s,o=this[0];return i===e?H(o)?o["inner"+r]:B(o)?o.documentElement["scroll"+r]:(s=this.offset())&&s[t]:this.each(function(e){o=n(this);o.css(t,K(this,i,e,o[t]()))})}});g.forEach(function(e,t){var r=t%2;n.fn[e]=function(){var e,i=n.map(arguments,function(t){e=D(t);return e=="object"||e=="array"||t==null?t:k.fragment(t)}),s,o=this.length>1;return i.length<1?this:this.each(function(e,u){s=r?u:u.parentNode;u=t==0?u.nextSibling:t==1?u.firstChild:t==2?u:null;i.forEach(function(e){if(o)e=e.cloneNode(!0);else if(!s)return n(e).remove();Z(s.insertBefore(e,u),function(e){e.nodeName!=null&&e.nodeName.toUpperCase()==="SCRIPT"&&(!e.type||e.type==="text/javascript")&&!e.src&&window.eval.call(window,e.innerHTML)})})})};n.fn[r?e+"To":"insert"+(t?"Before":"After")]=function(t){n(t)[e](this);return this}});k.Z.prototype=n.fn;k.uniq=A;k.deserializeValue=Y;n.zepto=k;return n}();window.Zepto=Zepto;window.$===undefined&&(window.$=Zepto);(function(e){function h(e){return e._zid||(e._zid=n++)}function p(e,t,n,r){t=d(t);if(t.ns)var i=v(t.ns);return(u[h(e)]||[]).filter(function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||i.test(e.ns))&&(!n||h(e.fn)===h(n))&&(!r||e.sel==r)})}function d(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function v(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function m(e,t){return e.del&&!f&&e.e in l||!!t}function g(e){return c[e]||f&&l[e]||e}function y(t,n,i,s,o,a,f){var l=h(t),p=u[l]||(u[l]=[]);n.split(/\s/).forEach(function(n){if(n=="ready")return e(document).ready(i);var u=d(n);u.fn=i;u.sel=o;u.e in c&&(i=function(t){var n=t.relatedTarget;if(!n||n!==this&&!e.contains(this,n))return u.fn.apply(this,arguments)});u.del=a;var l=a||i;u.proxy=function(e){e=T(e);if(e.isImmediatePropagationStopped())return;e.data=s;var n=l.apply(t,e._args==r?[e]:[e].concat(e._args));n===!1&&(e.preventDefault(),e.stopPropagation());return n};u.i=p.length;p.push(u);"addEventListener"in t&&t.addEventListener(g(u.e),u.proxy,m(u,f))})}function b(e,t,n,r,i){var s=h(e);(t||"").split(/\s/).forEach(function(t){p(e,t,n,r).forEach(function(t){delete u[s][t.i];"removeEventListener"in e&&e.removeEventListener(g(t.e),t.proxy,m(t,i))})})}function T(t,n){if(n||!t.isDefaultPrevented){n||(n=t);e.each(x,function(e,r){var i=n[e];t[e]=function(){this[r]=w;return i&&i.apply(n,arguments)};t[r]=E});if(n.defaultPrevented!==r?n.defaultPrevented:"returnValue"in n?n.returnValue===!1:n.getPreventDefault&&n.getPreventDefault())t.isDefaultPrevented=w}return t}function N(e){var t,n={originalEvent:e};for(t in e)!S.test(t)&&e[t]!==r&&(n[t]=e[t]);return T(n,e)}var t=e.zepto.qsa,n=1,r,i=Array.prototype.slice,s=e.isFunction,o=function(e){return typeof e=="string"},u={},a={},f="onfocusin"in window,l={focus:"focusin",blur:"focusout"},c={mouseenter:"mouseover",mouseleave:"mouseout"};a.click=a.mousedown=a.mouseup=a.mousemove="MouseEvents";e.event={add:y,remove:b};e.proxy=function(t,n){if(s(t)){var r=function(){return t.apply(n,arguments)};r._zid=h(t);return r}if(o(n))return e.proxy(t[n],t);throw new TypeError("expected function")};e.fn.bind=function(e,t,n){return this.on(e,t,n)};e.fn.unbind=function(e,t){return this.off(e,t)};e.fn.one=function(e,t,n,r){return this.on(e,t,n,r,1)};var w=function(){return!0},E=function(){return!1},S=/^([A-Z]|returnValue$|layer[XY]$)/,x={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(e,t,n){return this.on(t,e,n)};e.fn.undelegate=function(e,t,n){return this.off(t,e,n)};e.fn.live=function(t,n){e(document.body).delegate(this.selector,t,n);return this};e.fn.die=function(t,n){e(document.body).undelegate(this.selector,t,n);return this};e.fn.on=function(t,n,u,a,f){var l,c,h=this;if(t&&!o(t)){e.each(t,function(e,t){h.on(e,n,u,t,f)});return h}!o(n)&&!s(a)&&a!==!1&&(a=u,u=n,n=r);if(s(u)||u===!1)a=u,u=r;a===!1&&(a=E);return h.each(function(r,s){f&&(l=function(e){b(s,e.type,a);return a.apply(this,arguments)});n&&(c=function(t){var r,o=e(t.target).closest(n,s).get(0);if(o&&o!==s){r=e.extend(N(t),{currentTarget:o,liveFired:s});return(l||a).apply(o,[r].concat(i.call(arguments,1)))}});y(s,t,a,u,n,c||l)})};e.fn.off=function(t,n,i){var u=this;if(t&&!o(t)){e.each(t,function(e,t){u.off(e,n,t)});return u}!o(n)&&!s(i)&&i!==!1&&(i=n,n=r);i===!1&&(i=E);return u.each(function(){b(this,t,i,n)})};e.fn.trigger=function(t,n){t=o(t)||e.isPlainObject(t)?e.Event(t):T(t);t._args=n;return this.each(function(){"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)})};e.fn.triggerHandler=function(t,n){var r,i;this.each(function(s,u){r=N(o(t)?e.Event(t):t);r._args=n;r.target=u;e.each(p(u,t.type||t),function(e,t){i=t.proxy(r);if(r.isImmediatePropagationStopped())return!1})});return i};"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.trigger(t)}});["focus","blur"].forEach(function(t){e.fn[t]=function(e){e?this.bind(t,e):this.each(function(){try{this[t]()}catch(e){}});return this}});e.Event=function(e,t){o(e)||(t=e,e=t.type);var n=document.createEvent(a[e]||"Events"),r=!0;if(t)for(var i in t)i=="bubbles"?r=!!t[i]:n[i]=t[i];n.initEvent(e,r,!0);return T(n)}})(Zepto);(function($){function triggerAndReturn(e,t,n){var r=$.Event(t);$(e).trigger(r,n);return!r.isDefaultPrevented()}function triggerGlobal(e,t,n,r){if(e.global)return triggerAndReturn(t||document,n,r)}function ajaxStart(e){e.global&&$.active++===0&&triggerGlobal(e,null,"ajaxStart")}function ajaxStop(e){e.global&&!--$.active&&triggerGlobal(e,null,"ajaxStop")}function ajaxBeforeSend(e,t){var n=t.context;if(t.beforeSend.call(n,e,t)===!1||triggerGlobal(t,n,"ajaxBeforeSend",[e,t])===!1)return!1;triggerGlobal(t,n,"ajaxSend",[e,t])}function ajaxSuccess(e,t,n,r){var i=n.context,s="success";n.success.call(i,e,s,t);r&&r.resolveWith(i,[e,s,t]);triggerGlobal(n,i,"ajaxSuccess",[t,n,e]);ajaxComplete(s,t,n)}function ajaxError(e,t,n,r,i){var s=r.context;r.error.call(s,n,t,e);i&&i.rejectWith(s,[n,t,e]);triggerGlobal(r,s,"ajaxError",[n,r,e||t]);ajaxComplete(t,n,r)}function ajaxComplete(e,t,n){var r=n.context;n.complete.call(r,t,e);triggerGlobal(n,r,"ajaxComplete",[t,n]);ajaxStop(n)}function empty(){}function mimeToDataType(e){e&&(e=e.split(";",2)[0]);return e&&(e==htmlType?"html":e==jsonType?"json":scriptTypeRE.test(e)?"script":xmlTypeRE.test(e)&&"xml")||"text"}function appendQuery(e,t){return t==""?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){e.processData&&e.data&&$.type(e.data)!="string"&&(e.data=$.param(e.data,e.traditional));e.data&&(!e.type||e.type.toUpperCase()=="GET")&&(e.url=appendQuery(e.url,e.data),e.data=undefined)}function parseArguments(e,t,n,r){var i=!$.isFunction(t);return{url:e,data:i?t:undefined,success:i?$.isFunction(n)?n:undefined:t,dataType:i?r||n:n}}function serialize(e,t,n,r){var i,s=$.isArray(t),o=$.isPlainObject(t);$.each(t,function(t,u){i=$.type(u);r&&(t=n?r:r+"["+(o||i=="object"||i=="array"?t:"")+"]");!r&&s?e.add(u.name,u.value):i=="array"||!n&&i=="object"?serialize(e,u,n,t):e.add(t,u)})}var jsonpID=0,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0;$.ajaxJSONP=function(e,t){if("type"in e){var n=e.jsonpCallback,r=($.isFunction(n)?n():n)||"jsonp"+ ++jsonpID,i=document.createElement("script"),s=window[r],o,u=function(e){$(i).triggerHandler("error",e||"abort")},a={abort:u},f;t&&t.promise(a);$(i).on("load error",function(n,u){clearTimeout(f);$(i).off().remove();n.type=="error"||!o?ajaxError(null,u||"error",a,e,t):ajaxSuccess(o[0],a,e,t);window[r]=s;o&&$.isFunction(s)&&s(o[0]);s=o=undefined});if(ajaxBeforeSend(a,e)===!1){u("abort");return a}window[r]=function(){o=arguments};i.src=e.url.replace(/\?(.+)=\?/,"?$1="+r);document.head.appendChild(i);e.timeout>0&&(f=setTimeout(function(){u("timeout")},e.timeout));return a}return $.ajax(e)};$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0};$.ajax=function(options){var settings=$.extend({},options||{}),deferred=$.Deferred&&$.Deferred();for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings);settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host);settings.url||(settings.url=window.location.toString());serializeData(settings);settings.cache===!1&&(settings.url=appendQuery(settings.url,"_="+Date.now()));var dataType=settings.dataType,hasPlaceholder=/\?.+=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder){hasPlaceholder||(settings.url=appendQuery(settings.url,settings.jsonp?settings.jsonp+"=?":settings.jsonp===!1?"":"callback=?"));return $.ajaxJSONP(settings,deferred)}var mime=settings.accepts[dataType],headers={},setHeader=function(e,t){headers[e.toLowerCase()]=[e,t]},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=settings.xhr(),nativeSetHeader=xhr.setRequestHeader,abortTimeout;deferred&&deferred.promise(xhr);settings.crossDomain||setHeader("X-Requested-With","XMLHttpRequest");setHeader("Accept",mime||"*/*");if(mime=settings.mimeType||mime){mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]);xhr.overrideMimeType&&xhr.overrideMimeType(mime)}(settings.contentType||settings.contentType!==!1&&settings.data&&settings.type.toUpperCase()!="GET")&&setHeader("Content-Type",settings.contentType||"application/x-www-form-urlencoded");if(settings.headers)for(name in settings.headers)setHeader(name,settings.headers[name]);xhr.setRequestHeader=setHeader;xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty;clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(settings.mimeType||xhr.getResponseHeader("content-type"));result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:$.parseJSON(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings,deferred):ajaxSuccess(result,xhr,settings,deferred)}else ajaxError(xhr.statusText||null,xhr.status?"error":"abort",xhr,settings,deferred)}};if(ajaxBeforeSend(xhr,settings)===!1){xhr.abort();ajaxError(null,"abort",xhr,settings,deferred);return xhr}if(settings.xhrFields)for(name in settings.xhrFields)xhr[name]=settings.xhrFields[name];var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async,settings.username,settings.password);for(name in headers)nativeSetHeader.apply(xhr,headers[name]);settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty;xhr.abort();ajaxError(null,"timeout",xhr,settings,deferred)},settings.timeout));xhr.send(settings.data?settings.data:null);return xhr};$.get=function(e,t,n,r){return $.ajax(parseArguments.apply(null,arguments))};$.post=function(e,t,n,r){var i=parseArguments.apply(null,arguments);i.type="POST";return $.ajax(i)};$.getJSON=function(e,t,n){var r=parseArguments.apply(null,arguments);r.dataType="json";return $.ajax(r)};$.fn.load=function(e,t,n){if(!this.length)return this;var r=this,i=e.split(/\s/),s,o=parseArguments(e,t,n),u=o.success;i.length>1&&(o.url=i[0],s=i[1]);o.success=function(e){r.html(s?$("<div>").html(e.replace(rscript,"")).find(s):e);u&&u.apply(r,arguments)};$.ajax(o);return this};var escape=encodeURIComponent;$.param=function(e,t){var n=[];n.add=function(e,t){this.push(escape(e)+"="+escape(t))};serialize(n,e,t);return n.join("&").replace(/%20/g,"+")}})(Zepto);(function(e){e.fn.serializeArray=function(){var t=[],n;e([].slice.call(this.get(0).elements)).each(function(){n=e(this);var r=n.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&r!="submit"&&r!="reset"&&r!="button"&&(r!="radio"&&r!="checkbox"||this.checked)&&t.push({name:n.attr("name"),value:n.val()})});return t};e.fn.serialize=function(){var e=[];this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))});return e.join("&")};e.fn.submit=function(t){if(t)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n);n.isDefaultPrevented()||this.get(0).submit()}return this}})(Zepto);(function(e){"__proto__"in{}||e.extend(e.zepto,{Z:function(t,n){t=t||[];e.extend(t,e.fn);t.selector=n||"";t.__Z=!0;return t},isZ:function(t){return e.type(t)==="array"&&"__Z"in t}});try{getComputedStyle(undefined)}catch(t){var n=getComputedStyle;window.getComputedStyle=function(e){try{return n(e)}catch(t){return null}}}})(Zepto);VCO.getJSON=Zepto.getJSON;VCO.ajax=Zepto.ajax})(VCO);VCO.Class=function(){};VCO.Class.extend=function(e){var t=function(){this.initialize&&this.initialize.apply(this,arguments)},n=function(){};n.prototype=this.prototype;var r=new n;r.constructor=t;t.prototype=r;t.superclass=this.prototype;for(var i in this)this.hasOwnProperty(i)&&i!=="prototype"&&i!=="superclass"&&(t[i]=this[i]);if(e.statics){VCO.Util.extend(t,e.statics);delete e.statics}if(e.includes){VCO.Util.extend.apply(null,[r].concat(e.includes));delete e.includes}e.options&&r.options&&(e.options=VCO.Util.extend({},r.options,e.options));VCO.Util.extend(r,e);t.extend=VCO.Class.extend;t.include=function(e){VCO.Util.extend(this.prototype,e)};return t};VCO.Events={addEventListener:function(e,t,n){var r=this._vco_events=this._vco_events||{};r[e]=r[e]||[];r[e].push({action:t,context:n||this});return this},hasEventListeners:function(e){var t="_vco_events";return t in this&&e in this[t]&&this[t][e].length>0},removeEventListener:function(e,t,n){if(!this.hasEventListeners(e))return this;for(var r=0,i=this._vco_events,s=i[e].length;r<s;r++)if(i[e][r].action===t&&(!n||i[e][r].context===n)){i[e].splice(r,1);return this}return this},fireEvent:function(e,t){if(!this.hasEventListeners(e))return this;var n=VCO.Util.extend({type:e,target:this},t),r=this._vco_events[e].slice();for(var i=0,s=r.length;i<s;i++)r[i].action.call(r[i].context||this,n);return this}};VCO.Events.on=VCO.Events.addEventListener;VCO.Events.off=VCO.Events.removeEventListener;VCO.Events.fire=VCO.Events.fireEvent;(function(){var e=navigator.userAgent.toLowerCase(),t=document.documentElement,n="ActiveXObject"in window,r=e.indexOf("webkit")!==-1,i=e.indexOf("phantom")!==-1,s=e.search("android [23]")!==-1,o=typeof orientation!="undefined",u=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!window.PointerEvent,a=window.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||u,f=n&&"transition"in t.style,l="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!s,c="MozPerspective"in t.style,h="OTransition"in t.style,p=window.opera,d="devicePixelRatio"in window&&window.devicePixelRatio>1;if(!d&&"matchMedia"in window){var v=window.matchMedia("(min-resolution:144dpi)");d=v&&v.matches}var m=!window.L_NO_TOUCH&&!i&&(a||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);VCO.Browser={ie:n,ielt9:n&&!document.addEventListener,webkit:r,firefox:e.indexOf("gecko")!==-1&&!r&&!window.opera&&!n,android:e.indexOf("android")!==-1,android23:s,chrome:e.indexOf("chrome")!==-1,ie3d:f,webkit3d:l,gecko3d:c,opera3d:h,any3d:!window.L_DISABLE_3D&&(f||l||c||h)&&!i,mobile:o,mobileWebkit:o&&r,mobileWebkit3d:o&&l,mobileOpera:o&&window.opera,touch:!!m,msPointer:!!u,pointer:!!a,retina:!!d,orientation:function(){var e=window.innerWidth,t=window.innerHeight,n="portrait";e>t&&(n="landscape");Math.abs(window.orientation)==90;trace(n);return n}}})();VCO.Load=function(e){function n(e){var n=0,r=!1;for(n=0;n<t.length;n++)t[n]==e&&(r=!0);if(r)return!0;t.push(e);return!1}var t=[];return{css:function(e,t,r,i){n(e)?t():VCO.LoadIt.css(e,t,r,i)},js:function(e,t,r,i){n(e)?t():VCO.LoadIt.js(e,t,r,i)
}}}(this.document);VCO.LoadIt=function(e){function u(t,n){var r=e.createElement(t),i;for(i in n)n.hasOwnProperty(i)&&r.setAttribute(i,n[i]);return r}function a(e){var t=r[e],n,o;if(t){n=t.callback;o=t.urls;o.shift();i=0;if(!o.length){n&&n.call(t.context,t.obj);r[e]=null;s[e].length&&l(e)}}}function f(){var n=navigator.userAgent;t={async:e.createElement("script").async===!0};(t.webkit=/AppleWebKit\//.test(n))||(t.ie=/MSIE/.test(n))||(t.opera=/Opera/.test(n))||(t.gecko=/Gecko\//.test(n))||(t.unknown=!0)}function l(i,o,l,p,d){var v=function(){a(i)},m=i==="css",g=[],y,b,w,E,S,x;t||f();if(o){o=typeof o=="string"?[o]:o.concat();if(m||t.async||t.gecko||t.opera)s[i].push({urls:o,callback:l,obj:p,context:d});else for(y=0,b=o.length;y<b;++y)s[i].push({urls:[o[y]],callback:y===b-1?l:null,obj:p,context:d})}if(r[i]||!(E=r[i]=s[i].shift()))return;n||(n=e.head||e.getElementsByTagName("head")[0]);S=E.urls;for(y=0,b=S.length;y<b;++y){x=S[y];if(m)w=t.gecko?u("style"):u("link",{href:x,rel:"stylesheet"});else{w=u("script",{src:x});w.async=!1}w.className="lazyload";w.setAttribute("charset","utf-8");if(t.ie&&!m)w.onreadystatechange=function(){if(/loaded|complete/.test(w.readyState)){w.onreadystatechange=null;v()}};else if(m&&(t.gecko||t.webkit))if(t.webkit){E.urls[y]=w.href;h()}else{w.innerHTML='@import "'+x+'";';c(w)}else w.onload=w.onerror=v;g.push(w)}for(y=0,b=g.length;y<b;++y)n.appendChild(g[y])}function c(e){var t;try{t=!!e.sheet.cssRules}catch(n){i+=1;i<200?setTimeout(function(){c(e)},50):t&&a("css");return}a("css")}function h(){var e=r.css,t;if(e){t=o.length;while(--t>=0)if(o[t].href===e.urls[0]){a("css");break}i+=1;e&&(i<200?setTimeout(h,50):a("css"))}}var t,n,r={},i=0,s={css:[],js:[]},o=e.styleSheets;return{css:function(e,t,n,r){l("css",e,t,n,r)},js:function(e,t,n,r){l("js",e,t,n,r)}}}(this.document);VCO.Language={name:"English",lang:"en",messages:{loading:"Loading",wikipedia:"From Wikipedia, the free encyclopedia"},buttons:{map_overview:"Map Overview",overview:"Overview",backtostart:"Back To Beginning",collapse_toggle:"Hide Map",uncollapse_toggle:"Show Map"}};VCO.Easings={ease:[.25,.1,.25,1],linear:[0,0,1,1],easein:[.42,0,1,1],easeout:[0,0,.58,1],easeinout:[.42,0,.58,1]};VCO.Ease={KeySpline:function(e){function t(e,t){return 1-3*t+3*e}function n(e,t){return 3*t-6*e}function r(e){return 3*e}function i(e,i,s){return((t(i,s)*e+n(i,s))*e+r(i))*e}function s(e,i,s){return 3*t(i,s)*e*e+2*n(i,s)*e+r(i)}function o(t){var n=t;for(var r=0;r<4;++r){var o=s(n,e[0],e[2]);if(o==0)return n;var u=i(n,e[0],e[2])-t;n-=u/o}return n}this.get=function(t){return e[0]==e[1]&&e[2]==e[3]?t:i(o(t),e[1],e[3])}},easeInSpline:function(e){var t=new VCO.Ease.KeySpline(VCO.Easings.easein);return t.get(e)},easeInOutExpo:function(e){var t=new VCO.Ease.KeySpline(VCO.Easings.easein);return t.get(e)},easeOut:function(e){return Math.sin(e*Math.PI/2)},easeOutStrong:function(e){return e==1?1:1-Math.pow(2,-10*e)},easeIn:function(e){return e*e},easeInStrong:function(e){return e==0?0:Math.pow(2,10*(e-1))},easeOutBounce:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInBack:function(e){var t=1.70158;return e*e*((t+1)*e-t)},easeOutBack:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},bounce:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bouncePast:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?2-(7.5625*(e-=1.5/2.75)*e+.75):e<2.5/2.75?2-(7.5625*(e-=2.25/2.75)*e+.9375):2-(7.5625*(e-=2.625/2.75)*e+.984375)},swingTo:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},swingFrom:function(e){var t=1.70158;return e*e*((t+1)*e-t)},elastic:function(e){return-1*Math.pow(4,-8*e)*Math.sin((e*6-1)*2*Math.PI/2)+1},spring:function(e){return 1-Math.cos(e*4.5*Math.PI)*Math.exp(-e*6)},blink:function(e,t){return Math.round(e*(t||5))%2},pulse:function(e,t){return-Math.cos(e*((t||5)-.5)*2*Math.PI)/2+.5},wobble:function(e){return-Math.cos(e*Math.PI*9*e)/2+.5},sinusoidal:function(e){return-Math.cos(e*Math.PI)/2+.5},flicker:function(e){var e=e+(Math.random()-.5)/5;return easings.sinusoidal(e<0?0:e>1?1:e)},mirror:function(e){return e<.5?easings.sinusoidal(e*2):easings.sinusoidal(1-(e-.5)*2)},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:-1+(4-2*e)*e},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+ --e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}};VCO.Animate=function(e,t){var n=new vcoanimate(e,t),r;return n};!function(e,t){typeof define=="function"?define(t):typeof module!="undefined"?module.exports=t():this[e]=t()}("vcoanimate",function(){function E(e,t,n){if(Array.prototype.indexOf)return e.indexOf(t);for(n=0;n<e.length;++n)if(e[n]===t)return n}function S(e){var t,n=w.length;r&&e>1e12&&(e=i());o&&(e=i());for(t=n;t--;)w[t](e);w.length&&b(S)}function x(e){w.push(e)===1&&b(S)}function T(e){var t,n=E(w,e);if(n>=0){t=w.slice(n+1);w.length=n;w=w.concat(t)}}function N(e,t){var n={},r;if(r=e.match(c))n.rotate=B(r[1],t?t.rotate:null);if(r=e.match(h))n.scale=B(r[1],t?t.scale:null);if(r=e.match(p)){n.skewx=B(r[1],t?t.skewx:null);n.skewy=B(r[3],t?t.skewy:null)}if(r=e.match(d)){n.translatex=B(r[1],t?t.translatex:null);n.translatey=B(r[3],t?t.translatey:null)}return n}function C(e){var t="";"rotate"in e&&(t+="rotate("+e.rotate+"deg) ");"scale"in e&&(t+="scale("+e.scale+") ");"translatex"in e&&(t+="translate("+e.translatex+"px,"+e.translatey+"px) ");"skewx"in e&&(t+="skew("+e.skewx+"deg,"+e.skewy+"deg)");return t}function k(e,t,n){return"#"+(1<<24|e<<16|t<<8|n).toString(16).slice(1)}function L(e){var t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return(t?k(t[1],t[2],t[3]):e).replace(/#(\w)(\w)(\w)$/,"#$1$1$2$2$3$3")}function A(e){return e.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}function O(e){return typeof e=="function"}function M(e){return Math.sin(e*Math.PI/2)}function _(e,t,n,r,s,o){function d(e){var i=e-c;if(i>a||h){o=isFinite(o)?o:1;h?p&&t(o):t(o);T(d);return n&&n.apply(f)}isFinite(o)?t(l*r(i/a)+s):t(r(i/a))}r=O(r)?r:j.easings[r]||M;var a=e||u,f=this,l=o-s,c=i(),h=0,p=0;x(d);return{stop:function(e){h=1;p=e;e||(n=null)}}}function D(e,t){var n=e.length,r=[],i,s;for(i=0;i<n;++i)r[i]=[e[i][0],e[i][1]];for(s=1;s<n;++s)for(i=0;i<n-s;++i){r[i][0]=(1-t)*r[i][0]+t*r[parseInt(i+1,10)][0];r[i][1]=(1-t)*r[i][1]+t*r[parseInt(i+1,10)][1]}return[r[0][0],r[0][1]]}function P(e,t,n){var r=[],i,s,o,u;for(i=0;i<6;i++){o=Math.min(15,parseInt(t.charAt(i),16));u=Math.min(15,parseInt(n.charAt(i),16));s=Math.floor((u-o)*e+o);s=s>15?15:s<0?0:s;r[i]=s.toString(16)}return"#"+r.join("")}function H(e,t,n,r,i,s,o){if(i=="transform"){o={};for(var a in n[s][i])o[a]=a in r[s][i]?Math.round(((r[s][i][a]-n[s][i][a])*e+n[s][i][a])*u)/u:n[s][i][a];return o}if(typeof n[s][i]=="string")return P(e,n[s][i],r[s][i]);o=Math.round(((r[s][i]-n[s][i])*e+n[s][i])*u)/u;i in v||(o+=t[s][i]||"px");return o}function B(e,t,n,r,i){return(n=f.exec(e))?(i=parseFloat(n[2]))&&t+(n[1]=="+"?1:-1)*i:parseFloat(e)}function j(e,t){var n=e?n=isFinite(e.length)?e:[e]:[],r,i=t.complete,s=t.duration,o=t.easing,u=t.bezier,f=[],c=[],h=[],p=[],d,v;if(u){d=t.left;v=t.top;delete t.right;delete t.bottom;delete t.left;delete t.top}for(r=n.length;r--;){f[r]={};c[r]={};h[r]={};if(u){var b=y(n[r],"left"),w=y(n[r],"top"),E=[B(O(d)?d(n[r]):d||0,parseFloat(b)),B(O(v)?v(n[r]):v||0,parseFloat(w))];p[r]=O(u)?u(n[r],E):u;p[r].push(E);p[r].unshift([parseInt(b,10),parseInt(w,10)])}for(var S in t){switch(S){case"complete":case"duration":case"easing":case"bezier":continue}var x=y(n[r],S),T,k=O(t[S])?t[S](n[r]):t[S];if(typeof k=="string"&&a.test(k)&&!a.test(x)){delete t[S];continue}f[r][S]=S=="transform"?N(x):typeof k=="string"&&a.test(k)?L(x).slice(1):parseFloat(x);c[r][S]=S=="transform"?N(k,f[r][S]):typeof k=="string"&&k.charAt(0)=="#"?L(k).slice(1):B(k,parseFloat(x));typeof k=="string"&&(T=k.match(l))&&(h[r][S]=T[1])}}return _.apply(n,[s,function(e,i,s){for(r=n.length;r--;){if(u){s=D(p[r],e);n[r].style.left=s[0]+"px";n[r].style.top=s[1]+"px"}for(var o in t){i=H(e,h,f,c,o,r);o=="transform"?n[r].style[m]=C(i):o=="opacity"&&!g?n[r].style.filter="alpha(opacity="+i*100+")":n[r].style[A(o)]=i}}},i,o])}var e=document,t=window,n=t.performance,r=n&&(n.now||n.webkitNow||n.msNow||n.mozNow),i=r?function(){return r.call(n)}:function(){return+(new Date)},s=e.documentElement,o=!1,u=1e3,a=/^rgb\(|#/,f=/^([+\-])=([\d\.]+)/,l=/^(?:[\+\-]=?)?\d+(?:\.\d+)?(%|in|cm|mm|em|ex|pt|pc|px)$/,c=/rotate\(((?:[+\-]=)?([\-\d\.]+))deg\)/,h=/scale\(((?:[+\-]=)?([\d\.]+))\)/,p=/skew\(((?:[+\-]=)?([\-\d\.]+))deg, ?((?:[+\-]=)?([\-\d\.]+))deg\)/,d=/translate\(((?:[+\-]=)?([\-\d\.]+))px, ?((?:[+\-]=)?([\-\d\.]+))px\)/,v={lineHeight:1,zoom:1,zIndex:1,opacity:1,transform:1},m=function(){var t=e.createElement("a").style,n=["webkitTransform","MozTransform","OTransform","msTransform","Transform"],r;for(r=0;r<n.length;r++)if(n[r]in t)return n[r]}(),g=function(){return typeof e.createElement("a").style.opacity!="undefined"}(),y=e.defaultView&&e.defaultView.getComputedStyle?function(t,n){n=n=="transform"?m:n;n=A(n);var r=null,i=e.defaultView.getComputedStyle(t,"");i&&(r=i[n]);return t.style[n]||r}:s.currentStyle?function(e,t){t=A(t);if(t=="opacity"){var n=100;try{n=e.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(r){try{n=e.filters("alpha").opacity}catch(i){}}return n/100}var s=e.currentStyle?e.currentStyle[t]:null;return e.style[t]||s}:function(e,t){return e.style[A(t)]},b=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame||function(e){t.setTimeout(function(){e(+(new Date))},17)}}(),w=[];b(function(e){o=e>1e12!=i()>1e12});j.tween=_;j.getStyle=y;j.bezier=D;j.transform=m;j.parseTransform=N;j.formatTransform=C;j.easings={};return j});VCO.Point=function(e,t,n){this.x=n?Math.round(e):e;this.y=n?Math.round(t):t};VCO.Point.prototype={add:function(e){return this.clone()._add(e)},_add:function(e){this.x+=e.x;this.y+=e.y;return this},subtract:function(e){return this.clone()._subtract(e)},_subtract:function(e){this.x-=e.x;this.y-=e.y;return this},divideBy:function(e,t){return new VCO.Point(this.x/e,this.y/e,t)},multiplyBy:function(e){return new VCO.Point(this.x*e,this.y*e)},distanceTo:function(e){var t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},clone:function(){return new VCO.Point(this.x,this.y)},toString:function(){return"Point("+VCO.Util.formatNum(this.x)+", "+VCO.Util.formatNum(this.y)+")"}};VCO.DomMixins={show:function(e){e||(this._el.container.style.display="block")},hide:function(e){this._el.container.style.display="none"},addTo:function(e){e.appendChild(this._el.container);this.onAdd()},removeFrom:function(e){e.removeChild(this._el.container);this.onRemove()},animatePosition:function(e,t){var n={duration:this.options.duration,easing:this.options.ease};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]+"px");this.animator&&this.animator.stop();this.animator=VCO.Animate(t,n)},onLoaded:function(){this.fire("loaded",this.data)},onAdd:function(){this.fire("added",this.data)},onRemove:function(){this.fire("removed",this.data)},setPosition:function(e,t){for(var n in e)e.hasOwnProperty(n)&&(t?t.style[n]=e[n]+"px":this._el.container.style[n]=e[n]+"px")},getPosition:function(){return VCO.Dom.getPosition(this._el.container)}};VCO.Dom={get:function(e){return typeof e=="string"?document.getElementById(e):e},getByClass:function(e){if(e)return document.getElementsByClassName(e)},create:function(e,t,n){var r=document.createElement(e);r.className=t;n&&n.appendChild(r);return r},createText:function(e,t){var n=document.createTextNode(e);t&&t.appendChild(n);return n},getTranslateString:function(e){return VCO.Dom.TRANSLATE_OPEN+e.x+"px,"+e.y+"px"+VCO.Dom.TRANSLATE_CLOSE},setPosition:function(e,t){e._vco_pos=t;if(VCO.Browser.webkit3d){e.style[VCO.Dom.TRANSFORM]=VCO.Dom.getTranslateString(t);if(VCO.Browser.android){e.style["-webkit-perspective"]="1000";e.style["-webkit-backface-visibility"]="hidden"}}else{e.style.left=t.x+"px";e.style.top=t.y+"px"}},getPosition:function(e){var t={x:0,y:0};while(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop)){t.x+=e.offsetLeft;t.y+=e.offsetTop;e=e.offsetParent}return t},testProp:function(e){var t=document.documentElement.style;for(var n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}};VCO.Util.extend(VCO.Dom,{TRANSITION:VCO.Dom.testProp(["transition","webkitTransition","OTransition","MozTransition","msTransition"]),TRANSFORM:VCO.Dom.testProp(["transformProperty","WebkitTransform","OTransform","MozTransform","msTransform"]),TRANSLATE_OPEN:"translate"+(VCO.Browser.webkit3d?"3d(":"("),TRANSLATE_CLOSE:VCO.Browser.webkit3d?",0)":")"});VCO.DomUtil={get:function(e){return typeof e=="string"?document.getElementById(e):e},getStyle:function(e,t){var n=e.style[t];!n&&e.currentStyle&&(n=e.currentStyle[t]);if(!n||n==="auto"){var r=document.defaultView.getComputedStyle(e,null);n=r?r[t]:null}return n==="auto"?null:n},getViewportOffset:function(e){var t=0,n=0,r=e,i=document.body;do{t+=r.offsetTop||0;n+=r.offsetLeft||0;if(r.offsetParent===i&&VCO.DomUtil.getStyle(r,"position")==="absolute")break;r=r.offsetParent}while(r);r=e;do{if(r===i)break;t-=r.scrollTop||0;n-=r.scrollLeft||0;r=r.parentNode}while(r);return new VCO.Point(n,t)},create:function(e,t,n){var r=document.createElement(e);r.className=t;n&&n.appendChild(r);return r},disableTextSelection:function(){document.selection&&document.selection.empty&&document.selection.empty();if(!this._onselectstart){this._onselectstart=document.onselectstart;document.onselectstart=VCO.Util.falseFn}},enableTextSelection:function(){document.onselectstart=this._onselectstart;this._onselectstart=null},hasClass:function(e,t){return e.className.length>0&&(new RegExp("(^|\\s)"+t+"(\\s|$)")).test(e.className)},addClass:function(e,t){VCO.DomUtil.hasClass(e,t)||(e.className+=(e.className?" ":"")+t)},removeClass:function(e,t){e.className=e.className.replace(/(\S+)\s*/g,function(e,n){return n===t?"":e}).replace(/^\s+/,"")},setOpacity:function(e,t){VCO.Browser.ie?e.style.filter="alpha(opacity="+Math.round(t*100)+")":e.style.opacity=t},testProp:function(e){var t=document.documentElement.style;for(var n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1},getTranslateString:function(e){return VCO.DomUtil.TRANSLATE_OPEN+e.x+"px,"+e.y+"px"+VCO.DomUtil.TRANSLATE_CLOSE},getScaleString:function(e,t){var n=VCO.DomUtil.getTranslateString(t),r=" scale("+e+") ",i=VCO.DomUtil.getTranslateString(t.multiplyBy(-1));return n+r+i},setPosition:function(e,t){e._vco_pos=t;if(VCO.Browser.webkit3d){e.style[VCO.DomUtil.TRANSFORM]=VCO.DomUtil.getTranslateString(t);if(VCO.Browser.android){e.style["-webkit-perspective"]="1000";e.style["-webkit-backface-visibility"]="hidden"}}else{e.style.left=t.x+"px";e.style.top=t.y+"px"}},getPosition:function(e){return e._vco_pos}};VCO.DomEvent={addListener:function(e,t,n,r){var i=VCO.Util.stamp(n),s="_vco_"+t+i;if(e[s])return;var o=function(t){return n.call(r||e,t||VCO.DomEvent._getEvent())};if(VCO.Browser.touch&&t==="dblclick"&&this.addDoubleTapListener)this.addDoubleTapListener(e,o,i);else if("addEventListener"in e)if(t==="mousewheel"){e.addEventListener("DOMMouseScroll",o,!1);e.addEventListener(t,o,!1)}else if(t==="mouseenter"||t==="mouseleave"){var u=o,a=t==="mouseenter"?"mouseover":"mouseout";o=function(t){if(!VCO.DomEvent._checkMouse(e,t))return;return u(t)};e.addEventListener(a,o,!1)}else e.addEventListener(t,o,!1);else"attachEvent"in e&&e.attachEvent("on"+t,o);e[s]=o},removeListener:function(e,t,n){var r=VCO.Util.stamp(n),i="_vco_"+t+r,s=e[i];if(!s)return;if(VCO.Browser.touch&&t==="dblclick"&&this.removeDoubleTapListener)this.removeDoubleTapListener(e,r);else if("removeEventListener"in e)if(t==="mousewheel"){e.removeEventListener("DOMMouseScroll",s,!1);e.removeEventListener(t,s,!1)}else t==="mouseenter"||t==="mouseleave"?e.removeEventListener(t==="mouseenter"?"mouseover":"mouseout",s,!1):e.removeEventListener(t,s,!1);else"detachEvent"in e&&e.detachEvent("on"+t,s);e[i]=null},_checkMouse:function(e,t){var n=t.relatedTarget;if(!n)return!0;try{while(n&&n!==e)n=n.parentNode}catch(r){return!1}return n!==e},_getEvent:function(){var e=window.event;if(!e){var t=arguments.callee.caller;while(t){e=t.arguments[0];if(e&&window.Event===e.constructor)break;t=t.caller}}return e},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},disableClickPropagation:function(e){VCO.DomEvent.addListener(e,VCO.Draggable.START,VCO.DomEvent.stopPropagation);VCO.DomEvent.addListener(e,"click",VCO.DomEvent.stopPropagation);VCO.DomEvent.addListener(e,"dblclick",VCO.DomEvent.stopPropagation)},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},stop:function(e){VCO.DomEvent.preventDefault(e);VCO.DomEvent.stopPropagation(e)},getWheelDelta:function(e){var t=0;e.wheelDelta&&(t=e.wheelDelta/120);e.detail&&(t=-e.detail/3);return t}};VCO.Draggable=VCO.Class.extend({includes:VCO.Events,_el:{},mousedrag:{down:"mousedown",up:"mouseup",leave:"mouseleave",move:"mousemove"},touchdrag:{down:"touchstart",up:"touchend",leave:"mouseleave",move:"touchmove"},initialize:function(e,t,n){this._el={drag:e,move:e};n&&(this._el.move=n);this.options={enable:{x:!0,y:!0},constraint:{top:!1,bottom:!1,left:!1,right:!1},momentum_multiplier:2e3,duration:1e3,ease:VCO.Ease.easeInOutQuint};this.animator=null;this.dragevent=this.mousedrag;VCO.Browser.touch&&(this.dragevent=this.touchdrag);this.data={sliding:!1,direction:"none",pagex:{start:0,end:0},pagey:{start:0,end:0},pos:{start:{x:0,y:0},end:{x:0,y:0}},new_pos:{x:0,y:0},new_pos_parent:{x:0,y:0},time:{start:0,end:0},touch:!1};VCO.Util.mergeData(this.options,t)},enable:function(e){this.data.pos.start=0;this._el.move.style.left=this.data.pos.start.x+"px";this._el.move.style.top=this.data.pos.start.y+"px";this._el.move.style.position="absolute"},disable:function(){VCO.DomEvent.removeListener(this._el.drag,this.dragevent.down,this._onDragStart,this);VCO.DomEvent.removeListener(this._el.drag,this.dragevent.up,this._onDragEnd,this)},stopMomentum:function(){this.animator&&this.animator.stop()},updateConstraint:function(e){this.options.constraint=e},_onDragStart:function(e){if(VCO.Browser.touch)if(e.originalEvent){this.data.pagex.start=e.originalEvent.touches[0].screenX;this.data.pagey.start=e.originalEvent.touches[0].screenY}else{this.data.pagex.start=e.targetTouches[0].screenX;this.data.pagey.start=e.targetTouches[0].screenY}else{this.data.pagex.start=e.pageX;this.data.pagey.start=e.pageY}this.options.enable.x&&(this._el.move.style.left=this.data.pagex.start-this._el.move.offsetWidth/2+"px");this.options.enable.y&&(this._el.move.style.top=this.data.pagey.start-this._el.move.offsetHeight/2+"px");this.data.pos.start=VCO.Dom.getPosition(this._el.drag);this.data.time.start=(new Date).getTime();this.fire("dragstart",this.data);VCO.DomEvent.addListener(this._el.drag,this.dragevent.move,this._onDragMove,this);VCO.DomEvent.addListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this)},_onDragEnd:function(e){this.data.sliding=!1;VCO.DomEvent.removeListener(this._el.drag,this.dragevent.move,this._onDragMove,this);VCO.DomEvent.removeListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this);this.fire("dragend",this.data);this._momentum()},_onDragMove:function(e){e.preventDefault();this.data.sliding=!0;if(VCO.Browser.touch)if(e.originalEvent){this.data.pagex.end=e.originalEvent.touches[0].screenX;this.data.pagey.end=e.originalEvent.touches[0].screenY}else{this.data.pagex.end=e.targetTouches[0].screenX;this.data.pagey.end=e.targetTouches[0].screenY}else{this.data.pagex.end=e.pageX;this.data.pagey.end=e.pageY}this.data.pos.end=VCO.Dom.getPosition(this._el.drag);this.data.new_pos.x=-(this.data.pagex.start-this.data.pagex.end-this.data.pos.start.x);this.data.new_pos.y=-(this.data.pagey.start-this.data.pagey.end-this.data.pos.start.y);this.options.enable.x&&(this._el.move.style.left=this.data.new_pos.x+"px");this.options.enable.y&&(this._el.move.style.top=this.data.new_pos.y+"px");this.fire("dragmove",this.data)},_momentum:function(){var e={x:0,y:0,time:0},t={x:0,y:0,time:0},n=!1,r="";VCO.Browser.touch;e.time=((new Date).getTime()-this.data.time.start)*10;t.time=((new Date).getTime()-this.data.time.start)*10;t.x=this.options.momentum_multiplier*(Math.abs(this.data.pagex.end)-Math.abs(this.data.pagex.start));t.y=this.options.momentum_multiplier*(Math.abs(this.data.pagey.end)-Math.abs(this.data.pagey.start));e.x=Math.round(t.x/t.time);e.y=Math.round(t.y/t.time);this.data.new_pos.x=Math.min(this.data.pos.end.x+e.x);this.data.new_pos.y=Math.min(this.data.pos.end.y+e.y);this.options.enable.x?this.data.new_pos.x<0&&(this.data.new_pos.x=0):this.data.new_pos.x=this.data.pos.start.x;this.options.enable.y?this.data.new_pos.y<0&&(this.data.new_pos.y=0):this.data.new_pos.y=this.data.pos.start.y;t.time<3e3&&(n=!0);if(Math.abs(t.x)>1e4){this.data.direction="left";t.x>0&&(this.data.direction="right")}if(Math.abs(t.y)>1e4){this.data.direction="up";t.y>0&&(this.data.direction="down")}this._animateMomentum();n&&this.fire("swipe_"+this.data.direction,this.data)},_animateMomentum:function(){var e={x:this.data.new_pos.x,y:this.data.new_pos.y},t={duration:this.options.duration,easing:VCO.Ease.easeOutStrong};if(this.options.enable.y){if(this.options.constraint.top||this.options.constraint.bottom)e.y>this.options.constraint.bottom?e.y=this.options.constraint.bottom:e.y<this.options.constraint.top&&(e.y=this.options.constraint.top);t.top=Math.floor(e.y)+"px"}if(this.options.enable.x){if(this.options.constraint.left||this.options.constraint.right)e.x>this.options.constraint.left?e.x=this.options.constraint.left:e.x<this.options.constraint.right&&(e.x=this.options.constraint.right);t.left=Math.floor(e.x)+"px"}this.animator=VCO.Animate(this._el.move,t);this.fire("momentum",this.data)}});VCO.Swipable=VCO.Class.extend({includes:VCO.Events,_el:{},mousedrag:{down:"mousedown",up:"mouseup",leave:"mouseleave",move:"mousemove"},touchdrag:{down:"touchstart",up:"touchend",leave:"mouseleave",move:"touchmove"},initialize:function(e,t,n){this._el={drag:e,move:e};t&&(this._el.move=t);this.options={snap:!1,enable:{x:!0,y:!0},constraint:{top:!1,bottom:!1,left:0,right:!1},momentum_multiplier:2e3,duration:1e3,ease:VCO.Ease.easeInOutQuint};this.animator=null;this.dragevent=this.mousedrag;VCO.Browser.touch&&(this.dragevent=this.touchdrag);this.data={sliding:!1,direction:"none",pagex:{start:0,end:0},pagey:{start:0,end:0},pos:{start:{x:0,y:0},end:{x:0,y:0}},new_pos:{x:0,y:0},new_pos_parent:{x:0,y:0},time:{start:0,end:0},touch:!1};VCO.Util.mergeData(this.options,n)},enable:function(e){VCO.DomEvent.addListener(this._el.drag,this.dragevent.down,this._onDragStart,this);VCO.DomEvent.addListener(this._el.drag,this.dragevent.up,this._onDragEnd,this);this.data.pos.start=0;this._el.move.style.left=this.data.pos.start.x+"px";this._el.move.style.top=this.data.pos.start.y+"px";this._el.move.style.position="absolute"},disable:function(){VCO.DomEvent.removeListener(this._el.drag,this.dragevent.down,this._onDragStart,this);VCO.DomEvent.removeListener(this._el.drag,this.dragevent.up,this._onDragEnd,this)},stopMomentum:function(){this.animator&&this.animator.stop()},updateConstraint:function(e){this.options.constraint=e},_onDragStart:function(e){this.animator&&this.animator.stop();if(VCO.Browser.touch)if(e.originalEvent){this.data.pagex.start=e.originalEvent.touches[0].screenX;this.data.pagey.start=e.originalEvent.touches[0].screenY}else{this.data.pagex.start=e.targetTouches[0].screenX;this.data.pagey.start=e.targetTouches[0].screenY}else{this.data.pagex.start=e.pageX;this.data.pagey.start=e.pageY}this.options.enable.x;this.options.enable.y;this.data.pos.start={x:this._el.move.offsetLeft,y:this._el.move.offsetTop};this.data.time.start=(new Date).getTime();this.fire("dragstart",this.data);VCO.DomEvent.addListener(this._el.drag,this.dragevent.move,this._onDragMove,this);VCO.DomEvent.addListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this)},_onDragEnd:function(e){this.data.sliding=!1;VCO.DomEvent.removeListener(this._el.drag,this.dragevent.move,this._onDragMove,this);VCO.DomEvent.removeListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this);this.fire("dragend",this.data);this._momentum()},_onDragMove:function(e){var t={x:0,y:0};this.data.sliding=!0;if(VCO.Browser.touch)if(e.originalEvent){this.data.pagex.end=e.originalEvent.touches[0].screenX;this.data.pagey.end=e.originalEvent.touches[0].screenY}else{this.data.pagex.end=e.targetTouches[0].screenX;this.data.pagey.end=e.targetTouches[0].screenY}else{this.data.pagex.end=e.pageX;this.data.pagey.end=e.pageY}t.x=this.data.pagex.start-this.data.pagex.end;t.y=this.data.pagey.start-this.data.pagey.end;this.data.pos.end={x:this._el.drag.offsetLeft,y:this._el.drag.offsetTop};this.data.new_pos.x=-(t.x-this.data.pos.start.x);this.data.new_pos.y=-(t.y-this.data.pos.start.y);if(this.options.enable.x&&Math.abs(t.x)>Math.abs(t.y)){e.preventDefault();this._el.move.style.left=this.data.new_pos.x+"px"}if(this.options.enable.y&&Math.abs(t.y)>Math.abs(t.y)){e.preventDefault();this._el.move.style.top=this.data.new_pos.y+"px"}this.fire("dragmove",this.data)},_momentum:function(){var e={x:0,y:0,time:0},t={x:0,y:0,time:0},n={x:!1,y:!1},r=!1,i="";this.data.direction=null;e.time=((new Date).getTime()-this.data.time.start)*10;t.time=((new Date).getTime()-this.data.time.start)*10;t.x=this.options.momentum_multiplier*(Math.abs(this.data.pagex.end)-Math.abs(this.data.pagex.start));t.y=this.options.momentum_multiplier*(Math.abs(this.data.pagey.end)-Math.abs(this.data.pagey.start));e.x=Math.round(t.x/t.time);e.y=Math.round(t.y/t.time);this.data.new_pos.x=Math.min(this.data.pos.end.x+e.x);this.data.new_pos.y=Math.min(this.data.pos.end.y+e.y);this.options.enable.x?this.data.new_pos.x>0&&(this.data.new_pos.x=0):this.data.new_pos.x=this.data.pos.start.x;this.options.enable.y?this.data.new_pos.y<0&&(this.data.new_pos.y=0):this.data.new_pos.y=this.data.pos.start.y;t.time<2e3&&(r=!0);this.options.enable.x&&this.options.enable.y?Math.abs(t.x)>Math.abs(t.y)?n.x=!0:n.y=!0:this.options.enable.x?Math.abs(t.x)>Math.abs(t.y)&&(n.x=!0):Math.abs(t.y)>Math.abs(t.x)&&(n.y=!0);if(n.x){Math.abs(t.x)>this._el.drag.offsetWidth/2&&(r=!0);if(Math.abs(t.x)>1e4){this.data.direction="left";t.x>0&&(this.data.direction="right")}}if(n.y){Math.abs(t.y)>this._el.drag.offsetHeight/2&&(r=!0);if(Math.abs(t.y)>1e4){this.data.direction="up";t.y>0&&(this.data.direction="down")}}this._animateMomentum();if(r&&this.data.direction)this.fire("swipe_"+this.data.direction,this.data);else if(this.data.direction)this.fire("swipe_nodirection",this.data);else if(this.options.snap){this.animator.stop();this.animator=VCO.Animate(this._el.move,{top:this.data.pos.start.y,left:this.data.pos.start.x,duration:this.options.duration,easing:VCO.Ease.easeOutStrong})}},_animateMomentum:function(){var e={x:this.data.new_pos.x,y:this.data.new_pos.y},t={duration:this.options.duration,easing:VCO.Ease.easeOutStrong};if(this.options.enable.y){if(this.options.constraint.top||this.options.constraint.bottom)e.y>this.options.constraint.bottom?e.y=this.options.constraint.bottom:e.y<this.options.constraint.top&&(e.y=this.options.constraint.top);t.top=Math.floor(e.y)+"px"}if(this.options.enable.x){if(this.options.constraint.left||this.options.constraint.right)e.x>=this.options.constraint.left?e.x=this.options.constraint.left:e.x<this.options.constraint.right&&(e.x=this.options.constraint.right);t.left=Math.floor(e.x)+"px"}this.animator=VCO.Animate(this._el.move,t);this.fire("momentum",this.data)}});VCO.MenuBar=VCO.Class.extend({includes:[VCO.Events,VCO.DomMixins],_el:{},initialize:function(e,t,n){this._el={parent:{},container:{},button_overview:{},button_backtostart:{},button_collapse_toggle:{},arrow:{},line:{},coverbar:{},grip:{}};this.collapsed=!1;typeof e=="object"?this._el.container=e:this._el.container=VCO.Dom.get(e);t&&(this._el.parent=t);this.options={width:600,height:600,duration:1e3,ease:VCO.Ease.easeInOutQuint,menubar_default_y:0};this.animator={};VCO.Util.mergeData(this.options,n);this._initLayout();this._initEvents()},show:function(e){var t=this.options.duration;e&&(t=e)},hide:function(e){},setSticky:function(e){this.options.menubar_default_y=e},setColor:function(e){e?this._el.container.className="vco-menubar vco-menubar-inverted":this._el.container.className="vco-menubar"},updateDisplay:function(e,t,n,r){this._updateDisplay(e,t,n,r)},_onButtonOverview:function(e){this.fire("overview",e)},_onButtonBackToStart:function(e){this.fire("back_to_start",e)},_onButtonCollapseMap:function(e){if(this.collapsed){this.collapsed=!1;this.show();this._el.button_overview.style.display="inline";this.fire("collapse",{y:this.options.menubar_default_y});VCO.Browser.mobile?this._el.button_collapse_toggle.innerHTML="<span class='vco-icon-arrow-up'></span>":this._el.button_collapse_toggle.innerHTML=VCO.Language.buttons.collapse_toggle+"<span class='vco-icon-arrow-up'></span>"}else{this.collapsed=!0;this.hide(25);this._el.button_overview.style.display="none";this.fire("collapse",{y:1});VCO.Browser.mobile?this._el.button_collapse_toggle.innerHTML="<span class='vco-icon-arrow-down'></span>":this._el.button_collapse_toggle.innerHTML=VCO.Language.buttons.uncollapse_toggle+"<span class='vco-icon-arrow-down'></span>"}},_initLayout:function(){this._el.button_overview=VCO.Dom.create("span","vco-menubar-button",this._el.container);VCO.DomEvent.addListener(this._el.button_overview,"click",this._onButtonOverview,this);this._el.button_backtostart=VCO.Dom.create("span","vco-menubar-button",this._el.container);VCO.DomEvent.addListener(this._el.button_backtostart,"click",this._onButtonBackToStart,this);this._el.button_collapse_toggle=VCO.Dom.create("span","vco-menubar-button",this._el.container);VCO.DomEvent.addListener(this._el.button_collapse_toggle,"click",this._onButtonCollapseMap,this);this.options.map_as_image?this._el.button_overview.innerHTML=VCO.Language.buttons.overview:this._el.button_overview.innerHTML=VCO.Language.buttons.map_overview;if(VCO.Browser.mobile){this._el.button_backtostart.innerHTML="<span class='vco-icon-goback'></span>";this._el.button_collapse_toggle.innerHTML="<span class='vco-icon-arrow-up'></span>";this._el.container.setAttribute("ontouchstart"," ")}else{this._el.button_backtostart.innerHTML=VCO.Language.buttons.backtostart+" <span class='vco-icon-goback'></span>";this._el.button_collapse_toggle.innerHTML=VCO.Language.buttons.collapse_toggle+"<span class='vco-icon-arrow-up'></span>"}this.options.layout=="landscape"&&(this._el.button_collapse_toggle.style.display="none")},_initEvents:function(){},_updateDisplay:function(e,t,n){e&&(this.options.width=e);t&&(this.options.height=t)}});VCO.Message=VCO.Class.extend({includes:[VCO.Events,VCO.DomMixins],_el:{},initialize:function(e,t,n){this._el={parent:{},container:{},message_container:{},loading_icon:{},message:{}};this.options={width:600,height:600,message_class:"vco-message",message_icon_class:"vco-loading-icon"};VCO.Util.mergeData(this.data,e);VCO.Util.mergeData(this.options,t);this._el.container=VCO.Dom.create("div",this.options.message_class);if(n){n.appendChild(this._el.container);this._el.parent=n}this.animator={};this._initLayout();this._initEvents()},updateMessage:function(e){this._updateMessage(e)},updateDisplay:function(e,t){this._updateDisplay(e,t)},_updateMessage:function(e){e?this._el.message.innerHTML=e:VCO.Language?this._el.message.innerHTML=VCO.Language.messages.loading:this._el.message.innerHTML="Loading"},_onMouseClick:function(){this.fire("clicked",this.options)},_initLayout:function(){this._el.message_container=VCO.Dom.create("div","vco-message-container",this._el.container);this._el.loading_icon=VCO.Dom.create("div",this.options.message_icon_class,this._el.message_container);this._el.message=VCO.Dom.create("div","vco-message-content",this._el.message_container);this._updateMessage()},_initEvents:function(){VCO.DomEvent.addListener(this._el.container,"click",this._onMouseClick,this)},_updateDisplay:function(e,t,n){}});VCO.MediaType=function(e){var t={},n=[{type:"youtube",name:"YouTube",match_str:"(www.)?youtube|youtu.be"
,cls:VCO.Media.YouTube},{type:"vimeo",name:"Vimeo",match_str:"(player.)?vimeo.com",cls:VCO.Media.Vimeo},{type:"dailymotion",name:"DailyMotion",match_str:"(www.)?dailymotion.com",cls:VCO.Media.DailyMotion},{type:"vine",name:"Vine",match_str:"(www.)?vine.co",cls:VCO.Media.Vine},{type:"soundcloud",name:"SoundCloud",match_str:"(player.)?soundcloud.com",cls:VCO.Media.SoundCloud},{type:"twitter",name:"Twitter",match_str:"(www.)?twitter.com",cls:VCO.Media.Twitter},{type:"googlemaps",name:"Google Map",match_str:"maps.google",cls:VCO.Media.Map},{type:"googleplus",name:"Google+",match_str:"plus.google",cls:VCO.Media.GooglePlus},{type:"flickr",name:"Flickr",match_str:"flickr.com/photos",cls:VCO.Media.Flickr},{type:"instagram",name:"Instagram",match_str:/(instagr.am|instagram.com)\/p/,cls:VCO.Media.Instagram},{type:"image",name:"Image",match_str:/jpg|jpeg|png|gif/i,cls:VCO.Media.Image},{type:"googledocs",name:"Google Doc",match_str:/\b.(doc|docx|xls|xlsx|ppt|pptx|pdf|pages|ai|psd|tiff|dxf|svg|eps|ps|ttf|xps|zip|tif)\b/,cls:VCO.Media.GoogleDoc},{type:"wikipedia",name:"Wikipedia",match_str:"(www.)?wikipedia.org",cls:VCO.Media.Wikipedia},{type:"iframe",name:"iFrame",match_str:"iframe",cls:VCO.Media.IFrame},{type:"storify",name:"Storify",match_str:"storify",cls:VCO.Media.Storify},{type:"blockquote",name:"Quote",match_str:"blockquote",cls:VCO.Media.Blockquote},{type:"website",name:"Website",match_str:"http://",cls:VCO.Media.Website},{type:"",name:"",match_str:"",cls:VCO.Media}];for(var r=0;r<n.length;r++){if(e instanceof Array)return t={type:"slider",cls:VCO.Media.Slider};if(e.url.match(n[r].match_str)){t=n[r];t.url=e.url;return t}}return!1};VCO.Media=VCO.Class.extend({includes:[VCO.Events],_el:{},initialize:function(e,t,n){this._el={container:{},content_container:{},content:{},content_item:{},caption:null,credit:null,parent:{},link:null};this.player=null;this.timer=null;this.load_timer=null;this.message=null;this.media_id=null;this._state={loaded:!1};this.data={uniqueid:null,url:null,credit:null,caption:null,link:null,link_target:null};this.options={api_key_flickr:"f2cc870b4d233dd0a5bfe73fd0d64ef0",credit_height:0,caption_height:0};this.animator={};VCO.Util.mergeData(this.options,t);VCO.Util.mergeData(this.data,e);this._el.container=VCO.Dom.create("div","vco-media");this._el.container.id=this.data.uniqueid;this._initLayout();if(n){n.appendChild(this._el.container);this._el.parent=n}},loadMedia:function(){var e=this;if(!this._state.loaded)try{this.load_timer=setTimeout(function(){e._loadMedia();e._state.loaded=!0;e._updateDisplay()},1200)}catch(t){trace("Error loading media for ",this._media);trace(t)}},updateMediaDisplay:function(e){if(this._state.loaded){this._updateMediaDisplay(e);this._el.content_item.style.maxHeight=this.options.height/2+"px";VCO.Browser.firefox&&this._el.content_item.offsetWidth>this._el.content_item.offsetHeight&&(this._el.content_item.style.width="100%")}},_loadMedia:function(){},_updateMediaDisplay:function(e){},show:function(){},hide:function(){},addTo:function(e){e.appendChild(this._el.container);this.onAdd()},removeFrom:function(e){e.removeChild(this._el.container);this.onRemove()},updateDisplay:function(e,t,n){this._updateDisplay(e,t,n)},stopMedia:function(){this._stopMedia()},loadErrorDisplay:function(e){this._el.content.removeChild(this._el.content_item);this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-loaderror",this._el.content);this._el.content_item.innerHTML=e+"<br/><span class='vco-icon-"+this.options.media_type+"'></span>";this.message&&this.message.hide()},onLoaded:function(){this._state.loaded=!0;this.fire("loaded",this.data);this.message&&this.message.hide();this.showMeta();this.updateDisplay()},showMeta:function(){if(this.data.credit&&this.data.credit!=""){this._el.credit=VCO.Dom.create("div","vco-credit",this._el.content_container);this._el.credit.innerHTML=this.data.credit;this.options.credit_height=this._el.credit.offsetHeight}if(this.data.caption&&this.data.caption!=""){this._el.caption=VCO.Dom.create("div","vco-caption",this._el.content_container);this._el.caption.innerHTML=this.data.caption;this.options.caption_height=this._el.caption.offsetHeight}},onAdd:function(){this.fire("added",this.data)},onRemove:function(){this.fire("removed",this.data)},_initLayout:function(){this.message=new VCO.Message({},this.options);this.message.addTo(this._el.container);this._el.content_container=VCO.Dom.create("div","vco-media-content-container",this._el.container);if(this.data.link&&this.data.link!=""){this._el.link=VCO.Dom.create("a","vco-media-link",this._el.content_container);this._el.link.href=this.data.link;this.data.link_target&&this.data.link_target!=""?this._el.link.target=this.data.link_target:this._el.link.target="_blank";this._el.content=VCO.Dom.create("div","vco-media-content",this._el.link)}else this._el.content=VCO.Dom.create("div","vco-media-content",this._el.content_container)},_updateDisplay:function(e,t,n){e&&(this.options.width=e);t&&(this.options.height=t);n&&(this.options.layout=n);this._el.credit&&(this.options.credit_height=this._el.credit.offsetHeight);this._el.caption&&(this.options.caption_height=this._el.caption.offsetHeight+5);this.updateMediaDisplay(this.options.layout)},_stopMedia:function(){}});VCO.Media.Blockquote=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-blockquote",this._el.content);this.media_id=this.data.url;this._el.content_item.innerHTML=this.media_id;this.onLoaded()},updateMediaDisplay:function(){},_updateMediaDisplay:function(){}});VCO.Media.Flickr=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("img","vco-media-item vco-media-image vco-media-flickr vco-media-shadow",this._el.content);this.establishMediaID();e="http://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key="+this.options.api_key_flickr+"&photo_id="+this.media_id+"&format=json&jsoncallback=?";VCO.getJSON(e,function(e){e.stat=="ok"?t.createMedia(e):t.loadErrorDisplay("Photo not found or private.")})},establishMediaID:function(){var e="flickr.com/photos/",t=this.data.url.indexOf(e);if(t==-1)throw"Invalid Flickr URL";var n=t+e.length;this.media_id=this.data.url.substr(n).split("/")[1]},createMedia:function(e){var t=this.sizes(this.options.height),n=e.sizes.size[e.sizes.size.length-2].source;for(var r=0;r<e.sizes.size.length;r++)e.sizes.size[r].label==t&&(n=e.sizes.size[r].source);this._el.content_item.src=n;this.onLoaded()},sizes:function(e){var t="";e<=75?e<=0?t="Large":t="Thumbnail":e<=180?t="Small":e<=240?t="Small 320":e<=375?t="Medium":e<=480?t="Medium 640":e<=600?t="Large":t="Large";return t}});VCO.Media.Instagram=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this.media_id=this.data.url.split("/p/")[1].split("/")[0];this._el.content_item=VCO.Dom.create("img","vco-media-item vco-media-image vco-media-instagram vco-media-shadow",this._el.content);this._el.content_item.src="http://instagr.am/p/"+this.media_id+"/media/?size="+this.sizes(this._el.content.offsetWidth);this.onLoaded()},sizes:function(e){var t="";e<=150?t="t":e<=306?t="m":t="l";return t}});VCO.Media.GoogleDoc=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe",this._el.content);this.media_id=this.data.url;e=this.media_id;this.media_id.match(/docs.google.com/i)?this._el.content_item.innerHTML="<iframe class='doc' frameborder='0' width='100%' height='100%' src='"+this.media_id+"&amp;embedded=true'></iframe>":this._el.content_item.innerHTML="<iframe class='doc' frameborder='0' width='100%' height='100%' src='http://docs.google.com/viewer?url="+this.media_id+"&amp;embedded=true'></iframe>";this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}});VCO.Media.GooglePlus=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-googleplus",this._el.content);this.media_id=this.data.url;e=this.media_id;this._el.content_item.innerHTML="<iframe frameborder='0' width='100%' height='100%' src='"+e+"'></iframe>";this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}});VCO.Media.IFrame=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe",this._el.content);this.media_id=this.data.url;e=this.media_id;this._el.content_item.innerHTML=e;this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}});VCO.Media.Image=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("img","vco-media-item vco-media-image vco-media-shadow",this._el.content);this._el.content_item.src=this.data.url;this.onLoaded()},_updateMediaDisplay:function(e){VCO.Browser.firefox&&(this._el.content_item.style.maxWidth=this.options.width/2-40+"px")}});VCO.Media.SoundCloud=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe vco-media-soundcloud vco-media-shadow",this._el.content);this.media_id=this.data.url;e="http://soundcloud.com/oembed?url="+this.media_id+"&format=js&callback=?";VCO.getJSON(e,function(e){t.createMedia(e)})},createMedia:function(e){this._el.content_item.innerHTML=e.html;this.onLoaded()}});VCO.Media.Storify=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe vco-media-storify",this._el.content);this.media_id=this.data.url;e="<iframe frameborder='0' width='100%' height='100%' src='"+this.media_id+"/embed'></iframe>";e+="<script src='"+this.media_id+".js'></script>";this._el.content_item.innerHTML=e;this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}});VCO.Media.Text=VCO.Class.extend({includes:[VCO.Events],_el:{container:{},content_container:{},content:{},headline:{}},data:{uniqueid:"",headline:"headline",text:"text"},options:{title:!1},initialize:function(e,t,n){VCO.Util.setData(this,e);VCO.Util.mergeData(this.options,t);this._el.container=VCO.Dom.create("div","vco-text");this._el.container.id=this.data.uniqueid;this._initLayout();n&&n.appendChild(this._el.container)},show:function(){},hide:function(){},addTo:function(e){e.appendChild(this._el.container)},removeFrom:function(e){e.removeChild(this._el.container)},headlineHeight:function(){return this._el.headline.offsetHeight+40},onLoaded:function(){this.fire("loaded",this.data)},onAdd:function(){this.fire("added",this.data)},onRemove:function(){this.fire("removed",this.data)},_initLayout:function(){this._el.content_container=VCO.Dom.create("div","vco-text-content-container",this._el.container);if(this.data.headline!=""){var e="vco-headline";this.options.title&&(e="vco-headline vco-headline-title");this._el.headline=VCO.Dom.create("h2",e,this._el.content_container);this._el.headline.innerHTML=this.data.headline}if(this.data.text!=""){this._el.content=VCO.Dom.create("div","vco-text-content",this._el.content_container);this._el.content.innerHTML=VCO.Util.htmlify(this.data.text)}this.onLoaded()}});VCO.Media.Twitter=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("div","vco-media-twitter",this._el.content);this.data.url.match("status/")?this.media_id=this.data.url.split("status/")[1]:url.match("statuses/")?this.media_id=this.data.url.split("statuses/")[1]:this.media_id="";e="https://api.twitter.com/1/statuses/oembed.json?id="+this.media_id+"&omit_script=true&include_entities=true&callback=?";VCO.getJSON(e,function(e){t.createMedia(e)})},createMedia:function(e){var t="",n="",r="",i="",s="",o="";n=e.html.split("</p>&mdash;")[0]+"</p></blockquote>";r=e.author_url.split("twitter.com/")[1];i=e.html.split("</p>&mdash;")[1].split('<a href="')[1];s=i.split('">')[0];o=i.split('">')[1].split("</a>")[0];t+=n;t+="<div class='vcard'>";t+="<a href='"+s+"' class='twitter-date' target='_blank'>"+o+"</a>";t+="<div class='author'>";t+="<a class='screen-name url' href='"+e.author_url+"' target='_blank'>";t+="<span class='avatar'></span>";t+="<span class='fn'>"+e.author_name+" <span class='vco-icon-twitter'></span></span>";t+="<span class='nickname'>@"+r+"<span class='thumbnail-inline'></span></span>";t+="</a>";t+="</div>";t+="</div>";this._el.content_item.innerHTML=t;this.onLoaded()},updateMediaDisplay:function(){},_updateMediaDisplay:function(){}});VCO.Media.Vimeo=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe vco-media-vimeo vco-media-shadow",this._el.content);this.media_id=this.data.url.split(/video\/|\/\/vimeo\.com\//)[1].split(/[?&]/)[0];e="http://player.vimeo.com/video/"+this.media_id+"?api=1&title=0&amp;byline=0&amp;portrait=0&amp;color=ffffff";this.player=VCO.Dom.create("iframe","",this._el.content_item);this.player.width="100%";this.player.height="100%";this.player.frameBorder="0";this.player.src=e;this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=VCO.Util.ratio.r16_9({w:this._el.content_item.offsetWidth})+"px"},_stopMedia:function(){try{this.player.contentWindow.postMessage(JSON.stringify({method:"pause"}),"http://player.vimeo.com")}catch(e){trace(e)}}});VCO.Media.DailyMotion=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe vco-media-dailymotion",this._el.content);this.data.url.match("video")?this.media_id=this.data.url.split("video/")[1].split(/[?&]/)[0]:this.media_id=this.data.url.split("embed/")[1].split(/[?&]/)[0];e="http://www.dailymotion.com/embed/video/"+this.media_id;this._el.content_item.innerHTML="<iframe autostart='false' frameborder='0' width='100%' height='100%' src='"+e+"'></iframe>";this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=VCO.Util.ratio.r16_9({w:this._el.content_item.offsetWidth})+"px"}});VCO.Media.Vine=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe vco-media-vine vco-media-shadow",this._el.content);this.media_id=this.data.url.split("vine.co/v/")[1];e="https://vine.co/v/"+this.media_id+"/embed/simple";this._el.content_item.innerHTML="<iframe frameborder='0' width='100%' height='100%' src='"+e+"'></iframe><script async src='http://platform.vine.co/static/scripts/embed.js' charset='utf-8'></script>";this.onLoaded()},_updateMediaDisplay:function(){var e=VCO.Util.ratio.square({w:this._el.content_item.offsetWidth,h:this.options.height});this._el.content_item.style.height=e.h+"px"}});VCO.Media.Website=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){},createMedia:function(e){this.onLoaded()}});VCO.Media.Wikipedia=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t,n=this;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-wikipedia",this._el.content);this.media_id=this.data.url.split("wiki/")[1].split("#")[0].replace("_"," ");this.media_id=this.media_id.replace(" ","%20");t=this.data.url.split("//")[1].split(".wikipedia")[0];e="http://"+t+".wikipedia.org/w/api.php?action=query&prop=extracts&redirects=&titles="+this.media_id+"&exintro=1&format=json&callback=?";VCO.getJSON(e,function(e){n.createMedia(e)})},createMedia:function(e){var t="";if(e.query){var n,t={entry:{},title:"",text:"",extract:"",paragraphs:1,text_array:[]};t.entry=VCO.Util.getObjectAttributeByIndex(e.query.pages,0);t.extract=t.entry.extract;t.title=t.entry.title;t.extract.match("<p>")?t.text_array=t.extract.split("<p>"):t.text_array.push(t.extract);for(var r=0;r<t.text_array.length;r++)r+1<=t.paragraphs&&r+1<t.text_array.length&&(t.text+="<p>"+t.text_array[r+1]);n="<h4><a href='"+this.data.url+"' target='_blank'>"+t.title+"</a></h4>";n+="<span class='wiki-source'>"+VCO.Language.messages.wikipedia+"</span>";n+=t.text;if(!t.extract.match("REDIRECT")){this._el.content_item.innerHTML=n;this.onLoaded()}}},updateMediaDisplay:function(){},_updateMediaDisplay:function(){}});VCO.Media.YouTube=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e=this,t;this.message.updateMessage(VCO.Language.messages.loading+" "+this.options.media_name);this.youtube_loaded=!1;this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-youtube vco-media-shadow",this._el.content);this._el.content_item.id=VCO.Util.unique_ID(7);t=VCO.Util.getUrlVars(this.data.url);this.media_id={};this.data.url.match("v=")?this.media_id.id=t.v:this.data.url.match("/embed/")?this.media_id.id=this.data.url.split("embed/")[1].split(/[?&]/)[0]:this.data.url.match(/v\/|v=|youtu\.be\//)?this.media_id.id=this.data.url.split(/v\/|v=|youtu\.be\//)[1].split(/[?&]/)[0]:trace("YOUTUBE IN URL BUT NOT A VALID VIDEO");this.media_id.start=t.t;this.media_id.hd=t.hd;VCO.Load.js("https://www.youtube.com/player_api",function(){e.createMedia()})},_updateMediaDisplay:function(){this._el.content_item.style.height=VCO.Util.ratio.r16_9({w:this._el.content_item.offsetWidth})+"px"},_stopMedia:function(){if(this.youtube_loaded)try{this.player.pauseVideo()}catch(e){trace(e)}},createMedia:function(){var e=this;if(typeof this.media_id.start!="undefined"){var t=this.media_id.start.toString(),n=0,r=0;if(t.match("m")){n=parseInt(t.split("m")[0],10);r=parseInt(t.split("m")[1].split("s")[0],10);this.media_id.start=n*60+r}else this.media_id.start=0}else this.media_id.start=0;typeof this.media_id.hd!="undefined"?this.media_id.hd=!0:this.media_id.hd=!1;this.createPlayer()},createPlayer:function(){var e=this;clearTimeout(this.timer);typeof YT!="undefined"&&typeof YT.Player!="undefined"?this.player=new YT.Player(this._el.content_item.id,{playerVars:{enablejsapi:1,color:"white",showinfo:0,theme:"light",start:this.media_id.start,rel:0},videoId:this.media_id.id,events:{onReady:function(){e.onPlayerReady();e.onLoaded()},onStateChange:e.onStateChange}}):this.timer=setTimeout(function(){e.createPlayer()},1e3)},onPlayerReady:function(e){this.youtube_loaded=!0},onStateChange:function(e){}});VCO.Media.Slider=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){this._el.content_item=VCO.Dom.create("img","vco-media-item vco-media-image",this._el.content);this._el.content_item.src=this.data.url;this.onLoaded()}});VCO.Slide=VCO.Class.extend({includes:[VCO.Events,VCO.DomMixins],_el:{},initialize:function(e,t,n){this._el={container:{},scroll_container:{},background:{},content_container:{},content:{}};this._media=null;this._mediaclass={};this._text={};this._state={loaded:!1};this.has={headline:!1,text:!1,media:!1,title:!1,background:{image:!1,color:!1,color_value:"#FFF"}};this.has.title=n;this.data={uniqueid:null,background:null,date:null,location:null,text:null,media:null};this.options={duration:1e3,slide_padding_lr:40,ease:VCO.Ease.easeInSpline,width:600,height:600,skinny_size:650,media_name:""};this.active=!1;this.animator={};VCO.Util.mergeData(this.options,t);VCO.Util.mergeData(this.data,e);this._initLayout();this._initEvents()},show:function(){trace("show");this.animator=VCO.Animate(this._el.slider_container,{left:-(this._el.container.offsetWidth*n)+"px",duration:this.options.duration,easing:this.options.ease})},hide:function(){},setActive:function(e){this.active=e;if(this.active){this.data.background&&this.fire("background_change",this.has.background);this.loadMedia()}else this.stopMedia()},addTo:function(e){e.appendChild(this._el.container)},removeFrom:function(e){e.removeChild(this._el.container)},updateDisplay:function(e,t,n){this._updateDisplay(e,t,n)},loadMedia:function(){if(this._media&&!this._state.loaded){this._media.loadMedia();this._state.loaded=!0}},stopMedia:function(){this._media&&this._state.loaded&&this._media.stopMedia()},getBackground:function(){return this.has.background},scrollToTop:function(){this._el.container.scrollTop=0},_initLayout:function(){this._el.container=VCO.Dom.create("div","vco-slide");this.data.uniqueid&&(this._el.container.id=this.data.uniqueid);this._el.scroll_container=VCO.Dom.create("div","vco-slide-scrollable-container",this._el.container);this._el.content_container=VCO.Dom.create("div","vco-slide-content-container",this._el.scroll_container);this._el.content=VCO.Dom.create("div","vco-slide-content",this._el.content_container);this._el.background=VCO.Dom.create("div","vco-slide-background",this._el.container);if(this.data.background){if(this.data.background.url){this.has.background.image=!0;this._el.container.className+=" vco-full-image-background";this.has.background.color_value="#000";this._el.background.style.backgroundImage="url('"+this.data.background.url+"')";this._el.background.style.display="block"}if(this.data.background.color){this.has.background.color=!0;this._el.container.className+=" vco-full-color-background";this.has.background.color_value=this.data.background.color}this.data.background.text_background&&(this._el.container.className+=" vco-text-background")}this.data.media&&this.data.media.url&&this.data.media.url!=""&&(this.has.media=!0);this.data.text&&this.data.text.text&&(this.has.text=!0);this.data.text&&this.data.text.headline&&(this.has.headline=!0);if(this.has.media){this.data.media.mediatype=VCO.MediaType(this.data.media);this.options.media_name=this.data.media.mediatype.name;this.options.media_type=this.data.media.mediatype.type;this._media=new this.data.media.mediatype.cls(this.data.media,this.options)}if(this.has.text||this.has.headline)this._text=new VCO.Media.Text(this.data.text,{title:this.has.title});if(!this.has.text&&!this.has.headline&&this.has.media){this._el.container.className+=" vco-slide-media-only";this._media.addTo(this._el.content)}else if(this.has.headline&&this.has.media&&!this.has.text){this._el.container.className+=" vco-slide-media-only";this._text.addTo(this._el.content);this._media.addTo(this._el.content)}else if(this.has.text&&this.has.media){this._media.addTo(this._el.content);this._text.addTo(this._el.content)}else if(this.has.text||this.has.headline){this._el.container.className+=" vco-slide-text-only";this._text.addTo(this._el.content)}this.onLoaded()},_initEvents:function(){},_updateDisplay:function(e,t,n){e?this.options.width=e:this.options.width=this._el.container.offsetWidth;if(VCO.Browser.mobile&&this.options.width<=this.options.skinny_size){this._el.content.style.paddingLeft="0px";this._el.content.style.paddingRight="0px";this._el.content.style.width=this.options.width-0+"px"}else if(n=="landscape"){this._el.content.style.paddingLeft="40px";this._el.content.style.paddingRight="75px";this._el.content.style.width=this.options.width-115+"px"}else if(this.options.width<=this.options.skinny_size){this._el.content.style.paddingLeft=this.options.slide_padding_lr+"px";this._el.content.style.paddingRight=this.options.slide_padding_lr+"px";this._el.content.style.width=this.options.width-this.options.slide_padding_lr*2+"px"}else{this._el.content.style.paddingLeft=this.options.slide_padding_lr+"px";this._el.content.style.paddingRight=this.options.slide_padding_lr+"px";this._el.content.style.width=this.options.width-this.options.slide_padding_lr*2+"px"}t?this.options.height=t:this.options.height=this._el.container.offsetHeight;this._media&&(!this.has.text&&this.has.headline?this._media.updateDisplay(this.options.width,this.options.height-this._text.headlineHeight(),n):this._media.updateDisplay(this.options.width,this.options.height,n))}});VCO.SlideNav=VCO.Class.extend({includes:[VCO.Events,VCO.DomMixins],_el:{},initialize:function(e,t,n){this._el={container:{},content_container:{},icon:{},title:{},description:{}};this.mediatype={};this.data={title:"Navigation",description:"Description"};this.options={direction:"previous"};this.animator=null;VCO.Util.mergeData(this.options,t);VCO.Util.mergeData(this.data,e);this._el.container=VCO.Dom.create("div","vco-slidenav-"+this.options.direction);VCO.Browser.mobile&&this._el.container.setAttribute("ontouchstart"," ");this._initLayout();this._initEvents();n&&n.appendChild(this._el.container)},update:function(e){this._update(e)},setColor:function(e){e?this._el.content_container.className="vco-slidenav-content-container vco-slidenav-inverted":this._el.content_container.className="vco-slidenav-content-container"},_onMouseClick:function(){this.fire("clicked",this.options)},_update:function(e){this.data=VCO.Util.mergeData(this.data,e);this.data.title!=""&&(this._el.title.innerHTML=this.data.title);this.data.date!=""&&(this._el.description.innerHTML=this.data.description)},_initLayout:function(){this._el.content_container=VCO.Dom.create("div","vco-slidenav-content-container",this._el.container);this._el.icon=VCO.Dom.create("div","vco-slidenav-icon",this._el.content_container);this._el.title=VCO.Dom.create("div","vco-slidenav-title",this._el.content_container);this._el.description=VCO.Dom.create("div","vco-slidenav-description",this._el.content_container);this._el.icon.innerHTML="&nbsp;";this._update()},_initEvents:function(){VCO.DomEvent.addListener(this._el.container,"click",this._onMouseClick,this)}});VCO.StorySlider=VCO.Class.extend({includes:VCO.Events,initialize:function(e,t,n,r){this._el={container:{},background:{},slider_container_mask:{},slider_container:{},slider_item_container:{}};this._nav={};this._nav.previous={};this._nav.next={};this.slide_spacing=0;this._slides=[];this._swipable;this.preloadTimer;this._message;this.current_slide=0;this.data={uniqueid:"",slides:[{uniqueid:"",background:{url:null,color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"Slideshow Example",text:"Example slideshow slide "},media:[{uniqueid:"",text:{headline:"Slideshow Example",text:""},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"",caption:"",link:null,link_target:null}},{uniqueid:"",text:{headline:"Slideshow Example",text:""},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"",caption:"",link:null,link_target:null}},{uniqueid:"",text:{headline:"Slideshow Example",text:""},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"",caption:"",link:null,link_target:null}},{uniqueid:"",text:{headline:"Slideshow Example",text:""},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"",caption:"",link:null,link_target:null}}]},{uniqueid:"",background:{url:null,color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"YouTube",text:"Just add a link to the video in the media field."},media:{url:"http://www.youtube.com/watch?v=lIvftGgps24",credit:"",caption:"",link:null,link_target:null}}]};this.options={id:"",layout:"portrait",width:600,height:600,slide_padding_lr:40,start_at_slide:1,slide_default_fade:"0%",duration:1e3,ease:VCO.Ease.easeInOutQuint,dragging:!0,trackResize:!0};if(typeof e=="object"){this._el.container=e;this.options.id=VCO.Util.unique_ID(6,"vco")}else{this.options.id=e;this._el.container=VCO.Dom.get(e)}this._el.container.id||(this._el.container.id=this.options.id);this.animator=null;VCO.Util.mergeData(this.options,n);VCO.Util.mergeData(this.data,t);r&&this.init()},init:function(){this._initLayout();this._initEvents();this._initData();this._updateDisplay();this.goTo(this.options.start_at_slide);this._onLoaded()},updateDisplay:function(e,t,n,r){this._updateDisplay(e,t,n,r)},createSlide:function(e){this._createSlide(e)},createSlides:function(e){this._createSlides(e)},_createSlides:function(e){for(var t=0;t<e.length;t++){e[t].uniqueid==""&&(e[t].uniqueid=VCO.Util.unique_ID(6,"vco-slide"));t==0?this._createSlide(e[t],!0):this._createSlide(e[t],!1)}},_createSlide:function(e,t){var n=new VCO.Slide(e,this.options,t);this._addSlide(n);this._slides.push(n)},_destroySlide:function(e){this._removeSlide(e);for(var t=0;t<this._slides.length;t++)this._slides[t]==e&&this._slides.splice(t,1)},_addSlide:function(e){e.addTo(this._el.slider_item_container);e.on("added",this._onSlideAdded,this);e.on("background_change",this._onBackgroundChange,this)},_removeSlide:function(e){e.removeFrom(this._el.slider_item_container);e.off("added",this._onSlideAdded,this);e.off("background_change",this._onBackgroundChange)},goTo:function(e,t,n){var r=this;this.changeBackground({color_value:"#FFF",image:!1});this.preloadTimer&&clearTimeout(this.preloadTimer);for(var i=0;i<this._slides.length;i++)this._slides[i].setActive(!1);if(e<this._slides.length&&e>=0){this.current_slide=e;this.animator&&this.animator.stop();this._swipable&&this._swipable.stopMomentum();if(t){this._el.slider_container.style.left=-(this.slide_spacing*e)+"px";this._onSlideChange(n)}else this.animator=VCO.Animate(this._el.slider_container,{left:-(this.slide_spacing*e)+"px",duration:this.options.duration,easing:this.options.ease,complete:this._onSlideChange(n)});this._slides[this.current_slide].setActive(!0);if(this._slides[this.current_slide+1]){this.showNav(this._nav.next,!0);this._nav.next.update(this.getNavInfo(this._slides[this.current_slide+1]))}else this.showNav(this._nav.next,!1);if(this._slides[this.current_slide-1]){this.showNav(this._nav.previous,!0);this._nav.previous.update(this.getNavInfo(this._slides[this.current_slide-1]))}else this.showNav(this._nav.previous,!1);this.preloadTimer=setTimeout(function(){r.preloadSlides()},this.options.duration)}},preloadSlides:function(){if(this._slides[this.current_slide+1]){this._slides[this.current_slide+1].loadMedia();this._slides[this.current_slide+1].scrollToTop()}if(this._slides[this.current_slide+2]){this._slides[this.current_slide+2].loadMedia();this._slides[this.current_slide+2].scrollToTop()}if(this._slides[this.current_slide-1]){this._slides[this.current_slide-1].loadMedia();this._slides[this.current_slide-1].scrollToTop()}if(this._slides[this.current_slide-2]){this._slides[this.current_slide-2].loadMedia();this._slides[this.current_slide-2].scrollToTop()}},getNavInfo:function(e){var t={title:"",description:""};e.data.text&&e.data.text.headline&&(t.title=e.data.text.headline);return t},next:function(){this.current_slide+1<this._slides.length?this.goTo(this.current_slide+1):this.goTo(this.current_slide)},previous:function(){this.current_slide-1>=0?this.goTo(this.current_slide-1):this.goTo(this.current_slide)},showNav:function(e,t){this.options.width<=500&&VCO.Browser.mobile||(t?e.show():e.hide())},changeBackground:function(e){var t={r:256,g:256,b:256},n,r=this.options.slide_default_fade,i="15%",s="0.87",o="";e.color_value&&(t=VCO.Util.hexToRgb(e.color_value));n=t.r+","+t.g+","+t.b;this._el.background.style.backgroundImage="none";if(this.options.layout=="landscape"){this._nav.next.setColor(!1);this._nav.previous.setColor(!1);t.r<255&&t.g<255&&t.b<255&&(r="0%");e.image;o+="background-image: -webkit-linear-gradient(left, color-stop(rgba("+n+",0.0001 ) "+r+"), color-stop(rgba("+n+","+s+") "+
i+"));";o+="background-image: linear-gradient(to right, rgba("+n+",0.0001 ) "+r+", rgba("+n+","+s+") "+i+");";o+="background-repeat: repeat-x;";o+="filter: e(%('progid:DXImageTransform.Microsoft.gradient(startColorstr='%d', endColorstr='%d', GradientType=1)',argb("+n+", 0.0001),argb("+n+",0.80)));";this._el.background.setAttribute("style",o)}else{e.color_value?this._el.background.style.backgroundColor=e.color_value:this._el.background.style.backgroundColor="#FFF";if(t.r<255&&t.g<255&&t.b<255||e.image){this._nav.next.setColor(!0);this._nav.previous.setColor(!0)}else{this._nav.next.setColor(!1);this._nav.previous.setColor(!1)}}},_updateDisplay:function(e,t,n,r){var i,s;typeof r=="undefined"?s=this.options.layout:s=r;this.options.layout=s;this.slide_spacing=this.options.width*2;e?this.options.width=e:this.options.width=this._el.container.offsetWidth;t?this.options.height=t:this.options.height=this._el.container.offsetHeight;i=this.options.height/2;this._nav.next.setPosition({top:i});this._nav.previous.setPosition({top:i});for(var o=0;o<this._slides.length;o++){this._slides[o].updateDisplay(this.options.width,this.options.height,s);this._slides[o].setPosition({left:this.slide_spacing*o,top:0})}this.goTo(this.current_slide,!0,!0)},_initLayout:function(){this._el.container.className+=" vco-storyslider";this._el.slider_container_mask=VCO.Dom.create("div","vco-slider-container-mask",this._el.container);this._el.background=VCO.Dom.create("div","vco-slider-background",this._el.container);this._el.slider_container=VCO.Dom.create("div","vco-slider-container vcoanimate",this._el.slider_container_mask);this._el.slider_item_container=VCO.Dom.create("div","vco-slider-item-container",this._el.slider_container);this.options.width=this._el.container.offsetWidth;this.options.height=this._el.container.offsetHeight;this._nav.previous=new VCO.SlideNav({title:"Previous",description:"description"},{direction:"previous"});this._nav.next=new VCO.SlideNav({title:"Next",description:"description"},{direction:"next"});this._nav.next.addTo(this._el.container);this._nav.previous.addTo(this._el.container);this._el.slider_container.style.left="0px";if(VCO.Browser.touch){this._swipable=new VCO.Swipable(this._el.slider_container_mask,this._el.slider_container,{enable:{x:!0,y:!1},snap:!0});this._swipable.enable();this._message=new VCO.Message({},{message_class:"vco-message-full",message_icon_class:"vco-icon-swipe-left"});this._message.updateMessage("Swipe to Navigate<br><span class='vco-button'>OK</span>");this._message.addTo(this._el.container)}},_initEvents:function(){this._nav.next.on("clicked",this._onNavigation,this);this._nav.previous.on("clicked",this._onNavigation,this);this._message&&this._message.on("clicked",this._onMessageClick,this);if(this._swipable){this._swipable.on("swipe_left",this._onNavigation,this);this._swipable.on("swipe_right",this._onNavigation,this);this._swipable.on("swipe_nodirection",this._onSwipeNoDirection,this)}},_initData:function(){this._createSlides(this.data.slides)},_onBackgroundChange:function(e){var t;t=this._slides[this.current_slide].getBackground();this.changeBackground(e);this.fire("colorchange",t)},_onMessageClick:function(e){this._message.hide()},_onSwipeNoDirection:function(e){this.goTo(this.current_slide)},_onNavigation:function(e){e.direction=="next"||e.direction=="left"?this.next():(e.direction=="previous"||e.direction=="right")&&this.previous();this.fire("nav_"+e.direction,this.data)},_onSlideAdded:function(e){trace("slideadded");this.fire("slideAdded",this.data)},_onSlideRemoved:function(e){this.fire("slideAdded",this.data)},_onSlideChange:function(e){e||this.fire("change",{current_slide:this.current_slide})},_onMouseClick:function(e){},_fireMouseEvent:function(e){if(!this._loaded)return;var t=e.type;t=t==="mouseenter"?"mouseover":t==="mouseleave"?"mouseout":t;if(!this.hasEventListeners(t))return;t==="contextmenu"&&VCO.DomEvent.preventDefault(e);this.fire(t,{latlng:"something",layerPoint:"something else"})},_onLoaded:function(){this.fire("loaded",this.data)}});var oldL=window.L,L={};L.version="0.7.2";typeof module=="object"&&typeof module.exports=="object"?module.exports=L:typeof define=="function"&&define.amd&&define(L);L.noConflict=function(){window.L=oldL;return this};window.L=L;L.Util={extend:function(e){var t=Array.prototype.slice.call(arguments,1),n,r,i,s;for(r=0,i=t.length;r<i;r++){s=t[r]||{};for(n in s)s.hasOwnProperty(n)&&(e[n]=s[n])}return e},bind:function(e,t){var n=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return e.apply(t,n||arguments)}},stamp:function(){var e=0,t="_leaflet_id";return function(n){n[t]=n[t]||++e;return n[t]}}(),invokeEach:function(e,t,n){var r,i;if(typeof e=="object"){i=Array.prototype.slice.call(arguments,3);for(r in e)t.apply(n,[r,e[r]].concat(i));return!0}return!1},limitExecByInterval:function(e,t,n){var r,i;return function s(){var o=arguments;if(r){i=!0;return}r=!0;setTimeout(function(){r=!1;if(i){s.apply(n,o);i=!1}},t);e.apply(n,o)}},falseFn:function(){return!1},formatNum:function(e,t){var n=Math.pow(10,t||5);return Math.round(e*n)/n},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},splitWords:function(e){return L.Util.trim(e).split(/\s+/)},setOptions:function(e,t){e.options=L.extend({},e.options,t);return e.options},getParamString:function(e,t,n){var r=[];for(var i in e)r.push(encodeURIComponent(n?i.toUpperCase():i)+"="+encodeURIComponent(e[i]));return(!t||t.indexOf("?")===-1?"?":"&")+r.join("&")},template:function(e,t){return e.replace(/\{ *([\w_]+) *\}/g,function(e,n){var r=t[n];if(r===undefined)throw new Error("No value provided for variable "+e);typeof r=="function"&&(r=r(t));return r})},isArray:Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="};(function(){function e(e){var t,n,r=["webkit","moz","o","ms"];for(t=0;t<r.length&&!n;t++)n=window[r[t]+e];return n}function n(e){var n=+(new Date),r=Math.max(0,16-(n-t));t=n+r;return window.setTimeout(e,r)}var t=0,r=window.requestAnimationFrame||e("RequestAnimationFrame")||n,i=window.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};L.Util.requestAnimFrame=function(e,t,i,s){e=L.bind(e,t);if(!i||r!==n)return r.call(window,e,s);e()};L.Util.cancelAnimFrame=function(e){e&&i.call(window,e)}})();L.extend=L.Util.extend;L.bind=L.Util.bind;L.stamp=L.Util.stamp;L.setOptions=L.Util.setOptions;L.Class=function(){};L.Class.extend=function(e){var t=function(){this.initialize&&this.initialize.apply(this,arguments);this._initHooks&&this.callInitHooks()},n=function(){};n.prototype=this.prototype;var r=new n;r.constructor=t;t.prototype=r;for(var i in this)this.hasOwnProperty(i)&&i!=="prototype"&&(t[i]=this[i]);if(e.statics){L.extend(t,e.statics);delete e.statics}if(e.includes){L.Util.extend.apply(null,[r].concat(e.includes));delete e.includes}e.options&&r.options&&(e.options=L.extend({},r.options,e.options));L.extend(r,e);r._initHooks=[];var s=this;t.__super__=s.prototype;r.callInitHooks=function(){if(this._initHooksCalled)return;s.prototype.callInitHooks&&s.prototype.callInitHooks.call(this);this._initHooksCalled=!0;for(var e=0,t=r._initHooks.length;e<t;e++)r._initHooks[e].call(this)};return t};L.Class.include=function(e){L.extend(this.prototype,e)};L.Class.mergeOptions=function(e){L.extend(this.prototype.options,e)};L.Class.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n=typeof e=="function"?e:function(){this[e].apply(this,t)};this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push(n)};var eventsKey="_leaflet_events";L.Mixin={};L.Mixin.Events={addEventListener:function(e,t,n){if(L.Util.invokeEach(e,this.addEventListener,this,t,n))return this;var r=this[eventsKey]=this[eventsKey]||{},i=n&&n!==this&&L.stamp(n),s,o,u,a,f,l,c;e=L.Util.splitWords(e);for(s=0,o=e.length;s<o;s++){u={action:t,context:n||this};a=e[s];if(i){f=a+"_idx";l=f+"_len";c=r[f]=r[f]||{};if(!c[i]){c[i]=[];r[l]=(r[l]||0)+1}c[i].push(u)}else{r[a]=r[a]||[];r[a].push(u)}}return this},hasEventListeners:function(e){var t=this[eventsKey];return!!t&&(e in t&&t[e].length>0||e+"_idx"in t&&t[e+"_idx_len"]>0)},removeEventListener:function(e,t,n){if(!this[eventsKey])return this;if(!e)return this.clearAllEventListeners();if(L.Util.invokeEach(e,this.removeEventListener,this,t,n))return this;var r=this[eventsKey],i=n&&n!==this&&L.stamp(n),s,o,u,a,f,l,c,h,p;e=L.Util.splitWords(e);for(s=0,o=e.length;s<o;s++){u=e[s];l=u+"_idx";c=l+"_len";h=r[l];if(!t){delete r[u];delete r[l];delete r[c]}else{a=i&&h?h[i]:r[u];if(a){for(f=a.length-1;f>=0;f--)if(a[f].action===t&&(!n||a[f].context===n)){p=a.splice(f,1);p[0].action=L.Util.falseFn}if(n&&h&&a.length===0){delete h[i];r[c]--}}}}return this},clearAllEventListeners:function(){delete this[eventsKey];return this},fireEvent:function(e,t){if(!this.hasEventListeners(e))return this;var n=L.Util.extend({},t,{type:e,target:this}),r=this[eventsKey],i,s,o,u,a;if(r[e]){i=r[e].slice();for(s=0,o=i.length;s<o;s++)i[s].action.call(i[s].context,n)}u=r[e+"_idx"];for(a in u){i=u[a].slice();if(i)for(s=0,o=i.length;s<o;s++)i[s].action.call(i[s].context,n)}return this},addOneTimeEventListener:function(e,t,n){if(L.Util.invokeEach(e,this.addOneTimeEventListener,this,t,n))return this;var r=L.bind(function(){this.removeEventListener(e,t,n).removeEventListener(e,r,n)},this);return this.addEventListener(e,t,n).addEventListener(e,r,n)}};L.Mixin.Events.on=L.Mixin.Events.addEventListener;L.Mixin.Events.off=L.Mixin.Events.removeEventListener;L.Mixin.Events.once=L.Mixin.Events.addOneTimeEventListener;L.Mixin.Events.fire=L.Mixin.Events.fireEvent;(function(){var e="ActiveXObject"in window,t=e&&!document.addEventListener,n=navigator.userAgent.toLowerCase(),r=n.indexOf("webkit")!==-1,i=n.indexOf("chrome")!==-1,s=n.indexOf("phantom")!==-1,o=n.indexOf("android")!==-1,u=n.search("android [23]")!==-1,a=n.indexOf("gecko")!==-1,f=typeof orientation!=undefined+"",l=window.navigator&&window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints&&!window.PointerEvent,c=window.PointerEvent&&window.navigator.pointerEnabled&&window.navigator.maxTouchPoints||l,h="devicePixelRatio"in window&&window.devicePixelRatio>1||"matchMedia"in window&&window.matchMedia("(min-resolution:144dpi)")&&window.matchMedia("(min-resolution:144dpi)").matches,p=document.documentElement,d=e&&"transition"in p.style,v="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!u,m="MozPerspective"in p.style,g="OTransition"in p.style,y=!window.L_DISABLE_3D&&(d||v||m||g)&&!s,b=!window.L_NO_TOUCH&&!s&&function(){var e="ontouchstart";if(c||e in p)return!0;var t=document.createElement("div"),n=!1;if(!t.setAttribute)return!1;t.setAttribute(e,"return;");typeof t[e]=="function"&&(n=!0);t.removeAttribute(e);t=null;return n}();L.Browser={ie:e,ielt9:t,webkit:r,gecko:a&&!r&&!window.opera&&!e,android:o,android23:u,chrome:i,ie3d:d,webkit3d:v,gecko3d:m,opera3d:g,any3d:y,mobile:f,mobileWebkit:f&&r,mobileWebkit3d:f&&v,mobileOpera:f&&window.opera,touch:b,msPointer:l,pointer:c,retina:h}})();L.Point=function(e,t,n){this.x=n?Math.round(e):e;this.y=n?Math.round(t):t};L.Point.prototype={clone:function(){return new L.Point(this.x,this.y)},add:function(e){return this.clone()._add(L.point(e))},_add:function(e){this.x+=e.x;this.y+=e.y;return this},subtract:function(e){return this.clone()._subtract(L.point(e))},_subtract:function(e){this.x-=e.x;this.y-=e.y;return this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){this.x/=e;this.y/=e;return this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){this.x*=e;this.y*=e;return this},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},distanceTo:function(e){e=L.point(e);var t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},equals:function(e){e=L.point(e);return e.x===this.x&&e.y===this.y},contains:function(e){e=L.point(e);return Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+L.Util.formatNum(this.x)+", "+L.Util.formatNum(this.y)+")"}};L.point=function(e,t,n){return e instanceof L.Point?e:L.Util.isArray(e)?new L.Point(e[0],e[1]):e===undefined||e===null?e:new L.Point(e,t,n)};L.Bounds=function(e,t){if(!e)return;var n=t?[e,t]:e;for(var r=0,i=n.length;r<i;r++)this.extend(n[r])};L.Bounds.prototype={extend:function(e){e=L.point(e);if(!this.min&&!this.max){this.min=e.clone();this.max=e.clone()}else{this.min.x=Math.min(e.x,this.min.x);this.max.x=Math.max(e.x,this.max.x);this.min.y=Math.min(e.y,this.min.y);this.max.y=Math.max(e.y,this.max.y)}return this},getCenter:function(e){return new L.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return new L.Point(this.min.x,this.max.y)},getTopRight:function(){return new L.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,n;typeof e[0]=="number"||e instanceof L.Point?e=L.point(e):e=L.bounds(e);if(e instanceof L.Bounds){t=e.min;n=e.max}else t=n=e;return t.x>=this.min.x&&n.x<=this.max.x&&t.y>=this.min.y&&n.y<=this.max.y},intersects:function(e){e=L.bounds(e);var t=this.min,n=this.max,r=e.min,i=e.max,s=i.x>=t.x&&r.x<=n.x,o=i.y>=t.y&&r.y<=n.y;return s&&o},isValid:function(){return!!this.min&&!!this.max}};L.bounds=function(e,t){return!e||e instanceof L.Bounds?e:new L.Bounds(e,t)};L.Transformation=function(e,t,n,r){this._a=e;this._b=t;this._c=n;this._d=r};L.Transformation.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){t=t||1;e.x=t*(this._a*e.x+this._b);e.y=t*(this._c*e.y+this._d);return e},untransform:function(e,t){t=t||1;return new L.Point((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};L.DomUtil={get:function(e){return typeof e=="string"?document.getElementById(e):e},getStyle:function(e,t){var n=e.style[t];!n&&e.currentStyle&&(n=e.currentStyle[t]);if((!n||n==="auto")&&document.defaultView){var r=document.defaultView.getComputedStyle(e,null);n=r?r[t]:null}return n==="auto"?null:n},getViewportOffset:function(e){var t=0,n=0,r=e,i=document.body,s=document.documentElement,o;do{t+=r.offsetTop||0;n+=r.offsetLeft||0;t+=parseInt(L.DomUtil.getStyle(r,"borderTopWidth"),10)||0;n+=parseInt(L.DomUtil.getStyle(r,"borderLeftWidth"),10)||0;o=L.DomUtil.getStyle(r,"position");if(r.offsetParent===i&&o==="absolute")break;if(o==="fixed"){t+=i.scrollTop||s.scrollTop||0;n+=i.scrollLeft||s.scrollLeft||0;break}if(o==="relative"&&!r.offsetLeft){var u=L.DomUtil.getStyle(r,"width"),a=L.DomUtil.getStyle(r,"max-width"),f=r.getBoundingClientRect();if(u!=="none"||a!=="none")n+=f.left+r.clientLeft;t+=f.top+(i.scrollTop||s.scrollTop||0);break}r=r.offsetParent}while(r);r=e;do{if(r===i)break;t-=r.scrollTop||0;n-=r.scrollLeft||0;r=r.parentNode}while(r);return new L.Point(n,t)},documentIsLtr:function(){if(!L.DomUtil._docIsLtrCached){L.DomUtil._docIsLtrCached=!0;L.DomUtil._docIsLtr=L.DomUtil.getStyle(document.body,"direction")==="ltr"}return L.DomUtil._docIsLtr},create:function(e,t,n){var r=document.createElement(e);r.className=t;n&&n.appendChild(r);return r},hasClass:function(e,t){if(e.classList!==undefined)return e.classList.contains(t);var n=L.DomUtil._getClass(e);return n.length>0&&(new RegExp("(^|\\s)"+t+"(\\s|$)")).test(n)},addClass:function(e,t){if(e.classList!==undefined){var n=L.Util.splitWords(t);for(var r=0,i=n.length;r<i;r++)e.classList.add(n[r])}else if(!L.DomUtil.hasClass(e,t)){var s=L.DomUtil._getClass(e);L.DomUtil._setClass(e,(s?s+" ":"")+t)}},removeClass:function(e,t){e.classList!==undefined?e.classList.remove(t):L.DomUtil._setClass(e,L.Util.trim((" "+L.DomUtil._getClass(e)+" ").replace(" "+t+" "," ")))},_setClass:function(e,t){e.className.baseVal===undefined?e.className=t:e.className.baseVal=t},_getClass:function(e){return e.className.baseVal===undefined?e.className:e.className.baseVal},setOpacity:function(e,t){if("opacity"in e.style)e.style.opacity=t;else if("filter"in e.style){var n=!1,r="DXImageTransform.Microsoft.Alpha";try{n=e.filters.item(r)}catch(i){if(t===1)return}t=Math.round(t*100);if(n){n.Enabled=t!==100;n.Opacity=t}else e.style.filter+=" progid:"+r+"(opacity="+t+")"}},testProp:function(e){var t=document.documentElement.style;for(var n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1},getTranslateString:function(e){var t=L.Browser.webkit3d,n="translate"+(t?"3d":"")+"(",r=(t?",0":"")+")";return n+e.x+"px,"+e.y+"px"+r},getScaleString:function(e,t){var n=L.DomUtil.getTranslateString(t.add(t.multiplyBy(-1*e))),r=" scale("+e+") ";return n+r},setPosition:function(e,t,n){e._leaflet_pos=t;if(!n&&L.Browser.any3d)e.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(t);else{e.style.left=t.x+"px";e.style.top=t.y+"px"}},getPosition:function(e){return e._leaflet_pos}};L.DomUtil.TRANSFORM=L.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);L.DomUtil.TRANSITION=L.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);L.DomUtil.TRANSITION_END=L.DomUtil.TRANSITION==="webkitTransition"||L.DomUtil.TRANSITION==="OTransition"?L.DomUtil.TRANSITION+"End":"transitionend";(function(){if("onselectstart"in document)L.extend(L.DomUtil,{disableTextSelection:function(){L.DomEvent.on(window,"selectstart",L.DomEvent.preventDefault)},enableTextSelection:function(){L.DomEvent.off(window,"selectstart",L.DomEvent.preventDefault)}});else{var e=L.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);L.extend(L.DomUtil,{disableTextSelection:function(){if(e){var t=document.documentElement.style;this._userSelect=t[e];t[e]="none"}},enableTextSelection:function(){if(e){document.documentElement.style[e]=this._userSelect;delete this._userSelect}}})}L.extend(L.DomUtil,{disableImageDrag:function(){L.DomEvent.on(window,"dragstart",L.DomEvent.preventDefault)},enableImageDrag:function(){L.DomEvent.off(window,"dragstart",L.DomEvent.preventDefault)}})})();L.LatLng=function(e,t,n){e=parseFloat(e);t=parseFloat(t);if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=e;this.lng=t;n!==undefined&&(this.alt=parseFloat(n))};L.extend(L.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9});L.LatLng.prototype={equals:function(e){if(!e)return!1;e=L.latLng(e);var t=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return t<=L.LatLng.MAX_MARGIN},toString:function(e){return"LatLng("+L.Util.formatNum(this.lat,e)+", "+L.Util.formatNum(this.lng,e)+")"},distanceTo:function(e){e=L.latLng(e);var t=6378137,n=L.LatLng.DEG_TO_RAD,r=(e.lat-this.lat)*n,i=(e.lng-this.lng)*n,s=this.lat*n,o=e.lat*n,u=Math.sin(r/2),a=Math.sin(i/2),f=u*u+a*a*Math.cos(s)*Math.cos(o);return t*2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f))},wrap:function(e,t){var n=this.lng;e=e||-180;t=t||180;n=(n+t)%(t-e)+(n<e||n===t?t:e);return new L.LatLng(this.lat,n)}};L.latLng=function(e,t){return e instanceof L.LatLng?e:L.Util.isArray(e)?typeof e[0]=="number"||typeof e[0]=="string"?new L.LatLng(e[0],e[1],e[2]):null:e===undefined||e===null?e:typeof e=="object"&&"lat"in e?new L.LatLng(e.lat,"lng"in e?e.lng:e.lon):t===undefined?null:new L.LatLng(e,t)};L.LatLngBounds=function(e,t){if(!e)return;var n=t?[e,t]:e;for(var r=0,i=n.length;r<i;r++)this.extend(n[r])};L.LatLngBounds.prototype={extend:function(e){if(!e)return this;var t=L.latLng(e);t!==null?e=t:e=L.latLngBounds(e);if(e instanceof L.LatLng)if(!this._southWest&&!this._northEast){this._southWest=new L.LatLng(e.lat,e.lng);this._northEast=new L.LatLng(e.lat,e.lng)}else{this._southWest.lat=Math.min(e.lat,this._southWest.lat);this._southWest.lng=Math.min(e.lng,this._southWest.lng);this._northEast.lat=Math.max(e.lat,this._northEast.lat);this._northEast.lng=Math.max(e.lng,this._northEast.lng)}else if(e instanceof L.LatLngBounds){this.extend(e._southWest);this.extend(e._northEast)}return this},pad:function(e){var t=this._southWest,n=this._northEast,r=Math.abs(t.lat-n.lat)*e,i=Math.abs(t.lng-n.lng)*e;return new L.LatLngBounds(new L.LatLng(t.lat-r,t.lng-i),new L.LatLng(n.lat+r,n.lng+i))},getCenter:function(){return new L.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new L.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new L.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){typeof e[0]=="number"||e instanceof L.LatLng?e=L.latLng(e):e=L.latLngBounds(e);var t=this._southWest,n=this._northEast,r,i;if(e instanceof L.LatLngBounds){r=e.getSouthWest();i=e.getNorthEast()}else r=i=e;return r.lat>=t.lat&&i.lat<=n.lat&&r.lng>=t.lng&&i.lng<=n.lng},intersects:function(e){e=L.latLngBounds(e);var t=this._southWest,n=this._northEast,r=e.getSouthWest(),i=e.getNorthEast(),s=i.lat>=t.lat&&r.lat<=n.lat,o=i.lng>=t.lng&&r.lng<=n.lng;return s&&o},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e){if(!e)return!1;e=L.latLngBounds(e);return this._southWest.equals(e.getSouthWest())&&this._northEast.equals(e.getNorthEast())},isValid:function(){return!!this._southWest&&!!this._northEast}};L.latLngBounds=function(e,t){return!e||e instanceof L.LatLngBounds?e:new L.LatLngBounds(e,t)};L.Projection={};L.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(e){var t=L.LatLng.DEG_TO_RAD,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,e.lat),-n),i=e.lng*t,s=r*t;s=Math.log(Math.tan(Math.PI/4+s/2));return new L.Point(i,s)},unproject:function(e){var t=L.LatLng.RAD_TO_DEG,n=e.x*t,r=(2*Math.atan(Math.exp(e.y))-Math.PI/2)*t;return new L.LatLng(r,n)}};L.Projection.LonLat={project:function(e){return new L.Point(e.lng,e.lat)},unproject:function(e){return new L.LatLng(e.y,e.x)}};L.CRS={latLngToPoint:function(e,t){var n=this.projection.project(e),r=this.scale(t);return this.transformation._transform(n,r)},pointToLatLng:function(e,t){var n=this.scale(t),r=this.transformation.untransform(e,n);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},scale:function(e){return 256*Math.pow(2,e)},getSize:function(e){var t=this.scale(e);return L.point(t,t)}};L.CRS.Simple=L.extend({},L.CRS,{projection:L.Projection.LonLat,transformation:new L.Transformation(1,0,-1,0),scale:function(e){return Math.pow(2,e)}});L.CRS.EPSG3857=L.extend({},L.CRS,{code:"EPSG:3857",projection:L.Projection.SphericalMercator,transformation:new L.Transformation(.5/Math.PI,.5,-0.5/Math.PI,.5),project:function(e){var t=this.projection.project(e),n=6378137;return t.multiplyBy(n)}});L.CRS.EPSG900913=L.extend({},L.CRS.EPSG3857,{code:"EPSG:900913"});L.CRS.EPSG4326=L.extend({},L.CRS,{code:"EPSG:4326",projection:L.Projection.LonLat,transformation:new L.Transformation(1/360,.5,-1/360,.5)});L.Map=L.Class.extend({includes:L.Mixin.Events,options:{crs:L.CRS.EPSG3857,fadeAnimation:L.DomUtil.TRANSITION&&!L.Browser.android23,trackResize:!0,markerZoomAnimation:L.DomUtil.TRANSITION&&L.Browser.any3d},initialize:function(e,t){t=L.setOptions(this,t);this._initContainer(e);this._initLayout();this._onResize=L.bind(this._onResize,this);this._initEvents();t.maxBounds&&this.setMaxBounds(t.maxBounds);t.center&&t.zoom!==undefined&&this.setView(L.latLng(t.center),t.zoom,{reset:!0});this._handlers=[];this._layers={};this._zoomBoundLayers={};this._tileLayersNum=0;this.callInitHooks();this._addLayers(t.layers)},setView:function(e,t){t=t===undefined?this.getZoom():t;this._resetView(L.latLng(e),this._limitZoom(t));return this},setZoom:function(e,t){if(!this._loaded){this._zoom=this._limitZoom(e);return this}return this.setView(this.getCenter(),e,{zoom:t})},zoomIn:function(e,t){return this.setZoom(this._zoom+(e||1),t)},zoomOut:function(e,t){return this.setZoom(this._zoom-(e||1),t)},setZoomAround:function(e,t,n){var r=this.getZoomScale(t),i=this.getSize().divideBy(2),s=e instanceof L.Point?e:this.latLngToContainerPoint(e),o=s.subtract(i).multiplyBy(1-1/r),u=this.containerPointToLatLng(i.add(o));return this.setView(u,t,{zoom:n})},fitBounds:function(e,t){t=t||{};e=e.getBounds?e.getBounds():L.latLngBounds(e);var n=L.point(t.paddingTopLeft||t.padding||[0,0]),r=L.point(t.paddingBottomRight||t.padding||[0,0]),i=this.getBoundsZoom(e,!1,n.add(r)),s=r.subtract(n).divideBy(2),o=this.project(e.getSouthWest(),i),u=this.project(e.getNorthEast(),i),a=this.unproject(o.add(u).divideBy(2).add(s),i);i=t&&t.maxZoom?Math.min(t.maxZoom,i):i;return this.setView(a,i,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e){this.fire("movestart");this._rawPanBy(L.point(e));this.fire("move");return this.fire("moveend")},setMaxBounds:function(e){e=L.latLngBounds(e);this.options.maxBounds=e;if(!e)return this.off("moveend",this._panInsideMaxBounds,this);this._loaded&&this._panInsideMaxBounds();return this.on("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(e,t){var n=this.getCenter(),r=this._limitCenter(n,this._zoom,e);return n.equals(r)?this:this.panTo(r,t)},addLayer:function(e){var t=L.stamp(e);if(this._layers[t])return this;this._layers[t]=e;if(e.options&&(!isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))){this._zoomBoundLayers[t]=e;this._updateZoomLevels()}if(this.options.zoomAnimation&&L.TileLayer&&e instanceof L.TileLayer){this._tileLayersNum++;this._tileLayersToLoad++;e.on("load",this._onTileLayerLoad,this)}this._loaded&&this._layerAdd(e);return this},removeLayer:function(e){var t=L.stamp(e);if(!this._layers[t])return this;this._loaded&&e.onRemove(this);delete this._layers[t];this._loaded&&this.fire("layerremove",{layer:e});if(this._zoomBoundLayers[t]){delete this._zoomBoundLayers[t];this._updateZoomLevels()}if(this.options.zoomAnimation&&L.TileLayer&&e instanceof L.TileLayer){this._tileLayersNum--;this._tileLayersToLoad--;e.off("load",this._onTileLayerLoad,this)}return this},hasLayer:function(e){return e?L.stamp(e)in this._layers:!1},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},invalidateSize:function(e){if(!this._loaded)return this;e=L.extend({animate:!1,pan:!0},e===!0?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0;this._initialCenter=null;var n=this.getSize(),r=t.divideBy(2).round(),i=n.divideBy(2).round(),s=r.subtract(i);if(!s.x&&!s.y)return this;if(e.animate&&e.pan)this.panBy(s);else{e.pan&&this._rawPanBy(s);this.fire("move");if(e.debounceMoveend){clearTimeout(this._sizeTimer);this._sizeTimer=setTimeout(L.bind(this.fire,this,"moveend"),200)}else this.fire("moveend")}return this.fire("resize",{oldSize:t,newSize:n})},addHandler:function(e,t){if(!t)return this;var n=this[e]=new t(this);this._handlers.push(n);this.options[e]&&n.enable();return this},remove:function(){this._loaded&&this.fire("unload");this._initEvents("off");try{delete this._container._leaflet}catch(e){this._container._leaflet=undefined}this._clearPanes();this._clearControlPos&&this._clearControlPos();this._clearHandlers();return this},getCenter:function(){this._checkIfLoaded();return this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),t=this.unproject(e.getBottomLeft()),n=this.unproject(e.getTopRight());return new L.LatLngBounds(t,n)},getMinZoom:function(){return this.options.minZoom===undefined?this._layersMinZoom===undefined?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===undefined?this._layersMaxZoom===undefined?Infinity:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,n){e=L.latLngBounds(e);var r=this.getMinZoom()-(t?1:0),i=this.getMaxZoom(),s=this.getSize(),o=e.getNorthWest(),u=e.getSouthEast(),a=!0,f;n=L.point(n||[0,0]);do{r++;f=this.project(u,r).subtract(this.project(o,r)).add(n);a=t?f.x<s.x||f.y<s.y:s.contains(f)}while(a&&r<=i);return a&&t?null:t?r:r-1},getSize:function(){if(!this._size||this._sizeChanged){this._size=new L.Point(this._container.clientWidth,this._container.clientHeight);this._sizeChanged=!1}return this._size.clone()},getPixelBounds:function(){var e=this._getTopLeftPoint();return new L.Bounds(e,e.add(this.getSize()))},getPixelOrigin:function(){this._checkIfLoaded();return this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e){var t=this.options.crs;return t.scale(e)/t.scale(this._zoom)},getScaleZoom:function(e){return this._zoom+Math.log(e)/Math.LN2},project:function(e,t){t=t===undefined?this._zoom:t;return this.options.crs.latLngToPoint(L.latLng(e),t)},unproject:function(e,t){t=t===undefined?this._zoom:t;return this.options.crs.pointToLatLng(L.point(e),t)},layerPointToLatLng:function(e){var t=L.point(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){var t=this.project(L.latLng(e))._round();return t._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(e){return L.point(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return L.point(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(L.point(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(e)))},mouseEventToContainerPoint:function(e){return L.DomEvent.getMousePosition(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=L.DomUtil.get(e);if(!t)throw new Error("Map container not found.");if(t._leaflet)throw new Error("Map container is already initialized.");t._leaflet=!0},_initLayout:function(){var e=this._container;L.DomUtil.addClass(e,"leaflet-container"+(L.Browser.touch?" leaflet-touch":"")+(L.Browser.retina?" leaflet-retina":"")+(L.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var t=L.DomUtil.getStyle(e,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&(e.style.position="relative");this._initPanes();this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._mapPane=e.mapPane=this._createPane("leaflet-map-pane",this._container);this._tilePane=e.tilePane=this._createPane("leaflet-tile-pane",this._mapPane);e.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane);e.shadowPane=this._createPane("leaflet-shadow-pane");e.overlayPane=this._createPane("leaflet-overlay-pane");e.markerPane=this._createPane("leaflet-marker-pane");e.popupPane=this._createPane("leaflet-popup-pane");var t=" leaflet-zoom-hide";if(!this.options.markerZoomAnimation){L.DomUtil.addClass(e.markerPane,t);L.DomUtil.addClass(e.shadowPane,t);L.DomUtil.addClass(e.popupPane,t)}},_createPane:function(e,t){return L.DomUtil.create("div",e,t||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(e){e=e?L.Util.isArray(e)?e:[e]:[];for(var t=0,n=e.length;t<n;t++)this.addLayer(e[t])},_resetView:function(e,t,n,r){var i=this._zoom!==t;if(!r){this.fire("movestart");i&&this.fire("zoomstart")}this._zoom=t;this._initialCenter=e;this._initialTopLeftPoint=this._getNewTopLeftPoint(e);n?this._initialTopLeftPoint._add(this._getMapPanePos()):L.DomUtil.setPosition(this._mapPane,new L.Point(0,0));this._tileLayersToLoad=this._tileLayersNum;var s=!this._loaded;this._loaded=!0;if(s){this.fire("load");this.eachLayer(this._layerAdd,this)}this.fire("viewreset",{hard:!n});this.fire("move");(i||r)&&this.fire("zoomend");this.fire("moveend",{hard:!n})},_rawPanBy:function(e){L.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var e,t=Infinity,n=-Infinity,r=this._getZoomSpan();for(e in this._zoomBoundLayers){var i=this._zoomBoundLayers[e];isNaN(i.options.minZoom)||(t=Math.min(t,i.options.minZoom));isNaN(i.options
.maxZoom)||(n=Math.max(n,i.options.maxZoom))}if(e===undefined)this._layersMaxZoom=this._layersMinZoom=undefined;else{this._layersMaxZoom=n;this._layersMinZoom=t}r!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(!L.DomEvent)return;e=e||"on";L.DomEvent[e](this._container,"click",this._onMouseClick,this);var t=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"],n,r;for(n=0,r=t.length;n<r;n++)L.DomEvent[e](this._container,t[n],this._fireMouseEvent,this);this.options.trackResize&&L.DomEvent[e](window,"resize",this._onResize,this)},_onResize:function(){L.Util.cancelAnimFrame(this._resizeRequest);this._resizeRequest=L.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(e){if(!this._loaded||!e._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||L.DomEvent._skipped(e))return;this.fire("preclick");this._fireMouseEvent(e)},_fireMouseEvent:function(e){if(!this._loaded||L.DomEvent._skipped(e))return;var t=e.type;t=t==="mouseenter"?"mouseover":t==="mouseleave"?"mouseout":t;if(!this.hasEventListeners(t))return;t==="contextmenu"&&L.DomEvent.preventDefault(e);var n=this.mouseEventToContainerPoint(e),r=this.containerPointToLayerPoint(n),i=this.layerPointToLatLng(r);this.fire(t,{latlng:i,layerPoint:r,containerPoint:n,originalEvent:e})},_onTileLayerLoad:function(){this._tileLayersToLoad--;this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){this._loaded?e.call(t||this,this):this.on("load",e,t);return this},_layerAdd:function(e){e.onAdd(this);this.fire("layeradd",{layer:e})},_getMapPanePos:function(){return L.DomUtil.getPosition(this._mapPane)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(e,t){var n=this.getSize()._divideBy(2);return this.project(e,t)._subtract(n)._round()},_latLngToNewLayerPoint:function(e,t,n){var r=this._getNewTopLeftPoint(n,t).add(this._getMapPanePos());return this.project(e,t)._subtract(r)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,n){if(!n)return e;var r=this.project(e,t),i=this.getSize().divideBy(2),s=new L.Bounds(r.subtract(i),r.add(i)),o=this._getBoundsOffset(s,n,t);return this.unproject(r.add(o),t)},_limitOffset:function(e,t){if(!t)return e;var n=this.getPixelBounds(),r=new L.Bounds(n.min.add(e),n.max.add(e));return e.add(this._getBoundsOffset(r,t))},_getBoundsOffset:function(e,t,n){var r=this.project(t.getNorthWest(),n).subtract(e.min),i=this.project(t.getSouthEast(),n).subtract(e.max),s=this._rebound(r.x,-i.x),o=this._rebound(r.y,-i.y);return new L.Point(s,o)},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom();return Math.max(t,Math.min(n,e))}});L.map=function(e,t){return new L.Map(e,t)};L.DomEvent={addListener:function(e,t,n,r){var i=L.stamp(n),s="_leaflet_"+t+i,o,u,a;if(e[s])return this;o=function(t){return n.call(r||e,t||L.DomEvent._getEvent())};if(L.Browser.pointer&&t.indexOf("touch")===0)return this.addPointerListener(e,t,o,i);L.Browser.touch&&t==="dblclick"&&this.addDoubleTapListener&&this.addDoubleTapListener(e,o,i);if("addEventListener"in e)if(t==="mousewheel"){e.addEventListener("DOMMouseScroll",o,!1);e.addEventListener(t,o,!1)}else if(t==="mouseenter"||t==="mouseleave"){u=o;a=t==="mouseenter"?"mouseover":"mouseout";o=function(t){if(!L.DomEvent._checkMouse(e,t))return;return u(t)};e.addEventListener(a,o,!1)}else if(t==="click"&&L.Browser.android){u=o;o=function(e){return L.DomEvent._filterClick(e,u)};e.addEventListener(t,o,!1)}else e.addEventListener(t,o,!1);else"attachEvent"in e&&e.attachEvent("on"+t,o);e[s]=o;return this},removeListener:function(e,t,n){var r=L.stamp(n),i="_leaflet_"+t+r,s=e[i];if(!s)return this;if(L.Browser.pointer&&t.indexOf("touch")===0)this.removePointerListener(e,t,r);else if(L.Browser.touch&&t==="dblclick"&&this.removeDoubleTapListener)this.removeDoubleTapListener(e,r);else if("removeEventListener"in e)if(t==="mousewheel"){e.removeEventListener("DOMMouseScroll",s,!1);e.removeEventListener(t,s,!1)}else t==="mouseenter"||t==="mouseleave"?e.removeEventListener(t==="mouseenter"?"mouseover":"mouseout",s,!1):e.removeEventListener(t,s,!1);else"detachEvent"in e&&e.detachEvent("on"+t,s);e[i]=null;return this},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0;L.DomEvent._skipped(e);return this},disableScrollPropagation:function(e){var t=L.DomEvent.stopPropagation;return L.DomEvent.on(e,"mousewheel",t).on(e,"MozMousePixelScroll",t)},disableClickPropagation:function(e){var t=L.DomEvent.stopPropagation;for(var n=L.Draggable.START.length-1;n>=0;n--)L.DomEvent.on(e,L.Draggable.START[n],t);return L.DomEvent.on(e,"click",L.DomEvent._fakeStop).on(e,"dblclick",t)},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;return this},stop:function(e){return L.DomEvent.preventDefault(e).stopPropagation(e)},getMousePosition:function(e,t){if(!t)return new L.Point(e.clientX,e.clientY);var n=t.getBoundingClientRect();return new L.Point(e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop)},getWheelDelta:function(e){var t=0;e.wheelDelta&&(t=e.wheelDelta/120);e.detail&&(t=-e.detail/3);return t},_skipEvents:{},_fakeStop:function(e){L.DomEvent._skipEvents[e.type]=!0},_skipped:function(e){var t=this._skipEvents[e.type];this._skipEvents[e.type]=!1;return t},_checkMouse:function(e,t){var n=t.relatedTarget;if(!n)return!0;try{while(n&&n!==e)n=n.parentNode}catch(r){return!1}return n!==e},_getEvent:function(){var e=window.event;if(!e){var t=arguments.callee.caller;while(t){e=t.arguments[0];if(e&&window.Event===e.constructor)break;t=t.caller}}return e},_filterClick:function(e,t){var n=e.timeStamp||e.originalEvent.timeStamp,r=L.DomEvent._lastClick&&n-L.DomEvent._lastClick;if(r&&r>100&&r<1e3||e.target._simulatedClick&&!e._simulated){L.DomEvent.stop(e);return}L.DomEvent._lastClick=n;return t(e)}};L.DomEvent.on=L.DomEvent.addListener;L.DomEvent.off=L.DomEvent.removeListener;L.Draggable=L.Class.extend({includes:L.Mixin.Events,statics:{START:L.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(e,t){this._element=e;this._dragStartTarget=t||e},enable:function(){if(this._enabled)return;for(var e=L.Draggable.START.length-1;e>=0;e--)L.DomEvent.on(this._dragStartTarget,L.Draggable.START[e],this._onDown,this);this._enabled=!0},disable:function(){if(!this._enabled)return;for(var e=L.Draggable.START.length-1;e>=0;e--)L.DomEvent.off(this._dragStartTarget,L.Draggable.START[e],this._onDown,this);this._enabled=!1;this._moved=!1},_onDown:function(e){this._moved=!1;if(e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)return;L.DomEvent.stopPropagation(e);if(L.Draggable._disabled)return;L.DomUtil.disableImageDrag();L.DomUtil.disableTextSelection();if(this._moving)return;var t=e.touches?e.touches[0]:e;this._startPoint=new L.Point(t.clientX,t.clientY);this._startPos=this._newPos=L.DomUtil.getPosition(this._element);L.DomEvent.on(document,L.Draggable.MOVE[e.type],this._onMove,this).on(document,L.Draggable.END[e.type],this._onUp,this)},_onMove:function(e){if(e.touches&&e.touches.length>1){this._moved=!0;return}var t=e.touches&&e.touches.length===1?e.touches[0]:e,n=new L.Point(t.clientX,t.clientY),r=n.subtract(this._startPoint);if(!r.x&&!r.y)return;L.DomEvent.preventDefault(e);if(!this._moved){this.fire("dragstart");this._moved=!0;this._startPos=L.DomUtil.getPosition(this._element).subtract(r);L.DomUtil.addClass(document.body,"leaflet-dragging");L.DomUtil.addClass(e.target||e.srcElement,"leaflet-drag-target")}this._newPos=this._startPos.add(r);this._moving=!0;L.Util.cancelAnimFrame(this._animRequest);this._animRequest=L.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)},_updatePosition:function(){this.fire("predrag");L.DomUtil.setPosition(this._element,this._newPos);this.fire("drag")},_onUp:function(e){L.DomUtil.removeClass(document.body,"leaflet-dragging");L.DomUtil.removeClass(e.target||e.srcElement,"leaflet-drag-target");for(var t in L.Draggable.MOVE)L.DomEvent.off(document,L.Draggable.MOVE[t],this._onMove).off(document,L.Draggable.END[t],this._onUp);L.DomUtil.enableImageDrag();L.DomUtil.enableTextSelection();if(this._moved&&this._moving){L.Util.cancelAnimFrame(this._animRequest);this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})}this._moving=!1}});L.Handler=L.Class.extend({initialize:function(e){this._map=e},enable:function(){if(this._enabled)return;this._enabled=!0;this.addHooks()},disable:function(){if(!this._enabled)return;this._enabled=!1;this.removeHooks()},enabled:function(){return!!this._enabled}});L.Control=L.Class.extend({options:{position:"topright"},initialize:function(e){L.setOptions(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;t&&t.removeControl(this);this.options.position=e;t&&t.addControl(this);return this},getContainer:function(){return this._container},addTo:function(e){this._map=e;var t=this._container=this.onAdd(e),n=this.getPosition(),r=e._controlCorners[n];L.DomUtil.addClass(t,"leaflet-control");n.indexOf("bottom")!==-1?r.insertBefore(t,r.firstChild):r.appendChild(t);return this},removeFrom:function(e){var t=this.getPosition(),n=e._controlCorners[t];n.removeChild(this._container);this._map=null;this.onRemove&&this.onRemove(e);return this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}});L.control=function(e){return new L.Control(e)};L.Map.include({addControl:function(e){e.addTo(this);return this},removeControl:function(e){e.removeFrom(this);return this},_initControlPos:function(){function r(r,i){var s=t+r+" "+t+i;e[r+i]=L.DomUtil.create("div",s,n)}var e=this._controlCorners={},t="leaflet-",n=this._controlContainer=L.DomUtil.create("div",t+"control-container",this._container);r("top","left");r("top","right");r("bottom","left");r("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}});L.TileLayer=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:L.Browser.mobile,updateWhenIdle:L.Browser.mobile},initialize:function(e,t){t=L.setOptions(this,t);if(t.detectRetina&&L.Browser.retina&&t.maxZoom>0){t.tileSize=Math.floor(t.tileSize/2);t.zoomOffset++;t.minZoom>0&&t.minZoom--;this.options.maxZoom--}t.bounds&&(t.bounds=L.latLngBounds(t.bounds));this._url=e;var n=this.options.subdomains;typeof n=="string"&&(this.options.subdomains=n.split(""))},onAdd:function(e){this._map=e;this._animated=e._zoomAnimated;this._initContainer();e.on({viewreset:this._reset,moveend:this._update},this);this._animated&&e.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this);if(!this.options.updateWhenIdle){this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this);e.on("move",this._limitedUpdate,this)}this._reset();this._update()},addTo:function(e){e.addLayer(this);return this},onRemove:function(e){this._container.parentNode.removeChild(this._container);e.off({viewreset:this._reset,moveend:this._update},this);this._animated&&e.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this);this.options.updateWhenIdle||e.off("move",this._limitedUpdate,this);this._container=null;this._map=null},bringToFront:function(){var e=this._map._panes.tilePane;if(this._container){e.appendChild(this._container);this._setAutoZIndex(e,Math.max)}return this},bringToBack:function(){var e=this._map._panes.tilePane;if(this._container){e.insertBefore(this._container,e.firstChild);this._setAutoZIndex(e,Math.min)}return this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(e){this.options.opacity=e;this._map&&this._updateOpacity();return this},setZIndex:function(e){this.options.zIndex=e;this._updateZIndex();return this},setUrl:function(e,t){this._url=e;t||this.redraw();return this},redraw:function(){if(this._map){this._reset({hard:!0});this._update()}return this},_updateZIndex:function(){this._container&&this.options.zIndex!==undefined&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e,t){var n=e.children,r=-t(Infinity,-Infinity),i,s,o;for(s=0,o=n.length;s<o;s++)if(n[s]!==this._container){i=parseInt(n[s].style.zIndex,10);isNaN(i)||(r=t(r,i))}this.options.zIndex=this._container.style.zIndex=(isFinite(r)?r:0)+t(1,-1)},_updateOpacity:function(){var e,t=this._tiles;if(L.Browser.ielt9)for(e in t)L.DomUtil.setOpacity(t[e],this.options.opacity);else L.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var e=this._map._panes.tilePane;if(!this._container){this._container=L.DomUtil.create("div","leaflet-layer");this._updateZIndex();if(this._animated){var t="leaflet-tile-container";this._bgBuffer=L.DomUtil.create("div",t,this._container);this._tileContainer=L.DomUtil.create("div",t,this._container)}else this._tileContainer=this._container;e.appendChild(this._container);this.options.opacity<1&&this._updateOpacity()}},_reset:function(e){for(var t in this._tiles)this.fire("tileunload",{tile:this._tiles[t]});this._tiles={};this._tilesToLoad=0;this.options.reuseTiles&&(this._unusedTiles=[]);this._tileContainer.innerHTML="";this._animated&&e&&e.hard&&this._clearBgBuffer();this._initContainer()},_getTileSize:function(){var e=this._map,t=e.getZoom()+this.options.zoomOffset,n=this.options.maxNativeZoom,r=this.options.tileSize;n&&t>n&&(r=Math.round(e.getZoomScale(t)/e.getZoomScale(n)*r));return r},_update:function(){if(!this._map)return;var e=this._map,t=e.getPixelBounds(),n=e.getZoom(),r=this._getTileSize();if(n>this.options.maxZoom||n<this.options.minZoom)return;var i=L.bounds(t.min.divideBy(r)._floor(),t.max.divideBy(r)._floor());this._addTilesFromCenterOut(i);(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(i)},_addTilesFromCenterOut:function(e){var t=[],n=e.getCenter(),r,i,s;for(r=e.min.y;r<=e.max.y;r++)for(i=e.min.x;i<=e.max.x;i++){s=new L.Point(i,r);this._tileShouldBeLoaded(s)&&t.push(s)}var o=t.length;if(o===0)return;t.sort(function(e,t){return e.distanceTo(n)-t.distanceTo(n)});var u=document.createDocumentFragment();this._tilesToLoad||this.fire("loading");this._tilesToLoad+=o;for(i=0;i<o;i++)this._addTile(t[i],u);this._tileContainer.appendChild(u)},_tileShouldBeLoaded:function(e){if(e.x+":"+e.y in this._tiles)return!1;var t=this.options;if(!t.continuousWorld){var n=this._getWrapTileNum();if(t.noWrap&&(e.x<0||e.x>=n.x)||e.y<0||e.y>=n.y)return!1}if(t.bounds){var r=t.tileSize,i=e.multiplyBy(r),s=i.add([r,r]),o=this._map.unproject(i),u=this._map.unproject(s);if(!t.continuousWorld&&!t.noWrap){o=o.wrap();u=u.wrap()}if(!t.bounds.intersects([o,u]))return!1}return!0},_removeOtherTiles:function(e){var t,n,r,i;for(i in this._tiles){t=i.split(":");n=parseInt(t[0],10);r=parseInt(t[1],10);(n<e.min.x||n>e.max.x||r<e.min.y||r>e.max.y)&&this._removeTile(i)}},_removeTile:function(e){var t=this._tiles[e];this.fire("tileunload",{tile:t,url:t.src});if(this.options.reuseTiles){L.DomUtil.removeClass(t,"leaflet-tile-loaded");this._unusedTiles.push(t)}else t.parentNode===this._tileContainer&&this._tileContainer.removeChild(t);if(!L.Browser.android){t.onload=null;t.src=L.Util.emptyImageUrl}delete this._tiles[e]},_addTile:function(e,t){var n=this._getTilePos(e),r=this._getTile();L.DomUtil.setPosition(r,n,L.Browser.chrome);this._tiles[e.x+":"+e.y]=r;this._loadTile(r,e);r.parentNode!==this._tileContainer&&t.appendChild(r)},_getZoomForUrl:function(){var e=this.options,t=this._map.getZoom();e.zoomReverse&&(t=e.maxZoom-t);t+=e.zoomOffset;return e.maxNativeZoom?Math.min(t,e.maxNativeZoom):t},_getTilePos:function(e){var t=this._map.getPixelOrigin(),n=this._getTileSize();return e.multiplyBy(n).subtract(t)},getTileUrl:function(e){return L.Util.template(this._url,L.extend({s:this._getSubdomain(e),z:e.z,x:e.x,y:e.y},this.options))},_getWrapTileNum:function(){var e=this._map.options.crs,t=e.getSize(this._map.getZoom());return t.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(e){var t=this._getWrapTileNum();!this.options.continuousWorld&&!this.options.noWrap&&(e.x=(e.x%t.x+t.x)%t.x);this.options.tms&&(e.y=t.y-e.y-1);e.z=this._getZoomForUrl()},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var e=this._unusedTiles.pop();this._resetTile(e);return e}return this._createTile()},_resetTile:function(){},_createTile:function(){var e=L.DomUtil.create("img","leaflet-tile");e.style.width=e.style.height=this._getTileSize()+"px";e.galleryimg="no";e.onselectstart=e.onmousemove=L.Util.falseFn;L.Browser.ielt9&&this.options.opacity!==undefined&&L.DomUtil.setOpacity(e,this.options.opacity);L.Browser.mobileWebkit3d&&(e.style.WebkitBackfaceVisibility="hidden");return e},_loadTile:function(e,t){e._layer=this;e.onload=this._tileOnLoad;e.onerror=this._tileOnError;this._adjustTilePoint(t);e.src=this.getTileUrl(t);this.fire("tileloadstart",{tile:e,url:e.src})},_tileLoaded:function(){this._tilesToLoad--;this._animated&&L.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated");if(!this._tilesToLoad){this.fire("load");if(this._animated){clearTimeout(this._clearBgBufferTimer);this._clearBgBufferTimer=setTimeout(L.bind(this._clearBgBuffer,this),500)}}},_tileOnLoad:function(){var e=this._layer;if(this.src!==L.Util.emptyImageUrl){L.DomUtil.addClass(this,"leaflet-tile-loaded");e.fire("tileload",{tile:this,url:this.src})}e._tileLoaded()},_tileOnError:function(){var e=this._layer;e.fire("tileerror",{tile:this,url:this.src});var t=e.options.errorTileUrl;t&&(this.src=t);e._tileLoaded()}});L.tileLayer=function(e,t){return new L.TileLayer(e,t)};L.TileLayer.Canvas=L.TileLayer.extend({options:{async:!1},initialize:function(e){L.setOptions(this,e)},redraw:function(){if(this._map){this._reset({hard:!0});this._update()}for(var e in this._tiles)this._redrawTile(this._tiles[e]);return this},_redrawTile:function(e){this.drawTile(e,e._tilePoint,this._map._zoom)},_createTile:function(){var e=L.DomUtil.create("canvas","leaflet-tile");e.width=e.height=this.options.tileSize;e.onselectstart=e.onmousemove=L.Util.falseFn;return e},_loadTile:function(e,t){e._layer=this;e._tilePoint=t;this._redrawTile(e);this.options.async||this.tileDrawn(e)},drawTile:function(){},tileDrawn:function(e){this._tileOnLoad.call(e)}});L.tileLayer.canvas=function(e){return new L.TileLayer.Canvas(e)};L.ImageOverlay=L.Class.extend({includes:L.Mixin.Events,options:{opacity:1},initialize:function(e,t,n){this._url=e;this._bounds=L.latLngBounds(t);L.setOptions(this,n)},onAdd:function(e){this._map=e;this._image||this._initImage();e._panes.overlayPane.appendChild(this._image);e.on("viewreset",this._reset,this);e.options.zoomAnimation&&L.Browser.any3d&&e.on("zoomanim",this._animateZoom,this);this._reset()},onRemove:function(e){e.getPanes().overlayPane.removeChild(this._image);e.off("viewreset",this._reset,this);e.options.zoomAnimation&&e.off("zoomanim",this._animateZoom,this)},addTo:function(e){e.addLayer(this);return this},setOpacity:function(e){this.options.opacity=e;this._updateOpacity();return this},bringToFront:function(){this._image&&this._map._panes.overlayPane.appendChild(this._image);return this},bringToBack:function(){var e=this._map._panes.overlayPane;this._image&&e.insertBefore(this._image,e.firstChild);return this},setUrl:function(e){this._url=e;this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=L.DomUtil.create("img","leaflet-image-layer");this._map.options.zoomAnimation&&L.Browser.any3d?L.DomUtil.addClass(this._image,"leaflet-zoom-animated"):L.DomUtil.addClass(this._image,"leaflet-zoom-hide");this._updateOpacity();L.extend(this._image,{galleryimg:"no",onselectstart:L.Util.falseFn,onmousemove:L.Util.falseFn,onload:L.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(e){var t=this._map,n=this._image,r=t.getZoomScale(e.zoom),i=this._bounds.getNorthWest(),s=this._bounds.getSouthEast(),o=t._latLngToNewLayerPoint(i,e.zoom,e.center),u=t._latLngToNewLayerPoint(s,e.zoom,e.center)._subtract(o),a=o._add(u._multiplyBy(.5*(1-1/r)));n.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(a)+" scale("+r+") "},_reset:function(){var e=this._image,t=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),n=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(t);L.DomUtil.setPosition(e,t);e.style.width=n.x+"px";e.style.height=n.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){L.DomUtil.setOpacity(this._image,this.options.opacity)}});L.imageOverlay=function(e,t,n){return new L.ImageOverlay(e,t,n)};L.Icon=L.Class.extend({options:{className:""},initialize:function(e){L.setOptions(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var n=this._getIconUrl(e);if(!n){if(e==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r;!t||t.tagName!=="IMG"?r=this._createImg(n):r=this._createImg(n,t);this._setIconStyles(r,e);return r},_setIconStyles:function(e,t){var n=this.options,r=L.point(n[t+"Size"]),i;t==="shadow"?i=L.point(n.shadowAnchor||n.iconAnchor):i=L.point(n.iconAnchor);!i&&r&&(i=r.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+n.className;if(i){e.style.marginLeft=-i.x+"px";e.style.marginTop=-i.y+"px"}if(r){e.style.width=r.x+"px";e.style.height=r.y+"px"}},_createImg:function(e,t){t=t||document.createElement("img");t.src=e;return t},_getIconUrl:function(e){return L.Browser.retina&&this.options[e+"RetinaUrl"]?this.options[e+"RetinaUrl"]:this.options[e+"Url"]}});L.icon=function(e){return new L.Icon(e)};L.Icon.Default=L.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(e){var t=e+"Url";if(this.options[t])return this.options[t];L.Browser.retina&&e==="icon"&&(e+="-2x");var n=L.Icon.Default.imagePath;if(!n)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return n+"/marker-"+e+".png"}});L.Icon.Default.imagePath=function(){var e=document.getElementsByTagName("script"),t=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/,n,r,i,s,o;for(n=0,r=e.length;n<r;n++){i=e[n].src;s=i.match(t);if(s){o=i.split(t)[0];return(o?o+"/":"")+"images"}}}();L.Marker=L.Class.extend({includes:L.Mixin.Events,options:{icon:new L.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(e,t){L.setOptions(this,t);this._latlng=L.latLng(e)},onAdd:function(e){this._map=e;e.on("viewreset",this.update,this);this._initIcon();this.update();this.fire("add");e.options.zoomAnimation&&e.options.markerZoomAnimation&&e.on("zoomanim",this._animateZoom,this)},addTo:function(e){e.addLayer(this);return this},onRemove:function(e){this.dragging&&this.dragging.disable();this._removeIcon();this._removeShadow();this.fire("remove");e.off({viewreset:this.update,zoomanim:this._animateZoom},this);this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(e){this._latlng=L.latLng(e);this.update();return this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(e){this.options.zIndexOffset=e;this.update();return this},setIcon:function(e){this.options.icon=e;if(this._map){this._initIcon();this.update()}this._popup&&this.bindPopup(this._popup);return this},update:function(){if(this._icon){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t=this._map,n=t.options.zoomAnimation&&t.options.markerZoomAnimation,r=n?"leaflet-zoom-animated":"leaflet-zoom-hide",i=e.icon.createIcon(this._icon),s=!1;if(i!==this._icon){this._icon&&this._removeIcon();s=!0;e.title&&(i.title=e.title);e.alt&&(i.alt=e.alt)}L.DomUtil.addClass(i,r);e.keyboard&&(i.tabIndex="0");this._icon=i;this._initInteraction();e.riseOnHover&&L.DomEvent.on(i,"mouseover",this._bringToFront,this).on(i,"mouseout",this._resetZIndex,this);var o=e.icon.createShadow(this._shadow),u=!1;if(o!==this._shadow){this._removeShadow();u=!0}o&&L.DomUtil.addClass(o,r);this._shadow=o;e.opacity<1&&this._updateOpacity();var a=this._map._panes;s&&a.markerPane.appendChild(this._icon);o&&u&&a.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&L.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex);this._map._panes.markerPane.removeChild(this._icon);this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow);this._shadow=null},_setPos:function(e){L.DomUtil.setPosition(this._icon,e);this._shadow&&L.DomUtil.setPosition(this._shadow,e);this._zIndex=e.y+this.options.zIndexOffset;this._resetZIndex()},_updateZIndex:function(e){this._icon.style.zIndex=this._zIndex+e},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(!this.options.clickable)return;var e=this._icon,t=["dblclick","mousedown","mouseover","mouseout","contextmenu"];L.DomUtil.addClass(e,"leaflet-clickable");L.DomEvent.on(e,"click",this._onMouseClick,this);L.DomEvent.on(e,"keypress",this._onKeyPress,this);for(var n=0;n<t.length;n++)L.DomEvent.on(e,t[n],this._fireMouseEvent,this);if(L.Handler.MarkerDrag){this.dragging=new L.Handler.MarkerDrag(this);this.options.draggable&&this.dragging.enable()}},_onMouseClick:function(e){var t=this.dragging&&this.dragging.moved();(this.hasEventListeners(e.type)||t)&&L.DomEvent.stopPropagation(e);if(t)return;if((!this.dragging||!this.dragging._enabled)&&this._map.dragging&&this._map.dragging.moved())return;this.fire(e.type,{originalEvent:e,latlng:this._latlng})},_onKeyPress:function(e){e.keyCode===13&&this.fire("click",{originalEvent:e,latlng:this._latlng})},_fireMouseEvent:function(e){this.fire(e.type,{originalEvent:e,latlng:this._latlng});e.type==="contextmenu"&&this.hasEventListeners(e.type)&&L.DomEvent.preventDefault(e);e.type!=="mousedown"?L.DomEvent.stopPropagation(e):L.DomEvent.preventDefault(e)},setOpacity:function(e){this.options.opacity=e;this._map&&this._updateOpacity();return this},_updateOpacity:function(){L.DomUtil.setOpacity(this._icon,this.options.opacity);this._shadow&&L.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}});L.marker=function(e,t){return new L.Marker(e,t)};L.DivIcon=L.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(e){var t=e&&e.tagName==="DIV"?e:document.createElement("div"),n=this.options;n.html!==!1?t.innerHTML=n.html:t.innerHTML="";n.bgPos&&(t.style.backgroundPosition=-n.bgPos.x+"px "+ -n.bgPos.y+"px");this._setIconStyles(t,"icon");return t},createShadow:function(){return null}});L.divIcon=function(e){return new L.DivIcon(e)};L.LayerGroup=L.Class.extend({initialize:function(e){this._layers={};var t,n;if(e)for(t=0,n=e.length;t<n;t++)this.addLayer(e[t])},addLayer:function(e){var t=this.getLayerId(e);this._layers[t]=e;this._map&&this._map.addLayer(e);return this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]);delete this._layers[t];return this},hasLayer:function(e){return e?e in this._layers||this.getLayerId(e)in this._layers:!1},clearLayers:function(){this.eachLayer(this.removeLayer,this);return this},invoke:function(e){var t=Array.prototype.slice.call(arguments,1),n,r;for(n in this._layers){r=this._layers[n];r[e]&&r[e].apply(r,t)}return this},onAdd:function(e){this._map=e;this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e);this._map=null},addTo:function(e){e.addLayer(this);return this},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];for(var t in this._layers)e.push(this._layers[t]);return e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return L.stamp(e)}});L.layerGroup=function(e){return new L.LayerGroup(e)};L.FeatureGroup=L.LayerGroup.extend({includes:L.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(e){if(this.hasLayer(e))return this;"on"in e&&e.on(L.FeatureGroup.EVENTS,this._propagateEvent,this);L.LayerGroup.prototype.addLayer.call(this,e);this._popupContent&&e.bindPopup&&e.bindPopup(this._popupContent,this._popupOptions);return this.fire("layeradd",{layer:e})},removeLayer:function(e){if(!this.hasLayer(e))return this;e in this._layers&&(e=this._layers[e]);e.off(L.FeatureGroup.EVENTS,this._propagateEvent,this);L.LayerGroup.prototype.removeLayer.call(this,e);this._popupContent&&this.invoke("unbindPopup");return this.fire("layerremove",{layer:e})},bindPopup:function(e,t){this._popupContent=e;this._popupOptions=t;return this.invoke("bindPopup",e,t)},openPopup:function(e){for(var t in this._layers){this._layers[t].openPopup(e);break}return this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new L.LatLngBounds;this.eachLayer(function(t){e.extend(t instanceof L.Marker?t.getLatLng():t.getBounds())});return e},_propagateEvent:function(e){e=L.extend({layer:e.target,target:this},e);this.fire(e.type,e)}});L.featureGroup=function(e){return new L.FeatureGroup(e)};L.Path=L.Class.extend({includes:[L.Mixin.Events],statics:{CLIP_PADDING:function(){var e=L.Browser.mobile?1280:2e3,t=(e/Math.max(window.outerWidth,window.outerHeight)-1)/2;return Math.max(0,Math.min(.5,t))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(e){L.setOptions(this,e)},onAdd:function(e){this._map=e;if(!this._container){this._initElements();this._initEvents()}this.projectLatlngs();this._updatePath();this._container&&this._map._pathRoot.appendChild(this._container);this.fire("add");e.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(e){e.addLayer(this);return this},onRemove:function(e){e._pathRoot.removeChild(this._container);this.fire("remove");this._map=null;if(L.Browser.vml){this._container=null;this._stroke=null;this._fill=null}e.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(e){L.setOptions(this,e);this._container&&this._updateStyle();return this},redraw:function(){if(this._map){this.projectLatlngs();this._updatePath()}return this}});L.Map.include({_updatePathViewport:function(){var e=L.Path.CLIP_PADDING,t=this.getSize(),n=L.DomUtil.getPosition(this._mapPane),r=n.multiplyBy(-1)._subtract(t.multiplyBy(e)._round()),i=r.add(t.multiplyBy(1+e*2)._round());this._pathViewport=new L.Bounds(r,i)}});L.Path.SVG_NS="http://www.w3.org/2000/svg";L.Browser.svg=!!document.createElementNS&&!!document.createElementNS(L.Path.SVG_NS,"svg").createSVGRect;L.Path=L.Path.extend({statics:{SVG:L.Browser.svg},bringToFront:function(){var e=this._map._pathRoot,t=this._container;t&&e.lastChild!==t&&e.appendChild(t);return this},bringToBack:function(){var e=this._map._pathRoot,t=this._container,n=e.firstChild;t&&n!==t&&e.insertBefore(t,n);return this},getPathString:function(){},_createElement:function(e){return document.createElementNS(L.Path.SVG_NS,e)},_initElements:function(){this._map._initPathRoot();this._initPath
();this._initStyle()},_initPath:function(){this._container=this._createElement("g");this._path=this._createElement("path");this.options.className&&L.DomUtil.addClass(this._path,this.options.className);this._container.appendChild(this._path)},_initStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke-linejoin","round");this._path.setAttribute("stroke-linecap","round")}this.options.fill&&this._path.setAttribute("fill-rule","evenodd");this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents);!this.options.clickable&&!this.options.pointerEvents&&this._path.setAttribute("pointer-events","none");this._updateStyle()},_updateStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke",this.options.color);this._path.setAttribute("stroke-opacity",this.options.opacity);this._path.setAttribute("stroke-width",this.options.weight);this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray");this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap);this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)}else this._path.setAttribute("stroke","none");if(this.options.fill){this._path.setAttribute("fill",this.options.fillColor||this.options.color);this._path.setAttribute("fill-opacity",this.options.fillOpacity)}else this._path.setAttribute("fill","none")},_updatePath:function(){var e=this.getPathString();e||(e="M0 0");this._path.setAttribute("d",e)},_initEvents:function(){if(this.options.clickable){(L.Browser.svg||!L.Browser.vml)&&L.DomUtil.addClass(this._path,"leaflet-clickable");L.DomEvent.on(this._container,"click",this._onMouseClick,this);var e=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"];for(var t=0;t<e.length;t++)L.DomEvent.on(this._container,e[t],this._fireMouseEvent,this)}},_onMouseClick:function(e){if(this._map.dragging&&this._map.dragging.moved())return;this._fireMouseEvent(e)},_fireMouseEvent:function(e){if(!this.hasEventListeners(e.type))return;var t=this._map,n=t.mouseEventToContainerPoint(e),r=t.containerPointToLayerPoint(n),i=t.layerPointToLatLng(r);this.fire(e.type,{latlng:i,layerPoint:r,containerPoint:n,originalEvent:e});e.type==="contextmenu"&&L.DomEvent.preventDefault(e);e.type!=="mousemove"&&L.DomEvent.stopPropagation(e)}});L.Map.include({_initPathRoot:function(){if(!this._pathRoot){this._pathRoot=L.Path.prototype._createElement("svg");this._panes.overlayPane.appendChild(this._pathRoot);if(this.options.zoomAnimation&&L.Browser.any3d){L.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated");this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})}else L.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide");this.on("moveend",this._updateSvgViewport);this._updateSvgViewport()}},_animatePathZoom:function(e){var t=this.getZoomScale(e.zoom),n=this._getCenterOffset(e.center)._multiplyBy(-t)._add(this._pathViewport.min);this._pathRoot.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(n)+" scale("+t+") ";this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(this._pathZooming)return;this._updatePathViewport();var e=this._pathViewport,t=e.min,n=e.max,r=n.x-t.x,i=n.y-t.y,s=this._pathRoot,o=this._panes.overlayPane;L.Browser.mobileWebkit&&o.removeChild(s);L.DomUtil.setPosition(s,t);s.setAttribute("width",r);s.setAttribute("height",i);s.setAttribute("viewBox",[t.x,t.y,r,i].join(" "));L.Browser.mobileWebkit&&o.appendChild(s)}});L.Browser.canvas=function(){return!!document.createElement("canvas").getContext}();L.Path=L.Path.SVG&&!window.L_PREFER_CANVAS||!L.Browser.canvas?L.Path:L.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){if(this._map){this.projectLatlngs();this._requestUpdate()}return this},setStyle:function(e){L.setOptions(this,e);if(this._map){this._updateStyle();this._requestUpdate()}return this},onRemove:function(e){e.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this);if(this.options.clickable){this._map.off("click",this._onClick,this);this._map.off("mousemove",this._onMouseMove,this)}this._requestUpdate();this._map=null},_requestUpdate:function(){this._map&&!L.Path._updateRequest&&(L.Path._updateRequest=L.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){L.Path._updateRequest=null;this.fire("moveend")},_initElements:function(){this._map._initPathRoot();this._ctx=this._map._canvasCtx},_updateStyle:function(){var e=this.options;if(e.stroke){this._ctx.lineWidth=e.weight;this._ctx.strokeStyle=e.color}e.fill&&(this._ctx.fillStyle=e.fillColor||e.color)},_drawPath:function(){var e,t,n,r,i,s;this._ctx.beginPath();for(e=0,n=this._parts.length;e<n;e++){for(t=0,r=this._parts[e].length;t<r;t++){i=this._parts[e][t];s=(t===0?"move":"line")+"To";this._ctx[s](i.x,i.y)}this instanceof L.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(this._checkIfEmpty())return;var e=this._ctx,t=this.options;this._drawPath();e.save();this._updateStyle();if(t.fill){e.globalAlpha=t.fillOpacity;e.fill()}if(t.stroke){e.globalAlpha=t.opacity;e.stroke()}e.restore()},_initEvents:function(){if(this.options.clickable){this._map.on("mousemove",this._onMouseMove,this);this._map.on("click",this._onClick,this)}},_onClick:function(e){this._containsPoint(e.layerPoint)&&this.fire("click",e)},_onMouseMove:function(e){if(!this._map||this._map._animatingZoom)return;if(this._containsPoint(e.layerPoint)){this._ctx.canvas.style.cursor="pointer";this._mouseInside=!0;this.fire("mouseover",e)}else if(this._mouseInside){this._ctx.canvas.style.cursor="";this._mouseInside=!1;this.fire("mouseout",e)}}});L.Map.include(L.Path.SVG&&!window.L_PREFER_CANVAS||!L.Browser.canvas?{}:{_initPathRoot:function(){var e=this._pathRoot,t;if(!e){e=this._pathRoot=document.createElement("canvas");e.style.position="absolute";t=this._canvasCtx=e.getContext("2d");t.lineCap="round";t.lineJoin="round";this._panes.overlayPane.appendChild(e);if(this.options.zoomAnimation){this._pathRoot.className="leaflet-zoom-animated";this.on("zoomanim",this._animatePathZoom);this.on("zoomend",this._endPathZoom)}this.on("moveend",this._updateCanvasViewport);this._updateCanvasViewport()}},_updateCanvasViewport:function(){if(this._pathZooming)return;this._updatePathViewport();var e=this._pathViewport,t=e.min,n=e.max.subtract(t),r=this._pathRoot;L.DomUtil.setPosition(r,t);r.width=n.x;r.height=n.y;r.getContext("2d").translate(-t.x,-t.y)}});L.LineUtil={simplify:function(e,t){if(!t||!e.length)return e.slice();var n=t*t;e=this._reducePoints(e,n);e=this._simplifyDP(e,n);return e},pointToSegmentDistance:function(e,t,n){return Math.sqrt(this._sqClosestPointOnSegment(e,t,n,!0))},closestPointOnSegment:function(e,t,n){return this._sqClosestPointOnSegment(e,t,n)},_simplifyDP:function(e,t){var n=e.length,r=typeof Uint8Array!=undefined+""?Uint8Array:Array,i=new r(n);i[0]=i[n-1]=1;this._simplifyDPStep(e,i,t,0,n-1);var s,o=[];for(s=0;s<n;s++)i[s]&&o.push(e[s]);return o},_simplifyDPStep:function(e,t,n,r,i){var s=0,o,u,a;for(u=r+1;u<=i-1;u++){a=this._sqClosestPointOnSegment(e[u],e[r],e[i],!0);if(a>s){o=u;s=a}}if(s>n){t[o]=1;this._simplifyDPStep(e,t,n,r,o);this._simplifyDPStep(e,t,n,o,i)}},_reducePoints:function(e,t){var n=[e[0]];for(var r=1,i=0,s=e.length;r<s;r++)if(this._sqDist(e[r],e[i])>t){n.push(e[r]);i=r}i<s-1&&n.push(e[s-1]);return n},clipSegment:function(e,t,n,r){var i=r?this._lastCode:this._getBitCode(e,n),s=this._getBitCode(t,n),o,u,a;this._lastCode=s;for(;;){if(!(i|s))return[e,t];if(i&s)return!1;o=i||s;u=this._getEdgeIntersection(e,t,o,n);a=this._getBitCode(u,n);if(o===i){e=u;i=a}else{t=u;s=a}}},_getEdgeIntersection:function(e,t,n,r){var i=t.x-e.x,s=t.y-e.y,o=r.min,u=r.max;if(n&8)return new L.Point(e.x+i*(u.y-e.y)/s,u.y);if(n&4)return new L.Point(e.x+i*(o.y-e.y)/s,o.y);if(n&2)return new L.Point(u.x,e.y+s*(u.x-e.x)/i);if(n&1)return new L.Point(o.x,e.y+s*(o.x-e.x)/i)},_getBitCode:function(e,t){var n=0;e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2);e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8);return n},_sqDist:function(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r},_sqClosestPointOnSegment:function(e,t,n,r){var i=t.x,s=t.y,o=n.x-i,u=n.y-s,a=o*o+u*u,f;if(a>0){f=((e.x-i)*o+(e.y-s)*u)/a;if(f>1){i=n.x;s=n.y}else if(f>0){i+=o*f;s+=u*f}}o=e.x-i;u=e.y-s;return r?o*o+u*u:new L.Point(i,s)}};L.Polyline=L.Path.extend({initialize:function(e,t){L.Path.prototype.initialize.call(this,t);this._latlngs=this._convertLatLngs(e)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var e=0,t=this._latlngs.length;e<t;e++)this._originalPoints[e]=this._map.latLngToLayerPoint(this._latlngs[e])},getPathString:function(){for(var e=0,t=this._parts.length,n="";e<t;e++)n+=this._getPathPartStr(this._parts[e]);return n},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){this._latlngs=this._convertLatLngs(e);return this.redraw()},addLatLng:function(e){this._latlngs.push(L.latLng(e));return this.redraw()},spliceLatLngs:function(){var e=[].splice.apply(this._latlngs,arguments);this._convertLatLngs(this._latlngs,!0);this.redraw();return e},closestLayerPoint:function(e){var t=Infinity,n=this._parts,r,i,s=null;for(var o=0,u=n.length;o<u;o++){var a=n[o];for(var f=1,l=a.length;f<l;f++){r=a[f-1];i=a[f];var c=L.LineUtil._sqClosestPointOnSegment(e,r,i,!0);if(c<t){t=c;s=L.LineUtil._sqClosestPointOnSegment(e,r,i)}}}s&&(s.distance=Math.sqrt(t));return s},getBounds:function(){return new L.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(e,t){var n,r,i=t?e:[];for(n=0,r=e.length;n<r;n++){if(L.Util.isArray(e[n])&&typeof e[n][0]!="number")return;i[n]=L.latLng(e[n])}return i},_initEvents:function(){L.Path.prototype._initEvents.call(this)},_getPathPartStr:function(e){var t=L.Path.VML;for(var n=0,r=e.length,i="",s;n<r;n++){s=e[n];t&&s._round();i+=(n?"L":"M")+s.x+" "+s.y}return i},_clipPoints:function(){var e=this._originalPoints,t=e.length,n,r,i;if(this.options.noClip){this._parts=[e];return}this._parts=[];var s=this._parts,o=this._map._pathViewport,u=L.LineUtil;for(n=0,r=0;n<t-1;n++){i=u.clipSegment(e[n],e[n+1],o,n);if(!i)continue;s[r]=s[r]||[];s[r].push(i[0]);if(i[1]!==e[n+1]||n===t-2){s[r].push(i[1]);r++}}},_simplifyPoints:function(){var e=this._parts,t=L.LineUtil;for(var n=0,r=e.length;n<r;n++)e[n]=t.simplify(e[n],this.options.smoothFactor)},_updatePath:function(){if(!this._map)return;this._clipPoints();this._simplifyPoints();L.Path.prototype._updatePath.call(this)}});L.polyline=function(e,t){return new L.Polyline(e,t)};L.PolyUtil={};L.PolyUtil.clipPolygon=function(e,t){var n,r=[1,4,2,8],i,s,o,u,a,f,l,c,h=L.LineUtil;for(i=0,f=e.length;i<f;i++)e[i]._code=h._getBitCode(e[i],t);for(o=0;o<4;o++){l=r[o];n=[];for(i=0,f=e.length,s=f-1;i<f;s=i++){u=e[i];a=e[s];if(!(u._code&l)){if(a._code&l){c=h._getEdgeIntersection(a,u,l,t);c._code=h._getBitCode(c,t);n.push(c)}n.push(u)}else if(!(a._code&l)){c=h._getEdgeIntersection(a,u,l,t);c._code=h._getBitCode(c,t);n.push(c)}}e=n}return e};L.Polygon=L.Polyline.extend({options:{fill:!0},initialize:function(e,t){L.Polyline.prototype.initialize.call(this,e,t);this._initWithHoles(e)},_initWithHoles:function(e){var t,n,r;if(e&&L.Util.isArray(e[0])&&typeof e[0][0]!="number"){this._latlngs=this._convertLatLngs(e[0]);this._holes=e.slice(1);for(t=0,n=this._holes.length;t<n;t++){r=this._holes[t]=this._convertLatLngs(this._holes[t]);r[0].equals(r[r.length-1])&&r.pop()}}e=this._latlngs;e.length>=2&&e[0].equals(e[e.length-1])&&e.pop()},projectLatlngs:function(){L.Polyline.prototype.projectLatlngs.call(this);this._holePoints=[];if(!this._holes)return;var e,t,n,r;for(e=0,n=this._holes.length;e<n;e++){this._holePoints[e]=[];for(t=0,r=this._holes[e].length;t<r;t++)this._holePoints[e][t]=this._map.latLngToLayerPoint(this._holes[e][t])}},setLatLngs:function(e){if(e&&L.Util.isArray(e[0])&&typeof e[0][0]!="number"){this._initWithHoles(e);return this.redraw()}return L.Polyline.prototype.setLatLngs.call(this,e)},_clipPoints:function(){var e=this._originalPoints,t=[];this._parts=[e].concat(this._holePoints);if(this.options.noClip)return;for(var n=0,r=this._parts.length;n<r;n++){var i=L.PolyUtil.clipPolygon(this._parts[n],this._map._pathViewport);i.length&&t.push(i)}this._parts=t},_getPathPartStr:function(e){var t=L.Polyline.prototype._getPathPartStr.call(this,e);return t+(L.Browser.svg?"z":"x")}});L.polygon=function(e,t){return new L.Polygon(e,t)};(function(){function e(e){return L.FeatureGroup.extend({initialize:function(e,t){this._layers={};this._options=t;this.setLatLngs(e)},setLatLngs:function(t){var n=0,r=t.length;this.eachLayer(function(e){n<r?e.setLatLngs(t[n++]):this.removeLayer(e)},this);while(n<r)this.addLayer(new e(t[n++],this._options));return this},getLatLngs:function(){var e=[];this.eachLayer(function(t){e.push(t.getLatLngs())});return e}})}L.MultiPolyline=e(L.Polyline);L.MultiPolygon=e(L.Polygon);L.multiPolyline=function(e,t){return new L.MultiPolyline(e,t)};L.multiPolygon=function(e,t){return new L.MultiPolygon(e,t)}})();L.Rectangle=L.Polygon.extend({initialize:function(e,t){L.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){e=L.latLngBounds(e);return[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});L.rectangle=function(e,t){return new L.Rectangle(e,t)};L.Circle=L.Path.extend({initialize:function(e,t,n){L.Path.prototype.initialize.call(this,n);this._latlng=L.latLng(e);this._mRadius=t},options:{fill:!0},setLatLng:function(e){this._latlng=L.latLng(e);return this.redraw()},setRadius:function(e){this._mRadius=e;return this.redraw()},projectLatlngs:function(){var e=this._getLngRadius(),t=this._latlng,n=this._map.latLngToLayerPoint([t.lat,t.lng-e]);this._point=this._map.latLngToLayerPoint(t);this._radius=Math.max(this._point.x-n.x,1)},getBounds:function(){var e=this._getLngRadius(),t=this._mRadius/40075017*360,n=this._latlng;return new L.LatLngBounds([n.lat-t,n.lng-e],[n.lat+t,n.lng+e])},getLatLng:function(){return this._latlng},getPathString:function(){var e=this._point,t=this._radius;if(this._checkIfEmpty())return"";if(L.Browser.svg)return"M"+e.x+","+(e.y-t)+"A"+t+","+t+",0,1,1,"+(e.x-.1)+","+(e.y-t)+" z";e._round();t=Math.round(t);return"AL "+e.x+","+e.y+" "+t+","+t+" 0,"+23592600},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(L.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var e=this._map._pathViewport,t=this._radius,n=this._point;return n.x-t>e.max.x||n.y-t>e.max.y||n.x+t<e.min.x||n.y+t<e.min.y}});L.circle=function(e,t,n){return new L.Circle(e,t,n)};L.CircleMarker=L.Circle.extend({options:{radius:10,weight:2},initialize:function(e,t){L.Circle.prototype.initialize.call(this,e,null,t);this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){L.Circle.prototype._updateStyle.call(this);this.setRadius(this.options.radius)},setLatLng:function(e){L.Circle.prototype.setLatLng.call(this,e);this._popup&&this._popup._isOpen&&this._popup.setLatLng(e);return this},setRadius:function(e){this.options.radius=this._radius=e;return this.redraw()},getRadius:function(){return this._radius}});L.circleMarker=function(e,t){return new L.CircleMarker(e,t)};L.Polyline.include(L.Path.CANVAS?{_containsPoint:function(e,t){var n,r,i,s,o,u,a,f=this.options.weight/2;L.Browser.touch&&(f+=10);for(n=0,s=this._parts.length;n<s;n++){a=this._parts[n];for(r=0,o=a.length,i=o-1;r<o;i=r++){if(!t&&r===0)continue;u=L.LineUtil.pointToSegmentDistance(e,a[i],a[r]);if(u<=f)return!0}}return!1}}:{});L.Map.mergeOptions({dragging:!0,inertia:!L.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,inertiaThreshold:L.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1});L.Map.Drag=L.Handler.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new L.Draggable(e._mapPane,e._container);this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this);if(e.options.worldCopyJump){this._draggable.on("predrag",this._onPreDrag,this);e.on("viewreset",this._onViewReset,this);e.whenReady(this._onViewReset,this)}}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var e=this._map;e._panAnim&&e._panAnim.stop();e.fire("movestart").fire("dragstart");if(e.options.inertia){this._positions=[];this._times=[]}},_onDrag:function(){if(this._map.options.inertia){var e=this._lastTime=+(new Date),t=this._lastPos=this._draggable._newPos;this._positions.push(t);this._times.push(e);if(e-this._times[0]>200){this._positions.shift();this._times.shift()}}this._map.fire("move").fire("drag")},_onViewReset:function(){var e=this._map.getSize()._divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x;this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var e=this._worldWidth,t=Math.round(e/2),n=this._initialWorldOffset,r=this._draggable._newPos.x,i=(r-t+n)%e+t-n,s=(r+t+n)%e-t-n,o=Math.abs(i+n)<Math.abs(s+n)?i:s;this._draggable._newPos.x=o},_onDragEnd:function(e){var t=this._map,n=t.options,r=+(new Date)-this._lastTime,i=!n.inertia||r>n.inertiaThreshold||!this._positions[0];t.fire("dragend",e);if(i)t.fire("moveend");else{var s=this._lastPos.subtract(this._positions[0]),o=(this._lastTime+r-this._times[0])/1e3,u=n.easeLinearity,a=s.multiplyBy(u/o),f=a.distanceTo([0,0]),l=Math.min(n.inertiaMaxSpeed,f),c=a.multiplyBy(l/f),h=l/(n.inertiaDeceleration*u),p=c.multiplyBy(-h/2).round();if(!p.x||!p.y)t.fire("moveend");else{p=t._limitOffset(p,t.options.maxBounds);L.Util.requestAnimFrame(function(){t.panBy(p,{duration:h,easeLinearity:u,noMoveStart:!0})})}}}});L.Map.addInitHook("addHandler","dragging",L.Map.Drag);L.Map.mergeOptions({doubleClickZoom:!0});L.Map.DoubleClickZoom=L.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,n=t.getZoom()+(e.originalEvent.shiftKey?-1:1);t.options.doubleClickZoom==="center"?t.setZoom(n):t.setZoomAround(e.containerPoint,n)}});L.Map.addInitHook("addHandler","doubleClickZoom",L.Map.DoubleClickZoom);L.Map.mergeOptions({scrollWheelZoom:!0});L.Map.ScrollWheelZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this);L.DomEvent.on(this._map._container,"MozMousePixelScroll",L.DomEvent.preventDefault);this._delta=0},removeHooks:function(){L.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll);L.DomEvent.off(this._map._container,"MozMousePixelScroll",L.DomEvent.preventDefault)},_onWheelScroll:function(e){var t=L.DomEvent.getWheelDelta(e);this._delta+=t;this._lastMousePos=this._map.mouseEventToContainerPoint(e);this._startTime||(this._startTime=+(new Date));var n=Math.max(40-(+(new Date)-this._startTime),0);clearTimeout(this._timer);this._timer=setTimeout(L.bind(this._performZoom,this),n);L.DomEvent.preventDefault(e);L.DomEvent.stopPropagation(e)},_performZoom:function(){var e=this._map,t=this._delta,n=e.getZoom();t=t>0?Math.ceil(t):Math.floor(t);t=Math.max(Math.min(t,4),-4);t=e._limitZoom(n+t)-n;this._delta=0;this._startTime=null;if(!t)return;e.options.scrollWheelZoom==="center"?e.setZoom(n+t):e.setZoomAround(this._lastMousePos,n+t)}});L.Map.addInitHook("addHandler","scrollWheelZoom",L.Map.ScrollWheelZoom);L.extend(L.DomEvent,{_touchstart:L.Browser.msPointer?"MSPointerDown":L.Browser.pointer?"pointerdown":"touchstart",_touchend:L.Browser.msPointer?"MSPointerUp":L.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(e,t,n){function c(e){var t;if(L.Browser.pointer){l.push(e.pointerId);t=l.length}else t=e.touches.length;if(t>1)return;var n=Date.now(),u=n-(r||n);o=e.touches?e.touches[0]:e;i=u>0&&u<=s;r=n}function h(e){if(L.Browser.pointer){var n=l.indexOf(e.pointerId);if(n===-1)return;l.splice(n,1)}if(i){if(L.Browser.pointer){var s={},u;for(var a in o){u=o[a];typeof u=="function"?s[a]=u.bind(o):s[a]=u}o=s}o.type="dblclick";t(o);r=null}}var r,i=!1,s=250,o,u="_leaflet_",a=this._touchstart,f=this._touchend,l=[];e[u+a+n]=c;e[u+f+n]=h;var p=L.Browser.pointer?document.documentElement:e;e.addEventListener(a,c,!1);p.addEventListener(f,h,!1);L.Browser.pointer&&p.addEventListener(L.DomEvent.POINTER_CANCEL,h,!1);return this},removeDoubleTapListener:function(e,t){var n="_leaflet_";e.removeEventListener(this._touchstart,e[n+this._touchstart+t],!1);(L.Browser.pointer?document.documentElement:e).removeEventListener(this._touchend,e[n+this._touchend+t],!1);L.Browser.pointer&&document.documentElement.removeEventListener(L.DomEvent.POINTER_CANCEL,e[n+this._touchend+t],!1);return this}});L.extend(L.DomEvent,{POINTER_DOWN:L.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:L.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:L.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:L.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(e,t,n,r){switch(t){case"touchstart":return this.addPointerListenerStart(e,t,n,r);case"touchend":return this.addPointerListenerEnd(e,t,n,r);case"touchmove":return this.addPointerListenerMove(e,t,n,r);default:throw"Unknown touch event type"}},addPointerListenerStart:function(e,t,n,r){var i="_leaflet_",s=this._pointers,o=function(e){L.DomEvent.preventDefault(e);var t=!1;for(var r=0;r<s.length;r++)if(s[r].pointerId===e.pointerId){t=!0;break}t||s.push(e);e.touches=s.slice();e.changedTouches=[e];n(e)};e[i+"touchstart"+r]=o;e.addEventListener(this.POINTER_DOWN,o,!1);if(!this._pointerDocumentListener){var u=function(e){for(var t=0;t<s.length;t++)if(s[t].pointerId===e.pointerId){s.splice(t,1);break}};document.documentElement.addEventListener(this.POINTER_UP,u,!1);document.documentElement.addEventListener(this.POINTER_CANCEL,u,!1);this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(e,t,n,r){function o(e){if((e.pointerType===e.MSPOINTER_TYPE_MOUSE||e.pointerType==="mouse")&&e.buttons===0)return;for(var t=0;t<s.length;t++)if(s[t].pointerId===e.pointerId){s[t]=e;break}e.touches=s.slice();e.changedTouches=[e];n(e)}var i="_leaflet_",s=this._pointers;e[i+"touchmove"+r]=o;e.addEventListener(this.POINTER_MOVE,o,!1);return this},addPointerListenerEnd:function(e,t,n,r){var i="_leaflet_",s=this._pointers,o=function(e){for(var t=0;t<s.length;t++)if(s[t].pointerId===e.pointerId){s.splice(t,1);break}e.touches=s.slice();e.changedTouches=[e];n(e)};e[i+"touchend"+r]=o;e.addEventListener(this.POINTER_UP,o,!1);e.addEventListener(this.POINTER_CANCEL,o,!1);return this},removePointerListener:function(e,t,n){var r="_leaflet_",i=e[r+t+n];switch(t){case"touchstart":e.removeEventListener(this.POINTER_DOWN,i,!1);break;case"touchmove":e.removeEventListener(this.POINTER_MOVE,i,!1);break;case"touchend":e.removeEventListener(this.POINTER_UP,i,!1);e.removeEventListener(this.POINTER_CANCEL,i,!1)}return this}});L.Map.mergeOptions({touchZoom:L.Browser.touch&&!L.Browser.android23,bounceAtZoomLimits:!0});L.Map.TouchZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){L.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(!e.touches||e.touches.length!==2||t._animatingZoom||this._zooming)return;var n=t.mouseEventToLayerPoint(e.touches[0]),r=t.mouseEventToLayerPoint(e.touches[1]),i=t._getCenterLayerPoint();this._startCenter=n.add(r)._divideBy(2);this._startDist=n.distanceTo(r);this._moved=!1;this._zooming=!0;this._centerOffset=i.subtract(this._startCenter);t._panAnim&&t._panAnim.stop();L.DomEvent.on(document,"touchmove",this._onTouchMove,this).on(document,"touchend",this._onTouchEnd,this);L.DomEvent.preventDefault(e)},_onTouchMove:function(e){var t=this._map;if(!e.touches||e.touches.length!==2||!this._zooming)return;var n=t.mouseEventToLayerPoint(e.touches[0]),r=t.mouseEventToLayerPoint(e.touches[1]);this._scale=n.distanceTo(r)/this._startDist;this._delta=n._add(r)._divideBy(2)._subtract(this._startCenter);if(this._scale===1)return;if(!t.options.bounceAtZoomLimits)if(t.getZoom()===t.getMinZoom()&&this._scale<1||t.getZoom()===t.getMaxZoom()&&this._scale>1)return;if(!this._moved){L.DomUtil.addClass(t._mapPane,"leaflet-touching");t.fire("movestart").fire("zoomstart");this._moved=!0}L.Util.cancelAnimFrame(this._animRequest);this._animRequest=L.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container);L.DomEvent.preventDefault(e)},_updateOnMove:function(){var e=this._map,t=this._getScaleOrigin(),n=e.layerPointToLatLng(t),r=e.getScaleZoom(this._scale);e._animateZoom(n,r,this._startCenter,this._scale,this._delta)},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}var e=this._map;this._zooming=!1;L.DomUtil.removeClass(e._mapPane,"leaflet-touching");L.Util.cancelAnimFrame(this._animRequest);L.DomEvent.off(document,"touchmove",this._onTouchMove).off(document,"touchend",this._onTouchEnd);var t=this._getScaleOrigin(),n=e.layerPointToLatLng(t),r=e.getZoom(),i=e.getScaleZoom(this._scale)-r,s=i>0?Math.ceil(i):Math.floor(i),o=e._limitZoom(r+s),u=e.getZoomScale(o)/this._scale;e._animateZoom(n,o,t,u)},_getScaleOrigin:function(){var e=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(e)}});L.Map.addInitHook("addHandler","touchZoom",L.Map.TouchZoom);L.Map.mergeOptions({tap:!0,tapTolerance:15});L.Map.Tap=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){L.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(!e.touches)return;L.DomEvent.preventDefault(e);this._fireClick=!0;if(e.touches.length>1){this._fireClick=!1;clearTimeout(this._holdTimeout);return}var t=e.touches[0],n=t.target;this._startPos=this._newPos=new L.Point(t.clientX,t.clientY);n.tagName&&n.tagName.toLowerCase()==="a"&&L.DomUtil.addClass(n,"leaflet-active");this._holdTimeout=setTimeout(L.bind(function(){if(this._isTapValid()){this._fireClick=!1;this._onUp();this._simulateEvent("contextmenu",t)}},this),1e3);L.DomEvent.on(document,"touchmove",this._onMove,this).on(document,"touchend",this._onUp,this)},_onUp:function(e){clearTimeout(this._holdTimeout);L.DomEvent.off(document,"touchmove",this._onMove,this).off(document,"touchend",this._onUp,this);if(this._fireClick&&e&&e.changedTouches){var t=e.changedTouches[0],n=t.target;n&&n.tagName&&n.tagName.toLowerCase()==="a"&&L.DomUtil.removeClass(n,"leaflet-active");this._isTapValid()&&this._simulateEvent("click",t)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(e){var t=e.touches[0];this._newPos=new L.Point(t.clientX,t.clientY)},_simulateEvent:function(e,t){var n=document.createEvent("MouseEvents");n._simulated=!0;t.target._simulatedClick=!0;n.initMouseEvent(e,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null);t.target.dispatchEvent(n)}});L.Browser.touch&&!L.Browser.pointer&&L.Map.addInitHook("addHandler","tap",L.Map.Tap);L.Control.Zoom=L.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",n=L.DomUtil.create("div",t+" leaflet-bar");this._map=e;this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,t+"-in",n,this._zoomIn,this);this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,t+"-out",n,this._zoomOut,this);this._updateDisabled();e.on("zoomend zoomlevelschange",this._updateDisabled,this);return n},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(e){this._map.zoomIn(e.shiftKey?3:1)},_zoomOut:function(e){this._map.zoomOut(e.shiftKey?3:1)},_createButton:function(e,t,n,r,i,s){var o=L.DomUtil.create("a",n,r);o.innerHTML=e;o.href="#";o.title=t;var u=L.DomEvent.stopPropagation;L.DomEvent.on(o,"click",u).on(o,"mousedown",u).on(o,"dblclick",u).on(o,"click",L.DomEvent.preventDefault).on(o,"click",i,s).on(o,"click",this._refocusOnMap,s);return o},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";L.DomUtil.removeClass(this._zoomInButton,t);L.DomUtil.removeClass(this._zoomOutButton,t);e._zoom===e.getMinZoom()&&L.DomUtil.addClass(this._zoomOutButton,t);e._zoom===e.getMaxZoom()&&L.DomUtil.addClass(this._zoomInButton,t)}});L.Map.mergeOptions({zoomControl:!0});L.Map.addInitHook(function(){if(this.options.zoomControl){this.zoomControl=new L.Control.Zoom;this.addControl(this.zoomControl)}});L.control.zoom=function(e){return new L.Control.Zoom(e)};L.Control.Attribution=L.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(e){L.setOptions(this,e);this._attributions={}},onAdd:function(e){this._container=L.DomUtil.create("div","leaflet-control-attribution");L.DomEvent.disableClickPropagation(this._container);for(var t in e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());e.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this);this._update();return this._container},onRemove:function(e){e.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(e){this.options.prefix=e;this._update();return this},addAttribution:function(e){if(!e)return;this._attributions[e]||(this._attributions[e]=0);this._attributions[e]++;this._update();return this},removeAttribution:function(e){if(!e)return;if(this._attributions[e]){this._attributions[e]--;this._update()}return this},_update:function(){if(!this._map)return;var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix);e.length&&n.push(e.join(", "));this._container.innerHTML=n.join(" | ")},_onLayerAdd:function(e){e.layer.getAttribution&&this.addAttribution(e.layer.getAttribution())},_onLayerRemove:function(e){e.layer.getAttribution&&this.removeAttribution(e.layer.getAttribution())}});L.Map.mergeOptions({attributionControl:!0});L.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new L.Control.Attribution).addTo(this))});L.control.attribution=function(e){return new L.Control.Attribution(e)};L.PosAnimation=L.Class.extend({includes:L.Mixin.Events,run:function(e,t,n,r){this.stop();this._el=e;this._inProgress=!0;this._newPos=t;this.fire("start");e.style[L.DomUtil.TRANSITION]="all "+(n||.25)+"s cubic-bezier(0,0,"+(r||.5)+",1)";L.DomEvent.on(e,L.DomUtil.TRANSITION_END,this._onTransitionEnd,this);L.DomUtil.setPosition(e,t);L.Util.falseFn(e.offsetWidth);this._stepTimer=setInterval(L.bind(this._onStep,this),50)},stop:function(){if(!this._inProgress)return;L.DomUtil.setPosition(this._el,this._getPos());this._onTransitionEnd();L.Util.falseFn(this._el.offsetWidth)},_onStep:function(){var e=this._getPos();if(!e){this._onTransitionEnd();return}this._el._leaflet_pos=e;this.fire("step")},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var e,t,n,r=this._el,i=window.getComputedStyle(r);if(L.Browser.any3d){n=i[L.DomUtil.TRANSFORM].match(this._transformRe);if(!n)return;e=parseFloat(n[1]);t=parseFloat(n[2])}else{e=parseFloat(i.left);t=parseFloat(i.top)}return new L.Point(e,t,!0)},_onTransitionEnd:function(){L.DomEvent.off(this._el,L.DomUtil.TRANSITION_END,this._onTransitionEnd,this);if(!this._inProgress)return;this._inProgress=!1;this._el.style[L.DomUtil.TRANSITION]="";this._el._leaflet_pos=this._newPos;clearInterval(this._stepTimer);this.fire("step").fire("end")}});L.Map.include({setView:function(e,t,n){t=t===undefined?this._zoom:this._limitZoom(t);e=this._limitCenter(L.latLng(e),t,this.options.maxBounds);n=n||{};this._panAnim&&this._panAnim.stop();if(this._loaded&&!n.reset&&n!==!0){if(n.animate!==undefined){n.zoom=L.extend({animate:n.animate},n.zoom);n.pan=L.extend({animate:n.animate},n.pan)}var r=this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,n.zoom):this._tryAnimatedPan(e,n.pan);if(r){clearTimeout(this._sizeTimer);return this}}this._resetView(e,t);return this},panBy:function(e,t){e=L.point(e).round();t=t||{};if(!e.x&&!e.y)return this;if(!this._panAnim){
this._panAnim=new L.PosAnimation;this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)}t.noMoveStart||this.fire("movestart");if(t.animate!==!1){L.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(e);this._panAnim.run(this._mapPane,n,t.duration||.25,t.easeLinearity)}else{this._rawPanBy(e);this.fire("move").fire("moveend")}return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){L.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim");this.fire("moveend")},_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._floor();if((t&&t.animate)!==!0&&!this.getSize().contains(n))return!1;this.panBy(n,t);return!0}});L.PosAnimation=L.DomUtil.TRANSITION?L.PosAnimation:L.PosAnimation.extend({run:function(e,t,n,r){this.stop();this._el=e;this._inProgress=!0;this._duration=n||.25;this._easeOutPower=1/Math.max(r||.5,.2);this._startPos=L.DomUtil.getPosition(e);this._offset=t.subtract(this._startPos);this._startTime=+(new Date);this.fire("start");this._animate()},stop:function(){if(!this._inProgress)return;this._step();this._complete()},_animate:function(){this._animId=L.Util.requestAnimFrame(this._animate,this);this._step()},_step:function(){var e=+(new Date)-this._startTime,t=this._duration*1e3;if(e<t)this._runFrame(this._easeOut(e/t));else{this._runFrame(1);this._complete()}},_runFrame:function(e){var t=this._startPos.add(this._offset.multiplyBy(e));L.DomUtil.setPosition(this._el,t);this.fire("step")},_complete:function(){L.Util.cancelAnimFrame(this._animId);this._inProgress=!1;this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}});L.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4});L.DomUtil.TRANSITION&&L.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&L.DomUtil.TRANSITION&&L.Browser.any3d&&!L.Browser.android23&&!L.Browser.mobileOpera;this._zoomAnimated&&L.DomEvent.on(this._mapPane,L.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)});L.Map.include(L.DomUtil.TRANSITION?{_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;n=n||{};if(!this._zoomAnimated||n.animate===!1||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(t),i=this._getCenterOffset(e)._divideBy(1-1/r),s=this._getCenterLayerPoint()._add(i);if(n.animate!==!0&&!this.getSize().contains(i))return!1;this.fire("movestart").fire("zoomstart");this._animateZoom(e,t,s,r,null,!0);return!0},_animateZoom:function(e,t,n,r,i,s){this._animatingZoom=!0;L.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim");this._animateToCenter=e;this._animateToZoom=t;L.Draggable&&(L.Draggable._disabled=!0);this.fire("zoomanim",{center:e,zoom:t,origin:n,scale:r,delta:i,backwards:s})},_onZoomTransitionEnd:function(){this._animatingZoom=!1;L.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim");this._resetView(this._animateToCenter,this._animateToZoom,!0,!0);L.Draggable&&(L.Draggable._disabled=!1)}}:{});L.TileLayer.include({_animateZoom:function(e){if(!this._animating){this._animating=!0;this._prepareBgBuffer()}var t=this._bgBuffer,n=L.DomUtil.TRANSFORM,r=e.delta?L.DomUtil.getTranslateString(e.delta):t.style[n],i=L.DomUtil.getScaleString(e.scale,e.origin);t.style[n]=e.backwards?i+" "+r:r+" "+i},_endZoomAnim:function(){var e=this._tileContainer,t=this._bgBuffer;e.style.visibility="";e.parentNode.appendChild(e);L.Util.falseFn(t.offsetWidth);this._animating=!1},_clearBgBuffer:function(){var e=this._map;if(e&&!e._animatingZoom&&!e.touchZoom._zooming){this._bgBuffer.innerHTML="";this._bgBuffer.style[L.DomUtil.TRANSFORM]=""}},_prepareBgBuffer:function(){var e=this._tileContainer,t=this._bgBuffer,n=this._getLoadedTilesPercentage(t),r=this._getLoadedTilesPercentage(e);if(t&&n>.5&&r<.5){e.style.visibility="hidden";this._stopLoadingImages(e);return}t.style.visibility="hidden";t.style[L.DomUtil.TRANSFORM]="";this._tileContainer=t;t=this._bgBuffer=e;this._stopLoadingImages(t);clearTimeout(this._clearBgBufferTimer)},_getLoadedTilesPercentage:function(e){var t=e.getElementsByTagName("img"),n,r,i=0;for(n=0,r=t.length;n<r;n++)t[n].complete&&i++;return i/r},_stopLoadingImages:function(e){var t=Array.prototype.slice.call(e.getElementsByTagName("img")),n,r,i;for(n=0,r=t.length;n<r;n++){i=t[n];if(!i.complete){i.onload=L.Util.falseFn;i.onerror=L.Util.falseFn;i.src=L.Util.emptyImageUrl;i.parentNode.removeChild(i)}}}});L.TileLayer.Zoomify=L.TileLayer.extend({options:{continuousWorld:!0,tolerance:.8},initialize:function(e,t){t=L.setOptions(this,t);this._url=e;var n=L.point(t.width,t.height),r=t.tileSize;this._imageSize=[n];this._gridSize=[this._getGridSize(n)];while(n.x>r||n.y>r){n=n.divideBy(2).floor();this._imageSize.push(n);this._gridSize.push(this._getGridSize(n))}this._imageSize.reverse();this._gridSize.reverse();this.options.maxZoom=this._gridSize.length-1},onAdd:function(e){L.TileLayer.prototype.onAdd.call(this,e);var t=e.getSize(),n=this._getBestFitZoom(t),r=this._imageSize[n],i=e.options.crs.pointToLatLng(L.point(r.x/2,r.y/2),n)},getZoomifyBounds:function(e){var t=this._imageSize[0],n=e.options.crs.pointToLatLng(L.point(0,0),0),r=e.options.crs.pointToLatLng(L.point(t.x,t.y),0),i=L.latLngBounds(n,r);return i},getCenterZoom:function(e){var t=e.getSize(),n=this._getBestFitZoom(t),r=this._imageSize[n],i=e.options.crs.pointToLatLng(L.point(r.x/2,r.y/2),n);return{center:i,lat:i.lat,lon:i.lng,zoom:n}},_getGridSize:function(e){var t=this.options.tileSize;return L.point(Math.ceil(e.x/t),Math.ceil(e.y/t))},_getBestFitZoom:function(e){var t=this.options.tolerance,n=this._imageSize.length-1,r,n;while(n){r=this._imageSize[n];if(r.x*t<e.x&&r.y*t<e.y)return n;n--}return n},_tileShouldBeLoaded:function(e){var t=this._gridSize[this._map.getZoom()];return e.x>=0&&e.x<t.x&&e.y>=0&&e.y<t.y},_addTile:function(e,t){var n=this._getTilePos(e),r=this._getTile(),i=this._map.getZoom(),s=this._imageSize[i],o=this._gridSize[i],u=this.options.tileSize;e.x===o.x-1&&(r.style.width=s.x-u*(o.x-1)+"px");e.y===o.y-1&&(r.style.height=s.y-u*(o.y-1)+"px");L.DomUtil.setPosition(r,n,L.Browser.chrome||L.Browser.android23);this._tiles[e.x+":"+e.y]=r;this._loadTile(r,e);r.parentNode!==this._tileContainer&&t.appendChild(r)},getTileUrl:function(e){return this._url+"TileGroup"+this._getTileGroup(e)+"/"+this._map.getZoom()+"-"+e.x+"-"+e.y+".jpg"},_getTileGroup:function(e){var t=this._map.getZoom(),n=0,r;for(z=0;z<t;z++){r=this._gridSize[z];n+=r.x*r.y}n+=e.y*this._gridSize[t].x+e.x;return Math.floor(n/256)}});L.tileLayer.zoomify=function(e,t){return new L.TileLayer.Zoomify(e,t)};L.Control.MiniMap=L.Control.extend({options:{position:"bottomright",toggleDisplay:!1,zoomLevelOffset:-5,zoomLevelFixed:!1,zoomAnimation:!1,autoToggleDisplay:!1,show_view:!0,width:150,height:150,aimingRectOptions:{color:"#da0000",weight:1,clickable:!1,stroke:!0},shadowRectOptions:{color:"#000000",weight:1,clickable:!1,opacity:0,fillOpacity:0}},hideText:"Hide MiniMap",showText:"Show MiniMap",initialize:function(e,t){L.Util.setOptions(this,t);this.options.aimingRectOptions.clickable=!1;this.options.shadowRectOptions.clickable=!1;this._layer=e},onAdd:function(e){this._mainMap=e;this._container=L.DomUtil.create("div","leaflet-control-minimap");this._container.style.width=this.options.width+"px";this._container.style.height=this.options.height+"px";L.DomEvent.disableClickPropagation(this._container);L.DomEvent.on(this._container,"mousewheel",L.DomEvent.stopPropagation);this._miniMap=new L.Map(this._container,{attributionControl:!1,zoomControl:!1,zoomAnimation:this.options.zoomAnimation,autoToggleDisplay:this.options.autoToggleDisplay,touchZoom:!1,scrollWheelZoom:!1,doubleClickZoom:!1,boxZoom:!1,dragging:!1,crs:e.options.crs});this._miniMap.addLayer(this._layer);this._mainMapMoving=!1;this._miniMapMoving=!1;this._userToggledDisplay=!1;this._minimized=!1;this.options.toggleDisplay&&this._addToggleButton();this._miniMap.whenReady(L.Util.bind(function(){this._aimingRect=L.rectangle(this._mainMap.getBounds(),this.options.aimingRectOptions).addTo(this._miniMap);this._shadowRect=L.rectangle(this._mainMap.getBounds(),this.options.shadowRectOptions).addTo(this._miniMap);this._locationCircle=L.circleMarker(this._mainMap.getCenter(),{fillColor:"#da0000",color:"#FFFFFF",weight:2,radius:10,fill:!0,fillOpacity:1,stroke:!0,clickable:!1}).addTo(this._miniMap);this._locationCircle.setRadius(5);this._mainMap.on("moveend",this._onMainMapMoved,this);this._mainMap.on("move",this._onMainMapMoving,this);this.options.bounds_array&&this._miniMap.fitBounds(this.options.bounds_array,{padding:[15,15]})},this));return this._container},minimize:function(e){this._minimized||this._minimize()},restore:function(){if(this._minimized){this._restore();this._miniMap.fitBounds(this.options.bounds_array,{padding:[15,15]})}},addTo:function(e){L.Control.prototype.addTo.call(this,e);this._miniMap.setView(this._mainMap.getCenter(),this._decideZoom(!0));this._setDisplay(this._decideMinimized());return this},onRemove:function(e){this._mainMap.off("moveend",this._onMainMapMoved,this);this._mainMap.off("move",this._onMainMapMoving,this);this._miniMap.off("moveend",this._onMiniMapMoved,this);this._miniMap.removeLayer(this._layer)},_addToggleButton:function(){this._toggleDisplayButton=this.options.toggleDisplay?this._createButton("",this.hideText,"leaflet-control-minimap-toggle-display",this._container,this._toggleDisplayButtonClicked,this):undefined},_createButton:function(e,t,n,r,i,s){var o=L.DomUtil.create("a",n,r);o.innerHTML=e;o.href="#";o.title=t;var u=L.DomEvent.stopPropagation;L.DomEvent.on(o,"click",u).on(o,"mousedown",u).on(o,"dblclick",u).on(o,"click",L.DomEvent.preventDefault).on(o,"click",i,s);return o},_toggleDisplayButtonClicked:function(){this._userToggledDisplay=!0;if(!this._minimized){this._minimize();this._toggleDisplayButton.title=this.showText}else{this._restore();this._toggleDisplayButton.title=this.hideText}},_setDisplay:function(e){e!=this._minimized&&(this._minimized?this._restore():this._minimize())},_minimize:function(){this._container.style.width="0px";this._container.style.height="0px";this._minimized=!0},_restore:function(){this._container.style.width=this.options.width+"px";this._container.style.height=this.options.height+"px";this._minimized=!1},_onMainMapMoved:function(e){if(!this._miniMapMoving){var t=this._decideZoom(!0);t!=0;this._mainMapMoving=!0;this._setDisplay(this._decideMinimized())}else this._miniMapMoving=!1;this.options.show_view&&this._aimingRect.setBounds(this._mainMap.getBounds());this._locationCircle.setLatLng(this._mainMap.getCenter())},_onMainMapMoving:function(e){this.options.show_view&&this._aimingRect.setBounds(this._mainMap.getBounds());this._locationCircle.setLatLng(this._mainMap.getCenter())},_onMiniMapMoveStarted:function(e){var t=this._aimingRect.getBounds(),n=this._miniMap.latLngToContainerPoint(t.getSouthWest()),r=this._miniMap.latLngToContainerPoint(t.getNorthEast());this._lastAimingRectPosition={sw:n,ne:r}},_onMiniMapMoving:function(e){if(!this._mainMapMoving&&this._lastAimingRectPosition){this._shadowRect.setBounds(new L.LatLngBounds(this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.sw),this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.ne)));this._shadowRect.setStyle({opacity:1,fillOpacity:.3})}},_onMiniMapMoved:function(e){if(!this._mainMapMoving){this._miniMapMoving=!0;this._mainMap.setView(this._miniMap.getCenter(),this._decideZoom(!1));this._shadowRect.setStyle({opacity:0,fillOpacity:0})}else this._mainMapMoving=!1},_decideZoom:function(e){if(!this.options.zoomLevelFixed&&this.options.zoomLevelFixed!=0){if(e)return this._mainMap.getZoom()+this.options.zoomLevelOffset;var t=this._miniMap.getZoom()-this._mainMap.getZoom(),n=this._miniMap.getZoom()-this.options.zoomLevelOffset,r;if(t>this.options.zoomLevelOffset&&this._mainMap.getZoom()<this._miniMap.getMinZoom()-this.options.zoomLevelOffset)if(this._miniMap.getZoom()>this._lastMiniMapZoom){r=this._mainMap.getZoom()+1;this._miniMap.setZoom(this._miniMap.getZoom()-1)}else r=this._mainMap.getZoom();else r=n;this._lastMiniMapZoom=this._miniMap.getZoom();return r}return e?this.options.zoomLevelFixed:this._mainMap.getZoom()},_decideMinimized:function(){return this._userToggledDisplay?this._minimized:this.options.autoToggleDisplay?this._mainMap.getBounds().contains(this._miniMap.getBounds())?!0:!1:this._minimized}});L.Map.mergeOptions({miniMapControl:!1});L.Map.addInitHook(function(){this.options.miniMapControl&&(this.miniMapControl=(new L.Control.MiniMap).addTo(this))});L.control.minimap=function(e){return new L.Control.MiniMap(e)};(function(e){function i(e,t,i){var o=s(e);for(var u=0;u<t.length;u++){var a=[e,t[u]].join("-");r[a]=n(a,i||o.type,o.minZoom,o.maxZoom)}}function s(e){if(e in r)return r[e];throw"No such provider ("+e+")"}var t="a b c d".split(" "),n=function(e,n,r,i){return{url:["http://stamen-tiles-{S}.a.ssl.fastly.net/",e,"/{Z}/{X}/{Y}.",n].join(""),type:n,subdomains:t.slice(),minZoom:r,maxZoom:i,attribution:["<a href='http://storymap.knightlab.com/' target='_blank'>Knight Lab StoryMapJS</a> | ",'Map tiles by <a href="http://stamen.com">Stamen Design</a>, ','under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. ','Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, ','under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.'].join("")}},r={toner:n("toner","png",0,20),terrain:n("terrain","jpg",4,18),watercolor:n("watercolor","jpg",1,16),"trees-cabs-crime":{url:"http://{S}.tiles.mapbox.com/v3/stamen.trees-cabs-crime/{Z}/{X}/{Y}.png",type:"png",subdomains:"a b c d".split(" "),minZoom:11,maxZoom:18,extent:[{lat:37.853,lon:-122.577},{lat:37.684,lon:-122.313}],attribution:['Design by Shawn Allen at <a href="http://stamen.com">Stamen</a>.','Data courtesy of <a href="http://fuf.net">FuF</a>,','<a href="http://www.yellowcabsf.com">Yellow Cab</a>','&amp; <a href="http://sf-police.org">SFPD</a>.'].join(" ")}};i("toner",["hybrid","labels","lines","background","lite"]);i("toner",["2010"]);i("toner",["2011","2011-lines","2011-labels","2011-lite"]);i("terrain",["background"]);i("terrain",["labels","lines"],"png");e.stamen=e.stamen||{};e.stamen.tile=e.stamen.tile||{};e.stamen.tile.providers=r;e.stamen.tile.getProvider=s;if(typeof MM=="object"){var o=typeof MM.Template=="function"?MM.Template:MM.TemplatedMapProvider;MM.StamenTileLayer=function(e){var t=s(e);this._provider=t;MM.Layer.call(this,new o(t.url,t.subdomains));this.provider.setZoomRange(t.minZoom,t.maxZoom);this.attribution=t.attribution};MM.StamenTileLayer.prototype={setCoordLimits:function(e){var t=this._provider;if(t.extent){e.coordLimits=[e.locationCoordinate(t.extent[0]).zoomTo(t.minZoom),e.locationCoordinate(t.extent[1]).zoomTo(t.maxZoom)];return!0}return!1}};MM.extend(MM.StamenTileLayer,MM.Layer)}typeof L=="object"&&(L.StamenTileLayer=L.TileLayer.extend({initialize:function(e,t){var n=s(e),r=n.url.replace(/({[A-Z]})/g,function(e){return e.toLowerCase()}),i={minZoom:n.minZoom,maxZoom:n.maxZoom,subdomains:n.subdomains,scheme:"xyz",attribution:n.attribution};t&&VCO.Util.mergeData(i,t);L.TileLayer.prototype.initialize.call(this,r,i)}}));if(typeof google=="object"&&typeof google.maps=="object"){google.maps.StamenMapType=function(e){var t=s(e),n=t.subdomains;return google.maps.ImageMapType.call(this,{getTileUrl:function(e,r){var i=1<<r,s=e.x%i,o=s<0?s+i:s,u=e.y,a=(r+o+u)%n.length;return t.url.replace("{S}",n[a]).replace("{Z}",r).replace("{X}",o).replace("{Y}",u)},tileSize:new google.maps.Size(256,256),name:e,minZoom:t.minZoom,maxZoom:t.maxZoom})};google.maps.StamenMapType.prototype=new google.maps.ImageMapType("_")}})(typeof exports=="undefined"?this:exports);VCO.MapMarker=VCO.Class.extend({includes:[VCO.Events],initialize:function(e,t){this._el={container:{},content_container:{},content:{}};this._marker={};this._icon={};this.marker_number=0;this.media_icon_class="";this.timer={};this.data={};this.options={duration:1e3,ease:VCO.Ease.easeInSpline,width:600,height:600,map_popup:!1,use_custom_markers:!1};this.animator=null;VCO.Util.mergeData(this.options,t);VCO.Util.mergeData(this.data,e);this._initLayout()},show:function(){},hide:function(){},addTo:function(e){this._addTo(e)},removeFrom:function(e){this._removeFrom(e)},updateDisplay:function(e,t,n){this._updateDisplay(e,t,n)},createMarker:function(e,t){this._createMarker(e,t)},createPopup:function(e,t){this._createPopup(e,t)},active:function(e){this._active(e)},location:function(){return this._location()},_createMarker:function(e,t){},_addTo:function(e){},_removeFrom:function(e){},_createPopup:function(e,t){},_active:function(e){},_location:function(){return{lat:0,lng:0}},_onMarkerClick:function(e){this.fire("markerclick",{marker_number:this.marker_number})},_initLayout:function(){this._createMarker(this.data,this.options)},_updateDisplay:function(e,t,n){}});VCO.Map=VCO.Class.extend({includes:[VCO.Events,VCO.DomMixins],_el:{},initialize:function(e,t,n){this._el={container:{},map:{},map_mask:{}};typeof e=="object"?this._el.container=e:this._el.container=VCO.Dom.get(e);this._loaded={data:!1,map:!1};this._map=null;this._mini_map=null;this._markers=[];this.zoom_min_max={min:null,max:null};this._line=null;this._line_active=null;this.current_marker=0;this.bounds_array=null;this._tile_layer=null;this._tile_layer_mini=null;this._image_layer=null;this.data={uniqueid:"",slides:[{test:"yes"},{test:"yes"},{test:"yes"}]};this.options={map_type:"stamen:toner-lite",map_as_image:!1,map_mini:!1,map_background_color:"#d9d9d9",map_subdomains:"",zoomify:{path:"",width:"",height:"",tolerance:.8,attribution:""},skinny_size:650,less_bounce:!0,path_gfx:"gfx",start_at_slide:0,map_popup:!1,zoom_distance:100,calculate_zoom:!0,line_follows_path:!0,line_color:"#333",line_color_inactive:"#000",line_weight:5,line_opacity:.2,line_dash:"5,5",line_join:"miter",show_lines:!0,show_history_line:!0,use_custom_markers:!1,map_center_offset:null};this.animator=null;this.timer=null;VCO.Util.mergeData(this.options,n);VCO.Util.mergeData(this.data,t);this._initLayout();this._initEvents();this._createMap();this._initData()},updateDisplay:function(e,t,n,r,i){this._updateDisplay(e,t,n,r,i)},goTo:function(e,t){if(e<this._markers.length&&e>=0){var n=0,r=this.current_marker;this.current_marker=e;var i=this._markers[this.current_marker];this.animator&&this.animator.stop();this._resetMarkersActive();if(i.data.type&&i.data.type=="overview"){this._markerOverview();t||this._onMarkerChange()}else{i.active(!0);if(t)i.data.location&&this._viewTo(i.data.location);else{if(i.data.location&&i.data.location.lat){n=this._calculateZoomChange(this._getMapCenter(!0),i.location());this._viewTo(i.data.location,{calculate_zoom:this.options.calculate_zoom,zoom:n});if(this.options.line_follows_path){if(this.options.show_history_line&&i.data.real_marker&&this._markers[r].data.real_marker){var s=[],o=r,u;if(o<this.current_marker)while(o<this.current_marker){if(this._markers[o].data.location&&this._markers[o].data.location.lat){u={lat:this._markers[o].data.location.lat,lon:this._markers[o].data.location.lon};s.push(u)}o++}else if(o>this.current_marker)while(o>this.current_marker){if(this._markers[o].data.location&&this._markers[o].data.location.lat){u={lat:this._markers[o].data.location.lat,lon:this._markers[o].data.location.lon};s.push(u)}o--}s.push({lat:i.data.location.lat,lon:i.data.location.lon});this._replaceLines(this._line_active,s)}}else this.options.show_history_line&&i.data.real_marker&&this._markers[r].data.real_marker&&this._replaceLines(this._line_active,[{lat:i.data.location.lat,lon:i.data.location.lon},{lat:this._markers[r].data.location.lat,lon:this._markers[r].data.location.lon}])}else{this._markerOverview();t||this._onMarkerChange()}this._onMarkerChange()}}}},panTo:function(e,t){this._panTo(e,t)},zoomTo:function(e,t){this._zoomTo(e,t)},viewTo:function(e,t){this._viewTo(e,t)},getBoundsZoom:function(e,t,n,r){this.__getBoundsZoom(e,t,n,r)},markerOverview:function(){this._markerOverview()},calculateMarkerZooms:function(){this._calculateMarkerZooms()},createMiniMap:function(){this._createMiniMap()},setMapOffset:function(e,t){this.options.map_center_offset.left=e;this.options.map_center_offset.top=t},calculateMinMaxZoom:function(){for(var e=0;e<this._markers.length;e++)this._markers[e].data.location&&this._markers[e].data.location.zoom&&this.updateMinMaxZoom(this._markers[e].data.location.zoom);trace("MAX ZOOM: "+this.zoom_min_max.max+" MIN ZOOM: "+this.zoom_min_max.min)},updateMinMaxZoom:function(e){this.zoom_min_max.max||(this.zoom_min_max.max=e);this.zoom_min_max.min||(this.zoom_min_max.min=e);this.zoom_min_max.max<e&&(this.zoom_min_max.max=e);this.zoom_min_max.min>e&&(this.zoom_min_max.min=e)},initialMapLocation:function(){if(this._loaded.data&&this._loaded.map){this.goTo(this.options.start_at_slide,!0);this._initialMapLocation()}},show:function(){},hide:function(){},addTo:function(e){e.appendChild(this._el.container);this.onAdd()},removeFrom:function(e){e.removeChild(this._el.container);this.onRemove()},createMarkers:function(e){this._createMarkers(e)},createMarker:function(e){this._createMarker(e)},_destroyMarker:function(e){this._removeMarker(e);for(var t=0;t<this._markers.length;t++)this._markers[t]==e&&this._markers.splice(t,1);this.fire("markerRemoved",e)},_createMarkers:function(e){for(var t=0;t<e.length;t++){this._createMarker(e[t]);e[t].location&&e[t].location.lat&&this.options.show_lines&&this._addToLine(this._line,e[t])}},_createLines:function(e){},_createMap:function(){},_createMiniMap:function(){},_createMarker:function(e){var t={};t.on("markerclick",this._onMarkerClick);this._addMarker(t);this._markers.push(t);t.marker_number=this._markers.length-1;this.fire("markerAdded",t)},_addMarker:function(e){},_removeMarker:function(e){},_resetMarkersActive:function(){for(var e=0;e<this._markers.length;e++)this._markers[e].active(!1)},_calculateMarkerZooms:function(){},_createLine:function(e){return{data:e}},_addToLine:function(e,t){},_replaceLines:function(e,t){},_addLineToMap:function(e){},_panTo:function(e,t){},_zoomTo:function(e,t){},_viewTo:function(e,t){},_updateMapDisplay:function(e,t){},_refreshMap:function(){},_getMapLocation:function(e){return{x:0,y:0}},_getMapZoom:function(){return 1},_getMapCenter:function(){return{lat:0,lng:0}},_getBoundsZoom:function(e,t,n,r){},_markerOverview:function(){},_initialMapLocation:function(){},_onMarkerChange:function(e){this.fire("change",{current_marker:this.current_marker})},_onMarkerClick:function(e){this.current_marker!=e.marker_number&&this.goTo(e.marker_number)},_onMapLoaded:function(e){this._loaded.map=!0;this.options.calculate_zoom&&this.calculateMarkerZooms();this.calculateMinMaxZoom();this.options.map_mini&&!VCO.Browser.touch&&this.createMiniMap();this.initialMapLocation();this.fire("loaded",this.data)},_calculateZoomChange:function(e,t,n){return this._getBoundsZoom(e,t,n)},_updateDisplay:function(e,t,n,r){this._updateMapDisplay(n,r)},_initLayout:function(){this._el.map_mask=VCO.Dom.create("div","vco-map-mask",this._el.container);this.options.map_as_image?this._el.map=VCO.Dom.create("div","vco-map-display vco-mapimage-display",this._el.map_mask):this._el.map=VCO.Dom.create("div","vco-map-display",this._el.map_mask)},_initData:function(){if(this.data.slides){this._createMarkers(this.data.slides);this._resetMarkersActive();this._markers[this.current_marker].active(!0);this._loaded.data=!0;this._initialMapLocation()}},_initEvents:function(){}});VCO.MapMarker.Leaflet=VCO.MapMarker.extend({_createMarker:function(e,t){var n={};if(e.location&&e.location.lat&&e.location.lon){this.data.real_marker=!0;t.use_custom_markers&&e.location.icon&&e.location.icon!=""?this._icon=new L.icon({iconUrl:e.location.icon,iconSize:[41]}):this._icon=new L.divIcon({className:"vco-mapmarker "+this.media_icon_class,iconAnchor:[10,10]});this._marker=new L.marker([e.location.lat,e.location.lon],{title:e.text.headline,icon:this._icon});this._marker.on("click",this._onMarkerClick,this);t.map_popup&&this._createPopup(e,t)}},_addTo:function(e){this.data.real_marker&&this._marker.addTo(e)},_createPopup:function(e,t){},_active:function(e){var t=this;this.data.media&&this.data.media.mediatype?this.media_icon_class="vco-mapmarker-icon vco-icon-"+this.data.media.mediatype.type:this.media_icon_class="vco-mapmarker-icon vco-icon-plaintext";if(this.data.real_marker)if(e){this._marker.setZIndexOffset(100);this._icon=new L.divIcon({className:"vco-mapmarker-active "+this.media_icon_class,iconAnchor:[10,10]});this._setIcon()}else{clearTimeout(this.timer);this._marker.setZIndexOffset(0);this._icon=new L.divIcon({className:"vco-mapmarker "+this.media_icon_class,iconAnchor:[10,10]});this._setIcon()}},_openPopup:function(){this._marker.openPopup()},_setIcon:function(){this._marker.setIcon(this._icon)},_location:function(){return this.data.real_marker?this._marker.getLatLng():{}}});VCO.Map.Leaflet=VCO.Map.extend({includes:[VCO.Events],_createMap:function(){this._map=new L.map(this._el.map,{scrollWheelZoom:!1,zoomControl:!this.options.map_mini});this._map.on("load",this._onMapLoaded,this);this._map.on("moveend",this._onMapMoveEnd,this);var e=this.options.map_type.split(":");this._tile_layer=this._createTileLayer(this.options.map_type);this._tile_layer.on("load",this._onTilesLoaded,this);this._map.addLayer(this._tile_layer);this._image_layer&&this._map.addLayer(this._image_layer);this._line=this._createLine(this._line);this._line.setStyle({color:this.options.line_color_inactive});this._addLineToMap(this._line);this._line_active=this._createLine(this._line_active);this._line_active.setStyle({opacity:1});this._addLineToMap(this._line_active);if(this.options.map_as_image){this._line_active.setStyle({opacity:0});this._line.setStyle({opacity:0})}},_createMiniMap:function(){this.options.map_as_image&&(this.zoom_min_max.min=0);this.bounds_array||(this.bounds_array=this._getAllMarkersBounds(this._markers));this._tile_layer_mini=this._createTileLayer(this.options.map_type);this._mini_map=(new L.Control.MiniMap(this._tile_layer_mini,{width:150,height:100,position:"bottomleft",bounds_array:this.bounds_array,zoomLevelFixed:this.zoom_min_max.min,zoomAnimation:!0,aimingRectOptions:{fillColor:"#FFFFFF",color:"#FFFFFF",opacity:.4,weight:1,stroke:!0}})).addTo(this._map);this._mini_map.getContainer().style.backgroundColor=this.options.map_background_color},_createBackgroundMap:function(e){trace("CREATE BACKGROUND MAP");if(!this._image_layer){this._image_layer=new L.layerGroup;this._map.addLayer(this._image_layer)}else this._image_layer.clearLayers();if(e)for(x in e){var t=e[x],n={},r={x:0,y:0,url:t.src,height:parseInt(t.style.height.split("px")[0]),width:parseInt(t.style.width.split("px")[0]),pos:{start:0,end:0}};if(t.style.left||t.style.top){t.style.left&&(r.x=parseInt(t.style.left.split("px")[0]));t.style.top&&(r.y=parseInt(t.style.top.split("px")[0]))}else if(t.style["-webkit-transform"]||t.style.transform||t.style["-ms-transform"]){var i;t.style["-webkit-transform"]?i=t.style["-webkit-transform"].split("3d(")[1].split(", 0)")[0].split(", "):t.style.transform?i=t.style.transform.split("3d(")[1].split(", 0)")[0].split(", "):t.style["-ms-transform"]&&(i=t.style["-ms-transform"].split("3d(")[1].split(", 0)")[0].split(", "));r.x=parseInt(i[0].split("px")[0]);r.y=parseInt(i[1].split("px")[0])}if(r.url.match("toner")){r.url=r.url.replace("/toner-hybrid/","/toner-lines/");r.url=r.url.replace("/toner/","/toner-background/")}r.pos.start=this._map.containerPointToLatLng([r.x,r.y]);r.pos.end=this._map.containerPointToLatLng([r.x+r.width,r.y+r.height]);n=new L.imageOverlay(r.url,[r.pos.start,r.pos.end]);this._image_layer.addLayer(n)}},_createTileLayer:function(e,t){var n=null,r=e.split(":"),i={},s="<a href='http://storymap.knightlab.com/' target='_blank'>Knight Lab StoryMapJS</a> | ";t&&(i=t);switch(r[0]){case"mapbox":var o=r[1]||"nuknightlab.hif6ioi4";i.subdomains="abcd";i.attribution=s+"<div class='mapbox-maplogo'></div><a href='https://www.mapbox.com/about/maps/' target='_blank'>© Mapbox © OpenStreetMap</a> <a class='mapbox-improve-map' href='https://www.mapbox.com/map-feedback/#zachwise.hgmmh8ho/-81.80419921875/39.58875727696545/5' target='_blank'>Improve this map</a>";n=new L.TileLayer("https://{s}.tiles.mapbox.com/v2/"+o+"/{z}/{x}/{y}.png",i);break;case"stamen":n=new L.StamenTileLayer(r[1]||"toner-lite",i);this._map.getContainer().style.backgroundColor="#FFFFFF";break;case"zoomify":i.width=this.options.zoomify.width;i.height=this.options.zoomify.height;i.tolerance=this.options.zoomify.tolerance;i.attribution=s+this.options.zoomify.attribution;n=new L.tileLayer.zoomify(this.options.zoomify.path,i);break;case"osm":i.subdomains="ab";n=new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",i);break;case"http":case"https":i.subdomains=this.options.map_subdomains;n=new L.TileLayer(this.options.map_type,i);break;default:n=new L.StamenTileLayer("toner",i)}return n},_onMapMoveEnd:function(e){},_onTilesLoaded:function(e){this._createBackgroundMap(e.target._tiles);this._tile_layer.off("load",this._onTilesLoaded,this)},_onMapZoomed:function(e){trace("FIRST ZOOM");this._map.off("zoomend",this._onMapZoomed,this)},_onMapZoom:function(e){},_createMarker:function(e){var t=new VCO.MapMarker.Leaflet(e,this.options);t.on("markerclick",this._onMarkerClick,this);this._addMarker(t);this._markers.push(t);t.marker_number=this._markers.length-1;this.fire("markerAdded",t)},_addMarker:function(e){e.addTo(this._map)},_removeMarker:function(e){},_markerOverview:function(){var e,t;this._line_active.setStyle({opacity:0});if(this.options.map_type=="zoomify"&&this.options.map_as_image){var n=this._tile_layer.getCenterZoom(this._map);e=n.center;if(this.options.map_center_offset&&this.options.map_center_offset.left!=0||this.options.map_center_offset.top!=0){n.zoom=n.zoom-1;e=this._getMapCenterOffset(e,n.zoom)}this._map.setView(e,n.zoom,{pan:{animate:!0,duration:this.options.duration/1e3,easeLinearity:.1},zoom:{animate:!0,duration:this.options.duration/1e3,easeLinearity:.1}})}else{this.bounds_array=this._getAllMarkersBounds(this._markers);if(this.options.map_center_offset&&this.options.map_center_offset.left!=0||this.options.map_center_offset.top!=0){var r=new L.latLngBounds(this.bounds_array);e=r.getCenter();t=this._map.getBoundsZoom(r);e=this._getMapCenterOffset(e,t-1);this._map.setView(e,t-1,{pan:{animate:!0,duration:this.options.duration/1e3,easeLinearity:.1},zoom:{animate:!0,duration:this.options.duration/1e3,easeLinearity:.1}})}else this._map.fitBounds(this.bounds_array,{padding:[15,15]})}this._mini_map&&this._mini_map.minimize()},_getAllMarkersBounds:function(e){var t=[];for(var n=0;n<e.length;n++)e[n].data.real_marker&&t.push([e[n].data.location.lat,e[n].data.location.lon]);return t},_calculateMarkerZooms:function(){for(var e=0;e<this._markers.length;e++)if(this._markers[e].data.location){var t=this._markers[e],n,r,i,s,o,u;t.data.type&&t.data.type=="overview"?i=this._getMapCenter(!0):i=t.location();e>0?n=this._markers[e-1].location():n=this._getMapCenter(!0);s=this._calculateZoomChange(n,i);e<this._markers.length-1?r=this._markers[e+1].location():r=this._getMapCenter(!0);o=this._calculateZoomChange(r,i);s&&s<o?u=s:o?u=o:u=s;if(this.options.map_center_offset&&this.options.map_center_offset.left!=0||this.options.map_center_offset.top!=0)u-=1;t.data.location.zoom=u}},_createLine:function(e){return new L.Polyline([],{clickable:!1,color:this.options.line_color,weight:this.options.line_weight,opacity:this.options.line_opacity,dashArray:this.options.line_dash,lineJoin:this.options.line_join,className:"vco-map-line"})},_addLineToMap:function(e){this._map.addLayer(e)},_addToLine:function(e,t){e.addLatLng({lon:t.location.lon,lat:t.location.lat})},_replaceLines:function(e,t){e.setLatLngs(t)},_panTo:function(e,t){this._map.panTo({lat:e.lat,lon:e.lon},{animate:!0,duration:this.options.duration/1e3,easeLinearity:.1})},_zoomTo:function(e,t){this._map.setZoom(e)},_viewTo:function(e,t){var n=!0,r=this.options.duration/1e3,i=this._getMapZoom(),s={lat:e.lat,lon:e.lon};this.options.map_as_image||this._line_active.setStyle({opacity:1});e.zoom&&(i=e.zoom);if(t){t.duration&&(t.duration==0?n=!1:r=duration);t.zoom&&this.options.calculate_zoom&&(i=t.zoom)}this.options.map_center_offset&&(s=this._getMapCenterOffset(s,i));this._map.setView(s,i,{pan:{animate:n,duration:r,easeLinearity:.1},zoom:{animate:n,duration:r,easeLinearity:.1}});this._mini_map&&this.options.width>this.options.skinny_size&&(i-1<=this.zoom_min_max
.min?this._mini_map.minimize():this._mini_map.restore())},_getMapLocation:function(e){return this._map.latLngToContainerPoint(e)},_getMapZoom:function(){return this._map.getZoom()},_getMapCenter:function(e){e;return this._map.getCenter()},_getMapCenterOffset:function(e,t){var n,r;n=this._map.project(e,t).subtract([this.options.map_center_offset.left,this.options.map_center_offset.top]);r=this._map.unproject(n,t);return r},_getBoundsZoom:function(e,t,n){var r=e,i=[Math.abs(this.options.map_center_offset.left)*3,Math.abs(this.options.map_center_offset.top)*3];if(n){var s=r.lat+(r.lat-t.lat)/2,o=r.lng+(r.lng-t.lng)/2;r=new L.LatLng(s,o)}var u=new L.LatLngBounds([r,t]);return this.options.less_bounce?this._map.getBoundsZoom(u,!1):this._map.getBoundsZoom(u,!0,i)},_getZoomifyZoom:function(){},_initialMapLocation:function(){this._map.on("zoomend",this._onMapZoomed,this)},_updateMapDisplay:function(e,t){if(e){var n=this.options.duration,r=this;t&&(n=t);this.timer&&clearTimeout(this.timer);this.timer=setTimeout(function(){r._refreshMap()},n)}else this.timer||this._refreshMap();this._mini_map&&this._el.container.offsetWidth<this.options.skinny_size?this._mini_map.true_hide=!0:this._mini_map&&(this._mini_map.true_hide=!1)},_refreshMap:function(){if(this._map){if(this.timer){clearTimeout(this.timer);this.timer=null}this._map.invalidateSize();this._markers[this.current_marker].data.type&&this._markers[this.current_marker].data.type=="overview"?this._markerOverview():this._viewTo(this._markers[this.current_marker].data.location,{zoom:this._getMapZoom()})}}});L.Map.include({_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._floor();this.panBy(n,t);return!0},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;n=n||{};var r=this.getZoomScale(t),i=this._getCenterOffset(e)._divideBy(1-1/r),s=this._getCenterLayerPoint()._add(i);this.fire("movestart").fire("zoomstart");this._animateZoom(e,t,s,r,null,!0);return!0}});L.TileLayer.include({getTiles:function(){return this._tiles}});VCO.StoryMap=VCO.Class.extend({includes:VCO.Events,initialize:function(e,t,n){var r=this;this.version="0.1.16";this.ready=!1;this._el={container:{},storyslider:{},map:{},menubar:{}};typeof e=="object"?this._el.container=e:this._el.container=VCO.Dom.get(e);this._storyslider={};this._map={};this._menubar={};this._loaded={storyslider:!1,map:!1};this.data={uniqueid:"",slides:[{uniqueid:"",type:"overview",background:{url:"http://upload.wikimedia.org/wikipedia/commons/thumb/2/2d/Mark_Twain_by_Abdullah_Fr%C3%A8res%2C_1867.jpg/418px-Mark_Twain_by_Abdullah_Fr%C3%A8res%2C_1867.jpg",color:"",opacity:50},date:"1835",text:{headline:"Mark Twain",text:'Samuel Langhorne Clemens (November 30, 1835 – April 21, 1910), better known by his pen name Mark Twain, was an American author and humorist. He wrote The Adventures of Tom Sawyer (1876) and its sequel, Adventures of Huckleberry Finn (1885), the latter often called "the Great American Novel."'},media:null},{uniqueid:"",date:"1835",location:{lat:39.491711,lon:-91.79326,name:"Florida, Missouri",zoom:12,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"Florida, Missouri",text:"Born in Florida, Missouri. Halley’s comet visible from earth."},media:{url:"http://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Mark_Twain_birthplace.jpg/800px-Mark_Twain_birthplace.jpg",credit:"",caption:"Mark Twain's birthplace, Florida, Missouri"}}]};this.options={script_path:"",height:this._el.container.offsetHeight,width:this._el.container.offsetWidth,layout:"landscape",base_class:"",map_size_sticky:3,map_center_offset:null,less_bounce:!0,start_at_slide:0,menubar_height:0,skinny_size:650,duration:1e3,ease:VCO.Ease.easeInOutQuint,dragging:!0,trackResize:!0,map_type:"stamen:toner-lite",map_mini:!0,map_subdomains:"",map_as_image:!1,map_background_color:"#d9d9d9",zoomify:{path:"",width:"",height:"",tolerance:.8,attribution:""},map_height:300,storyslider_height:600,slide_padding_lr:45,slide_default_fade:"0%",menubar_default_y:0,path_gfx:"gfx",map_popup:!1,zoom_distance:100,calculate_zoom:!0,use_custom_markers:!1,line_follows_path:!0,line_color:"#DA0000",line_color_inactive:"#CCC",line_join:"miter",line_weight:3,line_opacity:.8,line_dash:"5,5",show_lines:!0,show_history_line:!0,api_key_flickr:"f2cc870b4d233dd0a5bfe73fd0d64ef0",language:"en"};this.current_slide=this.options.start_at_slide;this.animator_map=null;this.animator_storyslider=null;VCO.Util.mergeData(this.options,n);this.options.layout=="landscape"&&(this.options.map_center_offset={left:-200,top:0});this.options.map_type=="zoomify"&&this.options.map_as_image&&(this.options.map_size_sticky=2);this.options.map_as_image&&(this.options.calculate_zoom=!1);if(this.options.language=="en"){this.options.language=VCO.Language;this._initData(t)}else VCO.Load.js(this.options.script_path+"/locale/"+this.options.language+".js",function(){r._initData(t)});return this},goTo:function(e){if(e!=this.current_slide){this.current_slide=e;this._storyslider.goTo(this.current_slide);this._map.goTo(this.current_slide)}},updateDisplay:function(){this.ready&&this._updateDisplay()},_initData:function(e){var t=this;if(typeof e=="string")VCO.getJSON(e,function(e){e&&e.storymap&&VCO.Util.mergeData(t.data,e.storymap);t._onDataLoaded()});else if(typeof e=="object"){e.storymap?t.data=e.storymap:trace("data must have a storymap property");t._onDataLoaded()}else t._onDataLoaded()},_initLayout:function(){var e=this;this._el.container.className+=" vco-storymap";this.options.base_class=this._el.container.className;this._el.menubar=VCO.Dom.create("div","vco-menubar",this._el.container);this._el.map=VCO.Dom.create("div","vco-map",this._el.container);this._el.storyslider=VCO.Dom.create("div","vco-storyslider",this._el.container);this.options.width=this._el.container.offsetWidth;this.options.height=this._el.container.offsetHeight;this._el.map.style.height="1px";this._el.storyslider.style.top="1px";this._map=new VCO.Map.Leaflet(this._el.map,this.data,this.options);this._map.on("loaded",this._onMapLoaded,this);this._el.map.style.backgroundColor=this.options.map_background_color;this._menubar=new VCO.MenuBar(this._el.menubar,this._el.container,this.options);this._storyslider=new VCO.StorySlider(this._el.storyslider,this.data,this.options);this._storyslider.on("loaded",this._onStorySliderLoaded,this);this._storyslider.init();if(this.options.layout=="portrait"){this.options.map_height=this.options.height/this.options.map_size_sticky;this.options.storyslider_height=this.options.height-this._el.menubar.offsetHeight-this.options.map_height-1;this._menubar.setSticky(0)}else{this.options.menubar_height=this._el.menubar.offsetHeight;this.options.map_height=this.options.height;this.options.storyslider_height=this.options.height-this._el.menubar.offsetHeight-1;this._menubar.setSticky(this.options.menubar_height)}this._updateDisplay(this.options.map_height,!0,2e3);this._menubar.show(2e3)},_initEvents:function(){this._menubar.on("collapse",this._onMenuBarCollapse,this);this._menubar.on("back_to_start",this._onBackToStart,this);this._menubar.on("overview",this._onOverview,this);this._storyslider.on("change",this._onSlideChange,this);this._storyslider.on("colorchange",this._onColorChange,this);this._map.on("change",this._onMapChange,this)},_updateDisplay:function(e,t,n){var r=this.options.duration,i=this.options.base_class,s=this;n&&(r=n);this.options.width=this._el.container.offsetWidth;this.options.height=this._el.container.offsetHeight;this.options.width<=this.options.skinny_size?this.options.layout="portrait":this.options.layout="landscape";e&&(this.options.map_height=e);if(VCO.Browser.touch){this.options.layout=VCO.Browser.orientation();i+=" vco-mobile"}if(this.options.layout=="portrait"){i+=" vco-skinny";this._map.setMapOffset(0,0);this.options.map_height=this.options.height/this.options.map_size_sticky;this.options.storyslider_height=this.options.height-this.options.map_height-1;this._menubar.setSticky(0);i+=" vco-layout-portrait";if(t){this.animator_map&&this.animator_map.stop();this.animator_map=VCO.Animate(this._el.map,{height:this.options.map_height+"px",duration:r,easing:VCO.Ease.easeOutStrong,complete:function(){s._map.updateDisplay(s.options.width,s.options.map_height,t,n,s.options.menubar_height)}});this.animator_storyslider&&this.animator_storyslider.stop();this.animator_storyslider=VCO.Animate(this._el.storyslider,{height:this.options.storyslider_height+"px",duration:r,easing:VCO.Ease.easeOutStrong})}else{this._el.map.style.height=Math.ceil(this.options.map_height)+"px";this._el.storyslider.style.height=this.options.storyslider_height+"px"}this._menubar.updateDisplay(this.options.width,this.options.height,t);this._map.updateDisplay(this.options.width,this.options.height,!1);this._storyslider.updateDisplay(this.options.width,this.options.storyslider_height,t,this.options.layout)}else{i+=" vco-layout-landscape";this.options.menubar_height=this._el.menubar.offsetHeight;this.options.map_height=this.options.height;this.options.storyslider_height=this.options.height;this._menubar.setSticky(this.options.menubar_height);this._menubar.setSticky(this.options.menubar_height);this._el.map.style.height=this.options.height+"px";this._map.setMapOffset(-(this.options.width/4),0);this._el.storyslider.style.top=0;this._el.storyslider.style.height=this.options.storyslider_height+"px";this._menubar.updateDisplay(this.options.width,this.options.height,t);this._map.updateDisplay(this.options.width,this.options.height,t,n);this._storyslider.updateDisplay(this.options.width/2,this.options.storyslider_height,t,this.options.layout)}this._el.container.className=i},_onDataLoaded:function(e){trace("dataloaded");this.fire("dataloaded");this._initLayout();this._initEvents();this.ready=!0},_onColorChange:function(e){e.color||e.image?this._menubar.setColor(!0):this._menubar.setColor(!1)},_onSlideChange:function(e){if(this.current_slide!=e.current_slide){this.current_slide=e.current_slide;this._map.goTo(this.current_slide);this.fire("change",{current_slide:this.current_slide},this)}},_onMapChange:function(e){if(this.current_slide!=e.current_marker){this.current_slide=e.current_marker;this._storyslider.goTo(this.current_slide);this.fire("change",{current_slide:this.current_slide},this)}},_onOverview:function(e){this._map.markerOverview()},_onBackToStart:function(e){this.current_slide=0;this._map.goTo(this.current_slide);this._storyslider.goTo(this.current_slide);this.fire("change",{current_slide:this.current_slide},this)},_onMenuBarCollapse:function(e){this._updateDisplay(e.y,!0)},_onMouseClick:function(e){},_fireMouseEvent:function(e){if(!this._loaded)return;var t=e.type;t=t==="mouseenter"?"mouseover":t==="mouseleave"?"mouseout":t;if(!this.hasEventListeners(t))return;t==="contextmenu"&&VCO.DomEvent.preventDefault(e);this.fire(t,{latlng:"something",layerPoint:"something else"})},_onMapLoaded:function(){this._loaded.map=!0;this._onLoaded()},_onStorySliderLoaded:function(){this._loaded.storyslider=!0;this._onLoaded()},_onLoaded:function(){this._loaded.storyslider&&this._loaded.map&&this.fire("loaded",this.data)}});